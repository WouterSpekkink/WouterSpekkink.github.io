<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://wouterspekkink.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://wouterspekkink.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2023-07-31T22:04:05+02:00</updated><id>https://wouterspekkink.github.io/feed.xml</id><title type="html">blank</title><subtitle>My personal website. </subtitle><entry><title type="html">Writing academic papers with org-mode</title><link href="https://wouterspekkink.github.io/blog/2021/writing-academic-papers-with-org-mode/" rel="alternate" type="text/html" title="Writing academic papers with org-mode"/><published>2021-02-27T16:43:00+01:00</published><updated>2021-02-27T16:43:00+01:00</updated><id>https://wouterspekkink.github.io/blog/2021/writing-academic-papers-with-org-mode</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2021/writing-academic-papers-with-org-mode/"><![CDATA[<h2 id="edit-2023-01-03">EDIT (2023-01-03)</h2> <p>I have recently migrated from Doom emacs to a vanilla emacs config. What I like about the vanilla config is that I am more in control of what it does. Doom emacs, in some respects, was a bit of a black box to me. Also, Doom emacs does a lot of things I do not actually need or want. In my original post, I linked to my <a href="https://github.com/WouterSpekkink/dotfiles">dot files</a>, which included my doom emacs config. The doom config files are still there, but not in the <code class="language-plaintext highlighter-rouge">old_doom_config</code> branch, instead of the <code class="language-plaintext highlighter-rouge">master</code> branch. My vanilla config maintains (I think) all of what I describe in my post. However, the config looks different in most places, for example because I could no longer make use of the Doom emacs macros.</p> <h2 id="edit-2021-08-10">EDIT (2021-08-10)</h2> <p>After upgrading my Doom emacs installation today, I noticed that org-roam-bibtex was broken. This has to do with the fact that org-roam-bibtex has recently switched over to org-roam V2, which has been in development for a while now and was <a href="https://blog.jethro.dev/posts/org_roam_v2/">released in July</a>. Doom emacs now also supports org-roam V2 and <a href="https://github.com/hlissner/doom-emacs/tree/develop/modules/lang/org#should-i-go-with-roam-v1-or-roam2-v2">one of the gibub pages</a> for Doom emacs describes how you can make the switch. You have the option to stick with org-roam V1, but that version is no longer actively maintained. Making the switch to org-roam V2 basically involves changing a flag in your init.el file from <code class="language-plaintext highlighter-rouge">+roam</code> to <code class="language-plaintext highlighter-rouge">+roam2</code>. However, for org-roam-bibtex to work, you will need to make additional changes to your config (the config.el file). It is a good idea to check the new README at <a href="https://github.com/org-roam/org-roam-bibtex">the org-roam-bibtex repository</a>, as well as <a href="https://github.com/org-roam/org-roam-bibtex/blob/master/doc/orb-manual.org">the manual</a>. One of the more important changes is that org-roam-bibtex now uses an org-roam-capture template, instead of using its own capture templates.</p> <p>You will also find that <a href="https://github.com/org-roam/org-roam-server">org-roam-server</a> (a plugin that I did not discuss in the post below, but that I did occasionally use) does not work with org-roam V2. However, the author of org-roam-server points to an excellent alternative, called <a href="https://github.com/org-roam/org-roam-ui">org-roam-ui</a>. Make sure that you <em>carefully</em> follow the installation instructions for Doom emacs that are provided in the <a href="https://github.com/org-roam/org-roam-ui">README</a> of the repository.</p> <p>You will find a working configuration in the doom folder of <a href="https://github.com/WouterSpekkink/dotfiles">my dotfiles</a>.</p> <p>I also came across a blog post in which <a href="https://blog.tecosaur.com/tmio/2021-07-31-citations.html">org-cite</a> was announced. This is something I have not delved into yet, but when I briefly scanned the post, it seemed like org-cite is a more powerful ‘org-ecosystem’ citation solution. I have <a href="https://irreal.org/blog/?p=9895">also read</a> that the author of the <a href="https://github.com/jkitchin/org-ref">org-ref</a> mode started porting org-ref to org-cite with <a href="https://github.com/jkitchin/org-ref-cite">org-ref-cite</a>. This is exciting stuff that I still need to look into.</p> <h2 id="adding-to-what-is-already-out-there">Adding to what is already out there</h2> <p>I spent some hours in the past couple of days writing a paper on Q-SoPrA (finally), and I wanted a break from that. However, I am not very good at doing nothing, so my break consists of simply writing something else; something a bit lighter. I had thought about writing some posts about my workflow(s), so I thought I could use my break to start working on that. And then I thought it would perhaps be nice to write something about how I actually go about writing papers nowadays. That is what you’ll read about in the below.</p> <blockquote> I wrote this in a bit of a rush. I will revisit this post a couple of times to fix inevitable language mistakes and typos. It is also likely that some parts need further clarification. </blockquote> <p>The idea to write a post like this is not original. In fact, there is already a very helpful <a href="https://jonathanabennett.github.io/blog/2019/05/29/writing-academic-papers-with-org-mode/">blog post</a> on writing academic papers with <a href="https://orgmode.org/">org-mode</a> that has helped me develop my own workflow for paper writing. At the same time, there is not much else that I could find. There were some things in the example linked above that did not really work for me and that I decided to do slightly differently. For some of this I had to cobble together some ideas from various pages where org-mode is discussed. One such page is of course the <a href="https://orgmode.org/manual/">org-mode manual</a>. Other pages include discussions I found on Stack Overflow and LaTeX Stack Exchange, but I don’t remember all the specific pages I consulted on this.</p> <p>I wanted to write this post to provide another source of inspiration on how to use org-mode for academic paper writing, hopefully providing some additional snippets of information that you couldn’t already find tied together in another post.</p> <h2 id="the-intended-audiences-and-how-they-should-read-this-blog-post">The intended audience(s) and how they should read this blog post</h2> <p>I imagine that there are four possible types of audiences for the text below. I assume all these types consist of people that either work in academia, or have an interest in academia. Within that range, the five types of audiences I imagine would be interested in reading this post are:</p> <ol> <li>People that have no idea what org-mode is. The same people are unlikely to know what emacs is (org-mode was developed as an extension of emacs). People in this audience are probably used to writing their academic papers in office-like software, such as Microsoft Word or LibreOffice Writer. They may have found their way to this post because they’re interested in exploring something new. If you belong to this audience, I suggest that you keep on reading the first few parts of this post. If you’re still interested after that, keep on reading the rest.</li> <li>People that may have heard about emacs and org-mode, but haven’t given it a try yet. I imagine that some of these people currently write in LaTeX, or perhaps something like markdown. They may have found their way here while exploring alternatives to that. If you belong to this audience, I suggest you skim through the next part. There is a small bit where I briefly discuss some of the benefits of org-mode over LaTeX. I think LaTeX is awesome, but org-mode makes working with LaTeX a bit more pleasurable (at least for me). I should also add that I think writing academic papers with org-mode is a lot easier if you already have some experience with LaTeX.</li> <li>People that already work with emacs, perhaps also with org-mode. Maybe these people already use org-mode to organize their to-do lists and agendas, but they haven’t used org-mode yet to write papers. Or maybe they <em>do</em> write papers with org-mode, but they are simply interested in reading how others organize their paper-writing-workflow. If you belong to this audience, I suggest to skip over to the part where I discuss my setup in detail. I hope you’ll find something useful there.</li> <li>People that are emacs and org-mode veterans that come here to cringe at an attempt at an informative post by someone with limited experience with emacs and org-mode. If you belong to this audience I don’t expect you’ll learn anything new from this post, but maybe you want to help me out. In that case, just skim through everything and if you see me write dumb stuff, feel free to point it out by dropping me an email.</li> </ol> <p>Okay, I guess there is actually a fifth audience, which would be the people that know emacs, but dislike it because it is <a href="https://www.reddit.com/r/emacs/comments/8gdk9p/is_emacs_bloated/">bloat</a>. If you belong to that audience, you could skim through the next bit, where I dedicate about 2 sentences to this discussion, and then direct your hate mail to my email address.</p> <h2 id="start-here-if-you-dont-know-what-emacs-is">Start here if you don’t know what emacs is</h2> <p>Let’s start with <a href="https://www.gnu.org/software/emacs/">emacs</a>. I find it tricky to accurately describe what emacs is, because, in a way, it is many things at the same time, depending on how you set it up and use it. However, I think I would settle on a description of emacs as a lisp-interpeter, as well as an ecosystem of tools that together constitute an integrated development environment. Emacs can be configured and extended with a <a href="https://en.wikipedia.org/wiki/Emacs_Lisp">dialect of lisp</a>, which is a programming and scripting language (you’ll see plenty of that in snippets below). I use emacs to write software, to read my email, to organize my to-do lists (actually, this is an org-mode thing that I won’t discuss here), to keep notes on papers, to keep a journal with ideas that I am afraid I would otherwise forget about, and several other things. It is usually the first thing that I load up after booting into Linux and probably the software that I spend most time ‘in’. Emacs has been around for <a href="https://en.wikipedia.org/wiki/Emacs">a long time</a> and is still being actively developed today, which I believe is testimony to its incredible power.</p> <p>There are plenty of Linux-enthusiasts that don’t like emacs at all, for example because they feel it goes against the UNIX philosophy that software tools should <a href="https://en.wikipedia.org/wiki/Unix_philosophy#Do_One_Thing_and_Do_It_Well">“do one thing and do it well”</a>. In other words, in their opinion emacs is bloat. As I mentioned before, emacs does indeed try to be a lot of things at the same time. However, in the above, I consciously described emacs as “an ecosystem of tools”, because I think emacs can be seen as a collection of lisp-based tools that each do one thing (and do it well), but that can interact in various ways to make them do whatever you want emacs to do. I think you could even use emacs as a kind of Operating System if you wanted (I am not sure why you would, though). The benefit of having all these tools work together in one ecosystem is that they often work together well ‘out of the box’.</p> <p>Emacs is highly configurable, so there are many different ways in which Emacs can be set up. Obviously, I am not going to discuss all of that in detail. What I do want to note here is that I use a particular ‘flavor’ of emacs that is known as <a href="https://github.com/hlissner/doom-emacs/">Doom emacs</a>. Doom emacs has a number of benefits over ‘vanilla emacs’, such as a tight package management system and a pre-configured setup that just does a lot of things ‘right’. I also like that it makes use of evil-mode, which more or less means that it works with <a href="https://www.vim.org/">vim</a> keybindings. However, that is a story for another time.</p> <h2 id="org-mode-as-a-powerful-extension-of-emacs">Org-mode as a powerful extension of emacs</h2> <p><a href="https://orgmode.org/">Org-mode</a> is a popular extension of emacs which revolves around a flexible structured plain text format. You can use it to manage to-do lists, for agenda and/or project management, to keep notes, as well as a wide range of writing applications (among others!). Org-mode has an ecosystem of its own, which means that it is highly extensible itself. For example, in the below I write a few things about <a href="https://github.com/jkitchin/org-ref">org-ref</a>, <a href="https://github.com/weirdNox/org-noter">org-noter</a> and <a href="https://www.orgroam.com/">org-roam</a>, which all play a role in my writing process. I combine these tools with others that are not specifically org-mode-related. For example, to read pdfs in emacs, I make use of <a href="https://github.com/politza/pdf-tools">pdf-tools</a>, and I use <a href="https://github.com/tmalsburg/helm-bibtex">helm-bibtex</a> (in combination with <a href="https://www.zotero.org/">Zotero</a>) to navigate my library of publications and find citations to insert. I will discuss all of that in more detail further below.</p> <p>But let’s take a few steps back first. So, org-mode is a flexible structured plain text format, one that includes a markup language similar to that of <a href="https://ourcodingclub.github.io/tutorials/git/">markdown</a> (which is the markup language in which I am writing this blog post right now). What does that mean? Well, I can do things like encapsulating text in asterisks (*) if I want to make that text bold and encapsulating text in forward slashes (/) if I want to make that text italic. I can make headings by starting a line with an asterisk followed by a space. If I want to make a heading at a lower level, I simply add more asterisks. I can also make (numbered) lists and these can be nested. And this is only the simple stuff. As an example of something more advanced, org-mode offers <a href="https://orgmode.org/worg/org-tutorials/tables.html">very powerful support for tables</a>. You can even use formulas in tables, similar to what you can do in Microsoft Excel or LibreOffice Calc.</p> <p><strong>All of that in plain text.</strong></p> <p>A typical org file might look something like the following:</p> <figure class="highlight"><pre><code class="language-org" data-lang="org">* This is a level 1 heading
** This is a level 2 heading
A paragraph doesn't necessarily need any markup language.
You could write each sentence on its own line. 
Upon exporting, these lines will be put together in a paragraph.

To start a new paragraph you simply insert an empty line before it.
Lines of text that don't have empty lines between them are treated as a single paragraph.

Text can be *bolded* or in /italic/, among other things, using simple markup.

- This is a list entry
- This is another list entry
  + Lists can be nested.

We can also have numbered lists, like so:
1. This is a numbered list entry
2. Here is another one.
   a. Of course we can also nest numbered lists.

I don't actually have to type all these numbers.
When making a list, I simply press CTRL+Return to add a new entry to the list.
I can press the TAB button to indent the list (make a nested entry).

To make a table, we can simply encapsulate text in lines and pipe symbols:

|--------------------+--------------------------|
| *This is a header* | *This is another header* |
|--------------------+--------------------------|
| This is a cell     | This is another cell     |
|--------------------+--------------------------|
| And so on...       |                          |
|--------------------+--------------------------|

When altering an entry in a table, I can move to another cell by pressing tab, and the table will 
automatically be reformatted to look 'fancy' again.
New cells will also be added upon pressing tab if your cursor is in the bottom-right cell.</code></pre></figure> <p>After writing a document in org-mode, you’ll often want to export them to some other format. Org-mode in emacs provides a powerful exporting engine for this, but you could also use <a href="https://pandoc.org/">pandoc</a>. With emacs’ export engine, you can, for example, export an org-mode document to a beautifully formatted pdf. In the process, the document will first be exported to TeX as an intermediary step, so if you are familiar with LaTeX, you’ll know what nice outputs you could make with org-mode in this way.</p> <h2 id="wait-why-on-earth-would-you-want-this">Wait! Why on earth would you want this?</h2> <p>Some of you might think: “What’s the point? What benefit does this give you over Microsoft Word or LibreOffice Writer, in which you can do most of these things?” You might also think that plain text looks ugly (I don’t; I’ve come to love it) and you’d rather see what you get, as you do in Microsoft Word, rather than first having to export to some other format before you see what it’ll eventually look like.</p> <p>Know that there are certain benefits to working in a plain text format like the org format. First, it makes version control much easier. For example, I use Github for version control, which means that after each time I that I add bits and pieces to a paper (usually at the end of the day), I push a commit to github. This allows me to keep track of all the changes I make between versions, without having to explicitly save a new version of my document whenever I want to make a new version, and without the risk of accidentally overwriting changes that I might later regret. If you want to know more about this approach to version control, there are plenty of places to read more about it, such as <a href="https://ourcodingclub.github.io/tutorials/git/">here</a>. One thing to note is that this approach to version control only works well if you work in plain text.</p> <blockquote> Note that, with "version control", I mean something different than simply saving changes to your document on a regular basis. You should of course always do that to ensure that you don't accidentally lose a lot of work. My purpose with versioning of papers is not to keep track of each and every small change that I make, but to keep track of the larger chunks of text that I change over time. I might decide that a certain idea doesn't work well and that I want to revert to an alternative idea that I tried earlier. In that case it is nice to know that I have a version of that somewhere on my Github repository. </blockquote> <p>Second, as I mentioned previously, you can export org-formatted documents to many other formats, including odt, docx, TeX, and (via TeX) pdf. You don’t get this kind of flexibility with Microsoft Word or LibreOffice Writer. Moreover, because the text is <strong>plain</strong> text with some simple markup added to it, it is relatively easy anyway to reuse the text in another format. This could just be a matter of slightly changing the markup. However, I would just use <a href="https://pandoc.org/">pandoc</a> for this most of the time.</p> <p>Third, since you’re working in plain text, you don’t need a dedicated editor. Sure, writing org-mode in emacs makes a lot of things easier, but in principle there is nothing to stop you from using any other text editor. This means that you don’t depend on one or a few software packages. Also, because (again) we are working in <strong>plain</strong> text, it is unlikely that at some point you won’t be able to open your document anymore because it was written with outdated software. I guarantee you that plain text editors will be around for a loooooooong time.</p> <p>That being said, my purpose with this post is not to convince you of using org-mode. In fact, there are plenty of downsides to it too. For me, one of the most important ones is that none of my colleagues works with org-mode. In fact, I doubt they ever heard of emacs or org-mode. This is of course unproblematic if you mostly write by yourself, but it <em>is</em> problematic if you frequently write with others, which is true for me. This downside is compounded by the fact that my university more or less forces you to work with Windows and Office365, unless you choose to work on your own machine. The result is that everybody is socialized into using the same set of tools, and trying to work around this quickly becomes cumbersome.</p> <p>However, despite these downsides, I find myself using org-mode whenever I can. I like the fact that I can just focus on writing without too many distractions. I also like the fact that, with a few keystrokes, I can…</p> <ul> <li>find papers to consult.</li> <li>then read the pdfs of those papers in the same software that I use for writing.</li> <li>add a citation to a paper.</li> <li>open the pdfs attached to any of my citations.</li> <li>quickly consult my notes on other papers (made with <a href="https://github.com/weirdNox/org-noter">org-noter</a>), or other notes that I made, for example with <a href="https://www.orgroam.com/">org-roam</a>.</li> <li>export my work to different formats, such as docx or pdf, where they immediately look nicely formatted without doing extra work.</li> <li>completely change that formatting by altering just a few lines of export settings.</li> <li>have auto-generated and -formatted bibliographies based on the citations I included in my paper.</li> <li>easily include figures in my paper (including pdfs of figures) without having to worry about where exactly to place them (this is something I really hate about Office programs).</li> <li>Include TODO notes in my papers that show up in my agenda.</li> <li>use the very powerful vim-keybindings.</li> </ul> <p>There might be things I forget right now. More generally speaking, I somehow find working in emacs and org-mode much more satisfying than working in Word, and I often find myself looking for ways to work around Office-based programs more than I already do.</p> <h2 id="why-dont-you-just-use-latex">Why don’t you just use LaTeX?</h2> <p>Some of the things I outline above are things that others use LaTeX for. I already mentioned you can make beautifully formatted text with LaTeX and org-mode exports to pdf <em>via</em> TeX. So why wouldn’t you just work in LaTeX directly?</p> <p>Well, I love LaTeX, and I worked in it for a while, but LaTeX markup is quite elaborate and, in my opinion, a bit distracting. I often found myself going back to tex documents that I wrote earlier, for example to remember how I got my figures to come out the way I liked it. Org-mode’s markup is much cleaner and intuitive. Also, if you really want to just insert ‘plain’ LaTeX in some places, you an easily do that. You could say that org-mode makes working with LaTeX a lot easier.</p> <p>Also, exporting to pdf from org-mode takes just one command. In LaTeX you would need to run a LaTeX compiler, then typically BibTeX to resolve the linkages to citations, then the LaTeX compiler again… When you export to pdf from org-mode, all that needs to be done as well, and you actually add additional steps because it first needs to export from org to tex. However, emacs does all of this for you in the background. You don’t need to worry about it.</p> <blockquote> Org-mode does not provide the possibility to directly export to docx. You can of course export to odt and then save your file as docx. However, I've noticed that exporting from org-mode to odt does not work well if you want to include a bibliography. I think the easiest way to convert from org tot docx is to use pandoc. If you use the `--citeproc` argument, you can also get the bibliography exported properly. </blockquote> <h2 id="my-setup-start-here-if-you-skipped-over-the-first-parts">My setup (start here if you skipped over the first parts)</h2> <p>So let’s get into the details of my setup. I’ll (roughly) discuss the following:</p> <ol> <li>Setting up an org-mode document for exporting to LaTeX</li> <li>Citation management</li> <li>Managing notes that you might use for your papers.</li> </ol> <blockquote> Please note that some snippets of my emacs config file below will only work for you if you use Doom emacs. My config file makes use of macros that are specific to Doom emacs, such as `after!`. However, if you are familiar with emacs, and you don't want to use Doom emacs, it should be relatively easy to adjust my examples. </blockquote> <h3 id="a-template-for-papers">A template for papers</h3> <p>I made a template for papers that I can reuse. The template looks more or less like the below.</p> <figure class="highlight"><pre><code class="language-org" data-lang="org">#+TITLE: Your title goes here
#+OPTIONS: toc:nil author:nil
#+LaTeX_CLASS: apa6
#+LaTeX_CLASS_OPTIONS: [a4paper]
#+LaTeX_HEADER: \author{author name}
#+LaTeX_HEADER: \affiliation{author affiliation}
#+LaTeX_HEADER: \leftheader{With the apa6 class, it is good idea to customize the left header here}
#+LaTeX_HEADER: \shorttitle{Your short title goes here}
#+LaTeX_HEADER: \usepackage{breakcites}
#+LaTeX_HEADER: \usepackage{apacite}
#+LaTeX_HEADER: \usepackage{natbib}
#+LaTeX_HEADER: \usepackage{paralist}
#+LaTeX_HEADER: \let\itemize\compactitem
#+LaTeX_HEADER: \let\description\compactdesc
#+LaTeX_HEADER: \let\enumerate\compactenum
#+LaTeX_HEADER: \abstract{Your abstract goes here}
#+LaTeX_HEADER: \keywords{Your keywords go here}


* Introduction
And now just type away!
# Everything with a "# " (don't forget the space) before it is a comment and is ignored when exporting to pdf.

** This is a sub-heading!
Remember our lists?
- Here is a list entry
- Here is another one

# Don't forget to add the bibliography by the end.
bibliographystyle:apacite
bibliography:/path/to/library.bib</code></pre></figure> <p>So, what do we have here? At the top of the file we see a kind of preamble. Org documents often include some <a href="https://orgmode.org/manual/Export-Settings.html">export settings</a> in their preamble. I call this a preamble, but you can actually put these export settings anywhere in your file.</p> <p>Note that a lot of my export settings are actually LaTeX headers. This is the kind of stuff that you would also put in your LaTeX preamble, which org-mode can handle for you in this case. I use these LaTeX headers to set the document type (apa6 class article, in this case), some options related to the types of citations I use, some options that are apa6 class specific, and some options to change the default behavior of the LaTeX formatting process.</p> <p>Some of these options were adopted from the example set <a href="https://jonathanabennett.github.io/blog/2019/05/29/writing-academic-papers-with-org-mode/">here</a>, such as the use of <code class="language-plaintext highlighter-rouge">\usepackage{breakcites}</code> to allow citations to word wrap, <code class="language-plaintext highlighter-rouge">\usepackage{paralist}</code>to make lists more compact (the three lines directly below this are related to this too), and <code class="language-plaintext highlighter-rouge">\usepackage{apa6}</code> for apa-compliant citations. I added <code class="language-plaintext highlighter-rouge">\usepackage{natbib}</code> to allow for <a href="http://merkel.texture.rocks/Latex/natbib.php">natbib-style citation markup</a> (see further below).</p> <p>The <a href="http://ctan.math.washington.edu/tex-archive/macros/latex/contrib/apa6/apa6.pdf">apa6 LaTeX class</a> specification uses the <code class="language-plaintext highlighter-rouge">\abstract{}</code> command to include an abstract and the <code class="language-plaintext highlighter-rouge">\keywords{}</code> command to include keywords. The class also natively supports multiple ways to report authors and affiliations. In the template, you’ll see what you’d need to include if you are the sole author of the paper. If you have two authors, you could instead use <code class="language-plaintext highlighter-rouge">\twoauthors{Author One}{Author Two}</code>. For more authors, you follow the same logic <code class="language-plaintext highlighter-rouge">\threeauthors{}{}{}</code> and so on (this class currently supports up to six authors). The same goes for affiliations: For two authors you can use <code class="language-plaintext highlighter-rouge">\twoaffiliations{}{}</code>. I noticed that the left header only shows the first author by default. I therefore included the <code class="language-plaintext highlighter-rouge">\leftheader{}</code> command so I can just customize it. The <code class="language-plaintext highlighter-rouge">\shorttitle{}</code> will be shown as the right header.</p> <p>You can also specify the author name with org-mode’s own <code class="language-plaintext highlighter-rouge">#+AUTHOR</code> export option, but I found that it quickly becomes a pain to handle authors and affiliations properly when there is more than one author. I therefore use the LaTeX headers for this instead. In that case, it is necessary to include <code class="language-plaintext highlighter-rouge">author:nil</code> in <code class="language-plaintext highlighter-rouge">#+OPTIONS</code>, because emacs may default to using the username specified in your config file as the author name, even if you didn’t include <code class="language-plaintext highlighter-rouge">#+AUTHOR</code> in your file. In that case, you will always be included as a co-author, alongside any other authors that you already specified in the LaTeX headers.</p> <p>I also set <code class="language-plaintext highlighter-rouge">toc:nil</code> to prevent a table of contents from being included.</p> <p>You should make sure to include your bibliography by the end of your document. The bibliography will appear right where you put the following lines:</p> <figure class="highlight"><pre><code class="language-org" data-lang="org">bibliographystyle:apacite
bibliography:/path/to/library.bib</code></pre></figure> <h3 id="figures-and-tables">Figures and tables</h3> <p>One thing that org-mode makes very easy to do is to add figures and tables to your paper. As I mentioned before, with LaTeX I often had to look up how to do those things properly. Org-mode is just much more intuitive in its use here.</p> <p>To include a figure, you basically just need to include a link to it. In org-mode, a link is always placed between double brackets (as shown below). You can add a caption for your figure, as well as a name that you can use for reference above the link to the figure. If you are using a multi-column document class (like apa6) and you want figures to span the full width of the page, instead of just one column, you also want to add the third option (<code class="language-plaintext highlighter-rouge">ATTR_LATEX: :float multicolumn</code>) that I have added below.</p> <figure class="highlight"><pre><code class="language-org" data-lang="org">#+CAPTION: Your figure caption goes here
#+NAME: fig:shortname
#+ATTR_LATEX: :float multicolumn
[[path/to/your/figure]]</code></pre></figure> <p>The name variable comes in useful whenever you want to refer to the figure in your text. This is something else that I find painful to do in (for example) Word documents. If you refer to your figures by numbers in your text, you have to be careful to update these numbers if something changes in the order of figures. In org-mode, you can instead refer to your figures by their label, using an internal link, and this link will automatically be resolved to a number upon exporting. So, for example, you could write something like the following in your text:</p> <figure class="highlight"><pre><code class="language-org" data-lang="org">See figure [[fig:shortname]] below.</code></pre></figure> <p>And if that figure happens to be the third figure in your document, then in the exported pdf document this will resolve to:</p> <p>“Please see figure 3 below.”</p> <p>For tables, you can simply use org-mode’s built-in table functionality, and when exporting tables will be formatted according to the specifications of whatever you’re exporting to.</p> <p>There are <a href="https://orgmode.org/manual/Tables-in-LaTeX-export.html">various ways</a> in which you can configure the way tables come out too. As with figures, you’d place these export options above your table.</p> <h3 id="setting-up-the-latex-class-in-your-config-file">Setting up the LaTeX class in your config file</h3> <p>With the information above you already know most of the basics required for writing a document in org-mode that can be exported as a pdf (via LaTeX).</p> <p>For the exporting via LaTeX to work properly, you’ll need to set up the LaTeX classes that you plan to use, which you do in your emacs config.el file. This is just something I shameless copied from the <a href="https://jonathanabennett.github.io/blog/2019/05/29/writing-academic-papers-with-org-mode/">example</a> that I’ve mentioned a few times before, and it works well for me.</p> <figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span class="c1">;; Set up org-mode export stuff</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-latex-classes</span>
               <span class="o">'</span><span class="p">(</span><span class="s">"apa6"</span>
                 <span class="s">"\\documentclass{apa6}"</span>
                 <span class="p">(</span><span class="s">"\\section{%s}"</span> <span class="o">.</span> <span class="s">"\\section*{%s}"</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">"\\subsection{%s}"</span> <span class="o">.</span> <span class="s">"\\subsection*{%s}"</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">"\\subsubsection{%s}"</span> <span class="o">.</span> <span class="s">"\\subsubsection*{%s}"</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">"\\paragraph{%s}"</span> <span class="o">.</span> <span class="s">"\\paragraph*{%s}"</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">"\\subparagraph{%s}"</span> <span class="o">.</span> <span class="s">"\\subparagraph*{%s}"</span><span class="p">)))</span></code></pre></figure> <p>From what I understood from the explanation offered <a href="https://orgmode.org/worg/org-tutorials/org-latex-export.html">here</a>, this maps the org-mode headings and lists (and so on) to their LaTeX equivalents.</p> <h3 id="using-citations-in-your-paper">Using citations in your paper</h3> <p>In the above we have the basics more or less covered, such as including export settings and knowing how to format a basic org file, including figures and tables. We also know how to include our bibliography, but an important topic that we <em>haven’t</em> covered yet is how to include citations in your document in the first place.</p> <p>The org-mode ecosystem includes a wonderful tool for this, which is <a href="https://github.com/jkitchin/org-ref">org-ref</a>. Org-ref depends on <a href="https://github.com/tmalsburg/helm-bibtex">helm-bibtex</a>. Helm-bibtex is a wonderful tool that you can use to browse your library of references from within emacs. If you use a citation management tool like <a href="https://www.zotero.org/">Zotero</a>, it is easy to keep a library of references that also have pdfs linked to them. You can export the library as a .bib file, which can then be read by helm-bibtex. Org-ref uses the helm-bibtex menu to search for citations that you want to insert. If you have org-ref installed, you can use the <code class="language-plaintext highlighter-rouge">C-c ]</code> keybinding to insert a citation at point. You will then be shown a list of the references included in the .bib-file that you pointed helm bibtex to (see below). The list is filtered as you type. When you press enter on any reference, it will be included in your paper. For an example, see the citation by the end of the snippet below.</p> <figure class="highlight"><pre><code class="language-org" data-lang="org">For example, if the study focuses on explaining the emergence, development and/or decline of an entity, 
it makes sense to adopt a strategy in which one defines that entity as a central subject 
and than focuses on reconstructing the events that this central subject endures or makes happen citep:Hull1975.</code></pre></figure> <p>This gives a good idea of how org-ref citations are formatted. They basically use the <a href="http://merkel.texture.rocks/Latex/natbib.php">natbib</a> format. For example:</p> <ul> <li>cite:Spekkink2016 becomes “Spekkink (2016)”;</li> <li>citep:Spekkink2016 becomes “(Spekkink, 2016)”;</li> <li>citeyearpar:Spekkink2016 becomes “(2016)”;</li> </ul> <p>And so on…</p> <p>What the snippet above doesn’t show, is that the citations in org-mode behave a bit like links. You can place your cursor on them, press return, and you’ll be shown a helm-bibtex menu as shown below (click the picture to view a larger version of it):</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/helm-bibtex_1-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/helm-bibtex_1-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/helm-bibtex_1-1400.webp"/> <img src="/assets/img/helm-bibtex_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> helm-bibtex menu </div> <p>You’ll see that you can do a number of things related to this citation, such as opening the pdf to re-read something if you need to. You can also access your notes on this paper from here (see more on that further below), you can add pre- or post-text, and a number of other things.</p> <p>For org-ref and helm-bibtex to work properly, you’ll need to put some things in your emacs config.el file. See my configuration below (and notice the comments):</p> <figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span class="c1">;; helm-bibtex related stuff</span>
<span class="p">(</span><span class="nv">after!</span> <span class="nv">helm</span>
  <span class="p">(</span><span class="nv">use-package!</span> <span class="nv">helm-bibtex</span>
    <span class="ss">:custom</span>
    <span class="c1">;; In the lines below I point helm-bibtex to my default library file.</span>
    <span class="p">(</span><span class="nv">bibtex-completion-bibliography</span> <span class="o">'</span><span class="p">(</span><span class="s">"~/Zotero/bibtex/library.bib"</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">reftex-default-bibliography</span> <span class="o">'</span><span class="p">(</span><span class="s">"~/Zotero/bibtex/library.bib"</span><span class="p">))</span>
    <span class="c1">;; The line below tells helm-bibtex to find the path to the pdf</span>
    <span class="c1">;; in the "file" field in the .bib file.</span>
    <span class="p">(</span><span class="nv">bibtex-completion-pdf-field</span> <span class="s">"file"</span><span class="p">)</span>
    <span class="ss">:hook</span> <span class="p">(</span><span class="nv">Tex</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">define-key</span> <span class="nv">Tex-mode-map</span> <span class="s">"\C-ch"</span> <span class="ss">'helm-bibtex</span><span class="p">))))</span>
  <span class="c1">;; I also like to be able to view my library from anywhere in emacs, for example if I want to read a paper.</span>
  <span class="c1">;; I added the keybind below for that.</span>
  <span class="p">(</span><span class="nv">map!</span> <span class="ss">:leader</span>
        <span class="ss">:desc</span> <span class="s">"Open literature database"</span>
        <span class="s">"o l"</span> <span class="nf">#'</span><span class="nv">helm-bibtex</span><span class="p">)</span>
  <span class="c1">;; And I added the keybinds below to make the helm-menu behave a bit like the other menus in emacs behave with evil-mode.</span>
  <span class="c1">;; Basically, the keybinds below make sure I can scroll through my list of references with C-j and C-k.</span>
  <span class="p">(</span><span class="nv">map!</span> <span class="ss">:map</span> <span class="nv">helm-map</span>
        <span class="s">"C-j"</span> <span class="nf">#'</span><span class="nv">helm-next-line</span>
        <span class="s">"C-k"</span> <span class="nf">#'</span><span class="nv">helm-previous-line</span><span class="p">)</span>
<span class="p">)</span>

 <span class="c1">;; Set up org-ref stuff</span>
 <span class="p">(</span><span class="nv">use-package!</span> <span class="nv">org-ref</span>
    <span class="ss">:custom</span>
    <span class="c1">;; Again, we can set the default library</span>
    <span class="p">(</span><span class="nv">org-ref-default-bibliography</span> <span class="s">"~/Zotero/bibtex/library.bib"</span><span class="p">))</span>
    <span class="c1">;; The default citation type of org-ref is cite:, but I use citep: much more often</span>
    <span class="c1">;; I therefore changed the default type to the latter.</span>
    <span class="p">(</span><span class="nv">org-ref-default-citation-link</span> <span class="s">"citep"</span><span class="p">)</span>

 <span class="c1">;; The function below allows me to consult the pdf of the citation I currently have my cursor on.</span>
 <span class="p">(</span><span class="nb">defun</span> <span class="nv">my/org-ref-open-pdf-at-point</span> <span class="p">()</span>
  <span class="s">"Open the pdf for bibtex key under point if it exists."</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">results</span> <span class="p">(</span><span class="nv">org-ref-get-bibtex-key-and-file</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">key</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">results</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">pdf-file</span> <span class="p">(</span><span class="nb">funcall</span> <span class="nv">org-ref-get-pdf-filename-function</span> <span class="nv">key</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">pdf-file</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">find-file</span> <span class="nv">pdf-file</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">message</span> <span class="s">"No PDF found for %s"</span> <span class="nv">key</span><span class="p">))))</span>

  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-ref-completion-library</span> <span class="ss">'org-ref-ivy-cite</span>
        <span class="nv">org-export-latex-format-toc-function</span> <span class="ss">'org-export-latex-no-toc</span>
        <span class="nv">org-ref-get-pdf-filename-function</span>
        <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">key</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nv">bibtex-completion-find-pdf</span> <span class="nv">key</span><span class="p">)))</span>
        <span class="c1">;; See the function I defined above.</span>
        <span class="nv">org-ref-open-pdf-function</span> <span class="ss">'my/org-ref-open-pdf-at-point</span>
        <span class="c1">;; For pdf export engines.</span>
        <span class="nv">org-latex-pdf-process</span> <span class="p">(</span><span class="nb">list</span> <span class="s">"latexmk -pdflatex='%latex -shell-escape -interaction nonstopmode' -pdf -bibtex -f -output-directory=%o %f"</span><span class="p">)</span>
        <span class="c1">;; I use orb to link org-ref, helm-bibtex and org-noter together (see below for more on org-noter and orb).</span>
        <span class="nv">org-ref-notes-function</span> <span class="ss">'orb-edit-notes</span><span class="p">)</span></code></pre></figure> <p>Some of this configuration involves pointing helm-bibtex and org-ref to my default library.bib file. I also had to add several lines to make sure that (1) helm-bibtex knows where to find the path to pdf files in the library.bib file, (2) org-ref is able to find the pdf file associated with the citation that I have my cursor on and (3) org-ref is then able to open that file. I am not entirely sure, but I believe the default behavior was for org-ref to open the pdf in an external viewer. My configuration also makes org-ref open pdfs in emacs instead.</p> <h3 id="using-pdf-tools">Using pdf-tools</h3> <p>Since I’ve mentioned the possibility to open pdfs a couple of times, this as a good a place as any to bring up that I use <a href="https://github.com/politza/pdf-tools">pdf-tools</a> to read pdfs instead of emacs’ default doc-viewer. In pdf-tools, pdfs look much better than in doc-viewer. In addition, pdf-tools comes with some annotation tools, although I don’t use those myself.</p> <p>To use pdf-tools as the default viewer, you can add the folowing lines to your config (keep in mind that the below is specific to Doom emacs configs):</p> <figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span class="c1">;; This is to use pdf-tools instead of doc-viewer</span>
<span class="p">(</span><span class="nv">use-package!</span> <span class="nv">pdf-tools</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">pdf-tools-install</span><span class="p">)</span>
  <span class="c1">;; This means that pdfs are fitted to width by default when you open them</span>
  <span class="p">(</span><span class="nv">setq-default</span> <span class="nv">pdf-view-display-size</span> <span class="ss">'fit-width</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="p">(</span><span class="nv">pdf-annot-activate-created-annotations</span> <span class="no">t</span> <span class="s">"automatically annotate highlights"</span><span class="p">))</span></code></pre></figure> <h3 id="consulting-notes-on-papers">Consulting notes on papers</h3> <p>So far, so good. We now know how to write basic documents in org-mode, and we’re able to use org-ref (with helm-bibtex) to insert and alter references, and to open the pdf files associated with them.</p> <p>Let’s stick with org-ref and helm-bibtex for a bit longer. Let’s say that you’ve kept notes on the papers that you want to cite in your own paper. You might want to consult those notes while writing. Here too, I find it convenient to be able to do this within the program that I am doing my writing in. That is why I use <a href="https://github.com/weirdNox/org-noter">org-noter</a> to keep notes on my papers, and I use <a href="https://github.com/org-roam/org-roam-bibtex">org-roam-bibtex</a> (orb) to link org-noter and helm-bibtex together. This is a topic that is discussed in detail in <a href="https://rgoswami.me/posts/org-note-workflow/">this blog post</a>, so I won’t cover everything in detail here.</p> <p>Very briefly then: org-noter is an emacs package that you can use to keep notes on pdfs in an org document. It works together quite well with the pdf-tools package that I mention above. Basically, with org-noter you can read a pdf, and have your notes document open beside it. You can write notes that are associated with particular pages in the pdf document, as well as notes that are associated with particular locations on pages. If you then browse through your notes, org-noter will automagically bring up the page (or location) of the pdf document that the note is associated with. It looks a bit like this:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/org-noter_1-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/org-noter_1-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/org-noter_1-1400.webp"/> <img src="/assets/img/org-noter_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> org-noter </div> <p>In the image, you see the pdf on the left, and you see the notes I wrote on this pdf on the right. Each of those notes is related to a particular location in the document, which I can find back easily by jumping back and forth between my notes.</p> <p>See my org-noter configuration below:</p> <figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"> <span class="c1">;; org-noter stuff</span>
  <span class="p">(</span><span class="nv">after!</span> <span class="nv">org-noter</span>
    <span class="p">(</span><span class="k">setq</span>
          <span class="nv">org-noter-notes-search-path</span> <span class="o">'</span><span class="p">(</span><span class="s">"~/org-roam/"</span><span class="p">)</span>
          <span class="nv">org-noter-hide-other</span> <span class="no">nil</span>
          <span class="nv">org-noter-separate-notes-from-heading</span> <span class="no">t</span>
          <span class="nv">org-noter-always-create-frame</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">map!</span>
     <span class="ss">:map</span> <span class="nv">org-noter-doc-mode-map</span>
     <span class="ss">:leader</span>
     <span class="ss">:desc</span> <span class="s">"Insert note"</span>
     <span class="s">"m i"</span> <span class="nf">#'</span><span class="nv">org-noter-insert-note</span>
     <span class="ss">:desc</span> <span class="s">"Insert precise note"</span>
     <span class="s">"m p"</span> <span class="nf">#'</span><span class="nv">org-noter-insert-precise-note</span>
     <span class="ss">:desc</span> <span class="s">"Go to previous note"</span>
     <span class="s">"m k"</span> <span class="nf">#'</span><span class="nv">org-noter-sync-prev-note</span>
     <span class="ss">:desc</span> <span class="s">"Go to next note"</span>
     <span class="s">"m j"</span> <span class="nf">#'</span><span class="nv">org-noter-sync-next-note</span>
     <span class="ss">:desc</span> <span class="s">"Create skeleton"</span>
     <span class="s">"m s"</span> <span class="nf">#'</span><span class="nv">org-noter-create-skeleton</span>
     <span class="ss">:desc</span> <span class="s">"Kill session"</span>
     <span class="s">"m q"</span> <span class="nf">#'</span><span class="nv">org-noter-kill-session</span>
     <span class="p">)</span>
  <span class="p">)</span></code></pre></figure> <p>The most important thing is that you need to tell org-noter what the default location of your notes is. In my case, I include my notes in my org-roam folder (we’ll discuss org-roam soon). I also added a bunch of keybinds that I use to insert and navigate notes.</p> <p>Org-noter doesn’t integrate with helm-bibtex out of the box. That is what you can use <a href="https://github.com/org-roam/org-roam-bibtex">orb</a> for. One very important thing that orb does is to tell helm-bibtex to use org-noter as the default note-keeping package. It also integrates org-noter with org-roam (again, we’re getting to org-roam soon).</p> <p>See my config snippet for orb below. It is an altered version of what I copied from <a href="https://rgoswami.me/posts/org-note-workflow/">another post</a> about this.</p> <figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"> <span class="c1">;; org-roam-bibtex stuff</span>
  <span class="p">(</span><span class="nv">use-package!</span> <span class="nv">org-roam-bibtex</span>
    <span class="ss">:hook</span> <span class="p">(</span><span class="nv">org-roam-mode</span> <span class="o">.</span> <span class="nv">org-roam-bibtex-mode</span><span class="p">))</span>

  <span class="p">(</span><span class="k">setq</span> <span class="nv">orb-preformat-keywords</span>
        <span class="o">'</span><span class="p">(</span><span class="s">"citekey"</span> <span class="s">"title"</span> <span class="s">"url"</span> <span class="s">"author-or-editor"</span> <span class="s">"keywords"</span> <span class="s">"file"</span><span class="p">)</span>
        <span class="nv">orb-process-file-keyword</span> <span class="no">t</span>
        <span class="nv">orb-file-field-extensions</span> <span class="o">'</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">))</span>

  <span class="p">(</span><span class="k">setq</span> <span class="nv">orb-templates</span>
        <span class="o">'</span><span class="p">((</span><span class="s">"r"</span> <span class="s">"ref"</span> <span class="nv">plain</span><span class="p">(</span><span class="k">function</span> <span class="nv">org-roam-capture--get-point</span><span class="p">)</span>
           <span class="s">""</span>
           <span class="ss">:file-name</span> <span class="s">"${citekey}"</span>
           <span class="ss">:head</span> <span class="s">"#+TITLE: ${citekey}: ${title}\n#+ROAM_KEY: ${ref}
- tags ::
- keywords :: ${keywords}

* Notes
:PROPERTIES:
:Custom_ID: ${citekey}
:URL: ${url}
:AUTHOR: ${author-or-editor}
:NOTER_DOCUMENT: ${file}
:NOTER_PAGE:
:END:"</span><span class="p">)))</span></code></pre></figure> <p>The first few lines are basically required to get orb to work with org-roam.</p> <p>The most important lines are the ones below that. The <code class="language-plaintext highlighter-rouge">orb-templates</code> function basically creates the templates of the files that you use to record your notes on pdfs with. I only have one template and at the bottom of the snippet you’ll see what is included in it (e.g., a url to the file, the author). You have to define the keywords included in the template with the <code class="language-plaintext highlighter-rouge">orb-preformat-keywords</code> function.</p> <p>With these settings, if I navigate to a reference in helm-bibtex, and then tell helm-bibtex to open my notes on that reference, it will create a new file (if a file on that reference does not already exist) which is preformatted according to the template defined above.</p> <p>In other words, whenever I am writing a paper, I can easily consult my notes on another paper by opening up helm-bibtex, navigating to the paper I want to consult the notes on, and then pressing F9 (or simply choosing ‘‘add notes’’ from the helm-bibtex menu). Combined with the things I mentioned earlier: For any citation in my paper I can quickly open the pdf of that citation as well as my notes on that paper within a few seconds, and all within the same program.</p> <h3 id="org-roam">Org-roam</h3> <p>Not all notes that are relevant to the paper I am writing are necessarily notes on ‘another paper’. They might just be notes on an idea that I wrote up a while ago. They might also be more elaborate notes that I kept on a certain topic and that relate to multiple papers at the same time. I might want to consult these notes too.</p> <p>In addition, I might want to be able to link my notes on one paper to notes that I made on another paper, or to notes that I wrote on a broader topic.</p> <p>This is (more or less) where <a href="https://www.orgroam.com/">org-roam</a> comes in. There is a lot to be said about org-roam itself, but I don’t want to get lost in the details here. Briefly, org-roam allows you to build a kind of <a href="https://fortelabs.co/blog/basboverview/">‘second brain’</a>. It is an approach to taking notes that makes use of the <a href="https://en.wikipedia.org/wiki/Zettelkasten">Zettelkasten method</a>. The idea behind that method is more or less that you keep relatively short notes that you explicitly link to other short notes. Together, the notes form a horizontal network of notes that can be quickly navigated.</p> <p>So, whenever you are writing a note on something, you will want to link it to notes on other ideas that you think are associated to the topic you are currently writing a note on. An excellent discussion of that principle is offered <a href="https://blog.jethro.dev/posts/how_to_take_smart_notes_org/">here</a>.</p> <p>Org-roam itself provides a powerful infrastructure that implements this approach to note-taking. A key element of it is the use of a buffer that gives you an overview of all the notes that are linked to the note you are currently inspecting (see below for an example; the overview buffer is on the right).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/social_practice_theory-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/social_practice_theory-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/social_practice_theory-1400.webp"/> <img src="/assets/img/social_practice_theory.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example of org-noter in action </div> <p>If you keep this approach to note-taking up for a while, you’re slowly but surely building a network of notes. Basically, you are building your own wiki.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/org-roam-network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/org-roam-network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/org-roam-network-1400.webp"/> <img src="/assets/img/org-roam-network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> org-roam network </div> <p>My network of notes includes notes on various broader topics (such as the notes on social practice theory of which I included a screenshot above), notes on projects that I am working on, notes that I took on a particular day (e.g., ideas I didn’t want to forget about or perhaps notes on a meeting I had on that day), and of course my notes on papers.</p> <p>What makes org-roam so powerful is that you can quickly (re)trace the associations between ideas that you made notes on. You might open a document with notes that you made on a particular paper, then follow the links to other notes that might seem interesting for whatever you are currently writing on, and so on and so forth.</p> <p>This could even be a viable approach to outlining your initial ideas for a new paper, similar to what is shown in <a href="https://www.youtube.com/watch?v=RvWic15iXjk">this video</a>, which uses the software that inspired org-roam.</p> <p>See my basic org-roam config below.</p> <figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span class="c1">;; org-roam related things</span>
<span class="p">(</span><span class="nv">after!</span> <span class="nv">org-roam</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-roam-directory</span> <span class="s">"~/org-roam"</span><span class="p">)</span>

  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'after-init-hook</span> <span class="ss">'org-roam-mode</span><span class="p">)</span>

  <span class="c1">;; Let's set up some org-roam capture templates</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-roam-capture-templates</span>
        <span class="p">(</span><span class="k">quote</span> <span class="p">((</span><span class="s">"d"</span> <span class="s">"default"</span> <span class="nv">plain</span> <span class="p">(</span><span class="k">function</span> <span class="nv">org-roam--capture-get-point</span><span class="p">)</span>
                 <span class="s">"%?"</span>
                 <span class="ss">:file-name</span> <span class="s">"%&lt;%Y-%m-%d-%H%M%S&gt;-${slug}"</span>
                 <span class="ss">:head</span> <span class="s">"#+title: ${title}\n"</span>
                 <span class="ss">:unnarrowed</span> <span class="no">t</span><span class="p">)</span>
                <span class="p">)))</span>

  <span class="c1">;; And now we set necessary variables for org-roam-dailies</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-roam-dailies-capture-templates</span>
        <span class="o">'</span><span class="p">((</span><span class="s">"d"</span> <span class="s">"default"</span> <span class="nv">entry</span>
           <span class="nf">#'</span><span class="nv">org-roam-capture--get-point</span>
           <span class="s">"* %?"</span>
           <span class="ss">:file-name</span> <span class="s">"daily/%&lt;%Y-%m-%d&gt;"</span>
           <span class="ss">:head</span> <span class="s">"#+title: %&lt;%Y-%m-%d&gt;\n\n"</span><span class="p">))))</span></code></pre></figure> <p>What I do here is to first point to my org-roam directory, which is a folder without any sub-folders (except for one subfolder in which I keep my ‘daily’ notes, which are structured more like a journal) where I keep all my notes (including the ones made with org-noter). I make sure that org-roam runs on emacs startup, and then I define two kinds of templates. These templates define the names of the files to keep your notes in, as well as the basic contents of these files.</p> <p>The first template is the template for my general notes. These notes are kept in files with the date and time of their creation, followed by a short title that I type when creating the note. The file itself only includes a title, and nothing else.</p> <p>The second template is the template for my org-roam-dailies, which is basically a journal-type note, associated with a particular date. These files simply have the date on which they were made as their filename, and in this case too, the file itself includes nothing but the title of the file.</p> <p>Whenever I am writing notes in one of these files, I can use simple keystrokes to insert links to other notes. If I insert a link to a note that doesn’t already exist, then a new file is automatically created for that note, ready to be filled at some point.</p> <h2 id="wrapping-up">Wrapping up</h2> <p>This lengthy blog posts discusses some of the key elements involved in my current paper writing process. In short, org-mode serves as its basis, but this basis is enriched with powerful tools that allow me to:</p> <ol> <li>export to different kinds of filetypes, including beautifully formatted pdfs.</li> <li>insert citations to papers in my library that are relevant to what I am currently writing on.</li> <li>read the pdfs of those papers.</li> <li>consult my notes on those papers, or write new ones.</li> <li>consult other notes that may be relevant to what I am working on that are not tied to specific papers.</li> <li>find even more potentially relevant notes, based on the links that exist between notes.</li> </ol> <p>I hope you found something useful / interesting in this post!</p>]]></content><author><name></name></author><category term="Academia"/><category term="Writing"/><category term="Tools"/><category term="Emacs"/><summary type="html"><![CDATA[EDIT (2023-01-03) I have recently migrated from Doom emacs to a vanilla emacs config. What I like about the vanilla config is that I am more in control of what it does. Doom emacs, in some respects, was a bit of a black box to me. Also, Doom emacs does a lot of things I do not actually need or want. In my original post, I linked to my dot files, which included my doom emacs config. The doom config files are still there, but not in the old_doom_config branch, instead of the master branch. My vanilla config maintains (I think) all of what I describe in my post. However, the config looks different in most places, for example because I could no longer make use of the Doom emacs macros.]]></summary></entry><entry><title type="html">A sign of life</title><link href="https://wouterspekkink.github.io/blog/2021/a-sign-of-life/" rel="alternate" type="text/html" title="A sign of life"/><published>2021-02-13T22:00:00+01:00</published><updated>2021-02-13T22:00:00+01:00</updated><id>https://wouterspekkink.github.io/blog/2021/a-sign-of-life</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2021/a-sign-of-life/"><![CDATA[<h2 id="i-was-gone-for-a-bit">I was ‘gone’ for a bit</h2> <p>The title of this blog post is a bit overly dramatic. Yet, it has been almost three years since my last blog post, so it does to some extent feel to me as if I am finally giving a sign of life after a long absence.</p> <p>There are multiple reasons why I have not updated my website (except for some minor things) in a long time. One of them is that I became a father in 2018, which of course upended all my routines. Another reason is that I have changed jobs (and countries) in 2019. There are more reasons, but not all that interesting or important.</p> <h2 id="but-i-am-reviving-this-blog">But I am reviving this blog</h2> <p>What is more important is that I would like to pick up the routine of blogging again. As before, I will probably blog quite a bit about Q-SoPrA, the software that I have been working on for a while now. The development of Q-SoPrA is another thing that got slowed down due to the various changes in my personal life. However, I have done quite some work on it, and I feel like it is probably ready for a public beta release. However, I am not going to actually release it until after I finish a publication on the software (writing publications, another thing that got slowed down). In the meantime there have been a few people that have been using it (including myself, of course). This includes a PhD student who recently graduated, as well as a master student who also recently graduated. One of my own projects in which I used Q-SoPrA was the evaluation of the development the Rotterdam Climate Agreement. We recently finished a <a href="https://WouterSpekkink.github.io/assets/pdf/rka_rapport.pdf">report</a> on this project (only available in Dutch) that includes various visualizations that I made with Q-SoPrA. Last year I was involved in a H2020 bid in which we also included Q-SoPrA as one of our main tools. The bid got excellent reviews, but when only 3 out of more than 50 bids can get funded, it becomes a bit of a lottery.</p> <p>Anyway, I expect to be using Q-SoPrA and its underlying methodology in various future projects and I still hope that Q-SoPrA will be useful to others too. I hope that picking up this blog again also gives a boost to my efforts to work towards a public release.</p> <p>As an aside, I am also thinking about blogging on other topics related to my research, although I have to admit I find that much harder to do. Maybe those posts will just be much shorter.</p> <h2 id="some-things-i-have-added-to-q-sopra">Some things I have added to Q-SoPrA</h2> <p>Anyway, I wanted to keep this one short as well. Let me close with an overview of a few (probably not all) things that I changed in Q-SoPrA in the meantime:</p> <ul> <li>I added the possibility to distinguish between multiple coders in a project. This means that there are now also (still limited) possibilities to check for inter-coder reliability. Q-SoPrA already included something like an inter-coder check for the linkages between events, but now inter-coder reliability can also be checked for <a href="/blog/2018/attributes-in-qsopra/">attributes</a>.</li> <li>I added a visualization widget to the linkage coder (I do not believe I discussed the linkage coder in detail yet; good topic for another post) to give visual feedback on the linkages that you are coding (see below).</li> <li>A added various date validation options to the <a href="/blog/2017/getting-started-with-qsopra/">data widget</a> that helps you to check the order of the incidents that you recorded in your dataset.</li> <li>I have added various options to layout events in the event graph widget (mentioned <a href="/blog/2018/attributes-in-qsopra/">here</a>) based on the date on which they occurred.</li> <li>I added various concordance plot-type visualizations. These can, for example, be used to visualize where in the dataset (and in time) codes occur. They can also be used to create quick overviews of where on a timeline events of a given type occur. I will probably show some of this off in a later post.</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/visual_feedback-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/visual_feedback-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/visual_feedback-1400.webp"/> <img src="/assets/img/visual_feedback.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Visual feedback when creating linkages. </div> <p>There is probably a lot of stuff that I forget now, because it has been a while since I have been able to actively work on Q-SoPrA.</p> <p>There is also some bigger stuff that I am actively working on in separate branches of the code repository. One of these branches implements something based on truth tables that are based of event graphs. This is related to a paper that I am collaborating on with someone who is into set theory. Anyway, hopefully I can write more on that later too.</p> <p>Actually, while writing this I realize there is plenty of stuff that could be interesting to discuss further in future blog posts.</p> <h2 id="to-be-continued">To be continued…</h2> <p>Okay, this was a short one, but my main purpose was to make a start again, and do it quick. Until the next one!</p>]]></content><author><name></name></author><category term="Software"/><category term="Q-SoPrA"/><category term="Non-Technical"/><summary type="html"><![CDATA[I was ‘gone’ for a bit The title of this blog post is a bit overly dramatic. Yet, it has been almost three years since my last blog post, so it does to some extent feel to me as if I am finally giving a sign of life after a long absence.]]></summary></entry><entry><title type="html">Drawing parallel edges in Qt</title><link href="https://wouterspekkink.github.io/blog/2018/drawing-parallel-edges-in-qt/" rel="alternate" type="text/html" title="Drawing parallel edges in Qt"/><published>2018-09-11T16:46:00+02:00</published><updated>2018-09-11T16:46:00+02:00</updated><id>https://wouterspekkink.github.io/blog/2018/drawing-parallel-edges-in-qt</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2018/drawing-parallel-edges-in-qt/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>I wrote a non-technical post on <a href="/blog/2018/relationships-in-qsopra/">relationships in Q-SoPrA</a>. One of the things I discuss there is plotting parallel edges, that is, multiple edges between the same pair of nodes. This is something I definitely wanted to be able to do, since I am interested in looking at social arrangements (of people, places, things, etc.) that can be related to each other in various ways. If I want to look at multiple relationships at the same time, being able to visualise parallel edges is a necessity. In this post I discuss some of the details of visualising parallel edges using Qt’s tools for visualisation. For a visual impression of what parallel edges look like in Q-SoPrA, see the screenshot below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/parallel_edges-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/parallel_edges-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/parallel_edges-1400.webp"/> <img src="/assets/img/parallel_edges.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Parallel edges. </div> <h2 id="some-things-we-need-for-drawing">Some things we need for drawing</h2> <p>In this post, I will be focusing almost exclusively on the drawing of edges, but I just want to briefly touch upon some of the other basic things we need in order to visualise them. Below you see a screenshot of the Network Graph Visualisation widget with all the menus unfolded. In the middle of this screenshot you see the space where the drawing actually happens. The drawing space itself is an object of the <a href="http://doc.qt.io/qt-5/qgraphicsview.html"><code class="language-plaintext highlighter-rouge">QGraphicsViews</code> class</a>, although I should add that in Q-SoPrA I use a sub-classed version in which I re-implemented many of the member functions of this class (the same goes for most other classes I discuss in this post). The <code class="language-plaintext highlighter-rouge">QGraphicsView</code> object visualises objects that are included in another object of the <a href="http://doc.qt.io/qt-5/qgraphicsscene.html"><code class="language-plaintext highlighter-rouge">QGraphicsScene</code> class</a> (a <code class="language-plaintext highlighter-rouge">QGraphicsScene</code> object needs to be assigned to the <code class="language-plaintext highlighter-rouge">QGraphicsView</code> object). These classes are quite well documented in the Qt documentation, so I will not go into details here (also see <a href="http://doc.qt.io/qt-5/graphicsview.html">this page</a> to read more about the Graphics View Framework of Qt).</p> <p>Also, I recently read <a href="http://blog.qt.io/blog/2017/01/19/should-you-be-using-qgraphicsview/">this blog post</a>, which seems to suggest that Qt Quick is a potential replacement for the Graphics View Framework.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Network_Graph_Widget-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Network_Graph_Widget-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Network_Graph_Widget-1400.webp"/> <img src="/assets/img/Network_Graph_Widget.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The Network Graph widget. </div> <p>In the screenshot we also see that we have drawn objects in the drawing space. We can see nodes, we can see edges, and we can see labels. All these objects are <em>items</em> that are currently included (and visible) in the <code class="language-plaintext highlighter-rouge">QGraphicsScene</code> object. The nodes are objects of a sub-classed version of the <a href="http://doc.qt.io/qt-5/qgraphicsitem.html"><code class="language-plaintext highlighter-rouge">QGraphicsItem</code> class</a>, the edges are objects of a sub-classed version of the <a href="http://doc.qt.io/qt-5/qgraphicslineitem.html"><code class="language-plaintext highlighter-rouge">QGraphicsLineItem</code> class</a>, and the labels are objects of a sub-classed version of the <a href="http://doc.qt.io/qt-5/qgraphicstextitem.html"><code class="language-plaintext highlighter-rouge">QGraphicsTextItem</code> class</a>.</p> <p>So, the <code class="language-plaintext highlighter-rouge">QGraphicsView</code>, the <code class="language-plaintext highlighter-rouge">QGraphicsScene</code> and the <code class="language-plaintext highlighter-rouge">QGraphicsItem</code> are the three basic types of objects that you need to make visualisations like the ones included in Q-SoPrA. The <code class="language-plaintext highlighter-rouge">QGraphicsItem</code>s are the things we want to visualise, the <code class="language-plaintext highlighter-rouge">QGraphicsScene</code> contains and manages these items, and the <code class="language-plaintext highlighter-rouge">QGraphicsViews</code> visualises the contents of the <code class="language-plaintext highlighter-rouge">QGraphicsScene</code>.</p> <h2 id="drawing-edges-some-basics">Drawing edges: some basics</h2> <p>Before I get into some specific challenges related to drawing parallel edges, it is useful to briefly discuss what goes into drawing a basic edge. There are a few basic properties of edges that we need to take into account:</p> <ol> <li>An edge is mostly a <em>line</em> with a <em>starting point</em> (the centre of a source node) and an <em>end point</em> (the centre of a target node). Where we draw an edge will depend on where its source and target nodes are located. We thus need to somehow explicitly relate source and target nodes to edges, so that the edges can check their nodes’ locations before ‘drawing themselves’.</li> <li>To indicate the direction of edges we use <em>arrowheads</em>. We thus need a way to draw these, which is a bit more complicated than just drawing a line.</li> <li>The <em>arrowhead</em> should point at the target node, which means that the <em>line</em> we attach it to should stop a small distance before it reaches its <em>end point</em>. Otherwise the arrowhead would simply overlap with the target node (see screenshot below; I set the z-level of the source node lower than that of the edge to make clear from where to where we draw the edge’s line).</li> </ol> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Wrong_Right_Edge-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Wrong_Right_Edge-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Wrong_Right_Edge-1400.webp"/> <img src="/assets/img/Wrong_Right_Edge.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> A wrong edge and a correct edge. </div> <p>In Qt’s documentation you can find the <a href="http://doc.qt.io/qt-5/qtwidgets-graphicsview-diagramscene-example.html">Diagram Scene example</a> that achieves almost exactly this (see especially the <a href="http://doc.qt.io/qt-5/qtwidgets-graphicsview-diagramscene-arrow-h.html">header file</a> and the <a href="http://doc.qt.io/qt-5/qtwidgets-graphicsview-diagramscene-arrow-cpp.html">cpp file</a> of the Arrow class used in this example). The objects that Q-SoPrA uses to draw edges are inspired by this example, although the classes ended up looking quite different due to various specific requirements I had for my own class. The class I developed is called <code class="language-plaintext highlighter-rouge">DirectedEdge</code>, and it is what I will focus upon in the remainder of this post.</p> <p>Let us first take a look at the constructor of the <code class="language-plaintext highlighter-rouge">DirectedEdge</code> class. Here is a code snippet from which I have removed some details that are not important for the examples in this post.</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">DirectedEdge</span><span class="o">::</span><span class="n">DirectedEdge</span><span class="p">(</span><span class="n">NetworkNode</span> <span class="o">*</span><span class="n">startItem</span><span class="p">,</span> <span class="n">NetworkNode</span> <span class="o">*</span><span class="n">endItem</span><span class="p">,</span> <span class="n">QString</span> <span class="n">submittedType</span><span class="p">,</span>
			   <span class="n">QString</span> <span class="n">submittedName</span><span class="p">,</span> <span class="n">QGraphicsItem</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
  <span class="o">:</span> <span class="n">QGraphicsLineItem</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="n">start</span> <span class="o">=</span> <span class="n">startItem</span><span class="p">;</span>
  <span class="n">end</span> <span class="o">=</span> <span class="n">endItem</span><span class="p">;</span>
  <span class="n">color</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">::</span><span class="n">black</span><span class="p">;</span>
  <span class="n">setPen</span><span class="p">(</span><span class="n">QPen</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">SolidLine</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">RoundCap</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">RoundJoin</span><span class="p">));</span>
  <span class="n">height</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="n">relType</span> <span class="o">=</span> <span class="n">submittedType</span><span class="p">;</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">submittedName</span><span class="p">;</span>
  <span class="n">filtered</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="n">massHidden</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="n">setFlag</span><span class="p">(</span><span class="n">QGraphicsItem</span><span class="o">::</span><span class="n">ItemSendsGeometryChanges</span><span class="p">);</span>
  <span class="n">comment</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> <p>As you can see, we are passing pointers to objects of the <code class="language-plaintext highlighter-rouge">NetworkNode</code> class to the constructor of <code class="language-plaintext highlighter-rouge">DirectedEdge</code>. The <code class="language-plaintext highlighter-rouge">NetworkNode</code> class is a sub-classed version I created of the <a href="http://doc.qt.io/qt-5/qgraphicsitem.html"><code class="language-plaintext highlighter-rouge">QGraphicsItem</code> class</a>, and I use this class to draw the nodes of my network diagrams. When we add <code class="language-plaintext highlighter-rouge">NetworkNode</code>s (or any other <code class="language-plaintext highlighter-rouge">QGraphicsItem</code> to a <code class="language-plaintext highlighter-rouge">QGraphicsScene</code> object, then these will be assigned a <em>scene position</em>, that is, a point in the scene that is defined by an x-coordinate and a y-coordinate. We can access the <em>scene position</em> of a <code class="language-plaintext highlighter-rouge">NetworkNode</code> (or other types of <code class="language-plaintext highlighter-rouge">QGraphicsItems</code>) by using the <a href="http://doc.qt.io/qt-5/qgraphicsitem.html#scenePos">‘scenePos()’ member function</a>. This will return a <a href="http://doc.qt.io/qt-5/qpointf.html">‘QPointF’ object</a> that contains the item’s coordinates. So, if we want to know from where to where to draw a certain edge, the obvious thing to do would be to first find the <em>scene positions</em> of its start node - start-&gt;scenePos() - and end node - end-&gt;scenePos() - and then draw the line between those two positions.</p> <p>As I mentioned before, we actually want our line to stop shortly before it reaches its end point. What we could do is to create a <a href="http://doc.qt.io/qt-5/qlinef.html"><code class="language-plaintext highlighter-rouge">QLineF</code> object</a>, passing our start and end points as parameters, and then use the <code class="language-plaintext highlighter-rouge">setLength()</code> function to make the line slightly shorter: <code class="language-plaintext highlighter-rouge">myLine.setLength(myLine.length() - 18)</code>.</p> <p>Then we still need to add our arrowhead. For this, I simply followed the <a href="http://doc.qt.io/qt-5/qtwidgets-graphicsview-diagramscene-example.html">Diagram Scene Example</a> provided in the online documentation for Qt. Basically, this involves creating a <a href="http://doc.qt.io/qt-5/qpolygonf.html"><code class="language-plaintext highlighter-rouge">QPolygonF</code></a> object with the shape of our arrowhead, and have this object drawn near the end point of our line.</p> <p>We should do most of the above in the <a href="http://doc.qt.io/qt-5/qgraphicsitem.html#paint">‘paint()’ function</a> of our edge, because that is the function where we determine where and how the edge is drawn. I have included a code snippet below to illustrate what our <code class="language-plaintext highlighter-rouge">paint()</code> function might look like in this scenario.</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">const</span> <span class="n">qreal</span> <span class="n">Pi</span> <span class="o">=</span> <span class="mf">3.14</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">DirectedEdge</span><span class="o">::</span><span class="n">paint</span><span class="p">(</span><span class="n">QPainter</span> <span class="o">*</span><span class="n">painter</span><span class="p">,</span> <span class="k">const</span> <span class="n">QStyleOptionGraphicsItem</span> <span class="o">*</span><span class="p">,</span> <span class="n">QWidget</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">QPen</span> <span class="n">myPen</span> <span class="o">=</span> <span class="n">pen</span><span class="p">();</span> <span class="c1">// We need to create a pen for our painter...</span>
  <span class="n">myPen</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">);</span> <span class="c1">// ...and indicate which colour it will use.</span>
  <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setPen</span><span class="p">(</span><span class="n">myPen</span><span class="p">);</span> <span class="c1">// Now we set the pen to your painter.</span>
  <span class="n">QLineF</span> <span class="n">myLine</span> <span class="o">=</span> <span class="n">QLineF</span><span class="p">(</span><span class="n">start</span><span class="o">-&gt;</span><span class="n">scenePos</span><span class="p">(),</span> <span class="n">end</span><span class="o">-&gt;</span><span class="n">scenePos</span><span class="p">());</span> <span class="c1">// Here we create our line.</span>
  <span class="n">myLine</span><span class="p">.</span><span class="n">setLength</span><span class="p">(</span><span class="n">myLine</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">20</span><span class="p">);</span> <span class="c1">// We shorten our line.</span>
  
  <span class="c1">// And then we create our arrowHead.</span>
  <span class="n">qreal</span> <span class="n">arrowSize</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">;</span>
  <span class="n">QPointF</span> <span class="n">arrowP1</span> <span class="o">=</span> <span class="n">myLine</span><span class="p">.</span><span class="n">p2</span><span class="p">()</span> <span class="o">-</span> <span class="n">QPointF</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">Pi</span> <span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrowSize</span><span class="p">,</span>
    <span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrowSize</span><span class="p">);</span>
  <span class="n">QPointF</span> <span class="n">arrowP2</span> <span class="o">=</span> <span class="n">myLine</span><span class="p">.</span><span class="n">p2</span><span class="p">()</span> <span class="o">-</span> <span class="n">QPointF</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">Pi</span> <span class="o">-</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrowSize</span><span class="p">,</span>
  <span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">Pi</span> <span class="o">-</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrowSize</span><span class="p">);</span>
  
  <span class="n">arrowHead</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">arrowHead</span> <span class="o">&lt;&lt;</span> <span class="n">myLine</span><span class="p">.</span><span class="n">p2</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">arrowP1</span> <span class="o">&lt;&lt;</span> <span class="n">arrowP2</span><span class="p">;</span>

  <span class="n">painter</span><span class="o">-&gt;</span><span class="n">drawLine</span><span class="p">(</span><span class="n">myLine</span><span class="p">);</span>
  <span class="n">painter</span><span class="o">-&gt;</span><span class="n">drawPolygon</span><span class="p">(</span><span class="n">arrowHead</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>And that should do the trick. At least, if we were only interested in drawing edges as straight lines. However, what if we want to draw parallel edges, that is, multiple edges between the same pair of nodes? In this case, if we would just use straight lines, then the edges would overlap, and we would actually not be able to see that multiple edges exist between our nodes. In this case, it is better to draw edges as curved lines, and to change the strength of the curve for each additional edge that we add to a given pair of nodes. The remainder of this post will be about how we can do this, and what challenges we will face.</p> <h2 id="drawing-parallel-edges">Drawing parallel edges</h2> <p>Drawing a curved line with the Qt library is not difficult to do. One of the easiest ways to <code class="language-plaintext highlighter-rouge">paint()</code> a curved line is by creating a <a href="http://doc.qt.io/qt-5/qpainterpath.html"><code class="language-plaintext highlighter-rouge">QPainterPath</code> object</a>, and use its <a href="http://doc.qt.io/qt-5/qpainterpath.html#quadTo"><code class="language-plaintext highlighter-rouge">quadTo()</code> function</a>. This function takes two arguments: One of the arguments is the end point that we want to draw the curved line to, and the other argument is a so-called control point that we will use to determine how the line will be curved (how strong the curve will be and which direction it will curve in). We do not give the function a starting point. Instead, we should move the <code class="language-plaintext highlighter-rouge">QPainterPath</code> object to our starting point using its <a href="http://doc.qt.io/qt-5/qpainterpath.html#moveTo">‘moveTo()’ function</a> before calling the <code class="language-plaintext highlighter-rouge">quadTo()</code> function.</p> <p>So, what about this control point? Consider the image I have linked to below (found through this <a href="https://stackoverflow.com/questions/50129580/program-to-find-line-segment-and-bezier-curve-intersection">Stack OverFlow</a> discussion). The image shows nicely how the control point works. It is a point somewhere ‘above’ the place where we want our line to curve towards the control point. In the image you see that if we place the control point somewhere above the middle of the line, then the line will also curve around its middle point. This is exactly what I wanted for my parallel edges. In the image you also see that the curve will change if we move the control point closer to the starting point or the end point. This is something that I want to avoid.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/beziercurve.gif-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/beziercurve.gif-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/beziercurve.gif-1400.webp"/> <img src="/assets/img/beziercurve.gif" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Bezier curves. </div> <p>So far so good. Assume that our starting point is at coordinates <code class="language-plaintext highlighter-rouge">(0, 5)</code> in the scene, and our end point is at coordinate <code class="language-plaintext highlighter-rouge">(10, 5)</code> in the scene, we can first simply calculate the point that lies exactly in between them: <code class="language-plaintext highlighter-rouge">x = (10 + 0) / 2 = 5</code> and <code class="language-plaintext highlighter-rouge">y = (5 + 5) / 2 = 5</code>, giving us the point at coordinates <code class="language-plaintext highlighter-rouge">(5, 5)</code>. Then we still need to set the ‘height’ of the curve, which, in this case, we can do simply by adding some constant to the y-coordinate of our middle point, giving us, for example, the point at coordinates <code class="language-plaintext highlighter-rouge">(5, 25)</code>. If we then pass this point to the <code class="language-plaintext highlighter-rouge">quadTo()</code> function, we will get a nice curved line.</p> <p>This example was relatively simple, because the slope of the straight line between our starting point and our end point is 0. This makes finding the control point relatively straightforward. However, consider now that we have a line that starts at coordinates <code class="language-plaintext highlighter-rouge">(0, 5)</code> and ends at coordinates <code class="language-plaintext highlighter-rouge">(10, 10)</code>. Finding the point that lies exactly in the middle is still quite easy: <code class="language-plaintext highlighter-rouge">x = (0 + 10) / 2 = 5</code> and <code class="language-plaintext highlighter-rouge">y = 5 + 10 / 2 = 7.5</code>. However, how do we now find the control point, somewhere ‘above’ this middle point? We cannot simply add a constant value to the y-coordinate of our middle point, because that would place the control point somewhere right from the middle of the line, and create a curve that skews to the left (similar to the left part of the picture above, where the line is skewed to the right).</p> <p>There are multiple possible solutions here. One thing we could do is to simply (1) calculate the distance between the start point and end point of the edge (using the pythagorean theorem), (2) draw an imaginary straight line from our start point with a slope of 0 (that is, parallel to our x-axis), and with a length that equals the distance we measured in step 1, (3) create a curved edge from the start and end point of our imaginary straight line, using the procedure described above, (4) calculate the angle between our imaginary straight line and the sloped line from our original starting point to our original end point, and then (5) <a href="http://doc.qt.io/archives/qt-4.8/qpainter.html#rotate">rotate()</a> the painter by the number of degrees of that angle before drawing our edge. In effect, we are just drawing a curved edge between two points on a horizontal line, and we are then rotating that edge before it is drawn, thereby changing its end point. This is the solution I used for a while, because it is relatively simple to implement. However, it does cause some complications for calculating the <a href="http://doc.qt.io/qt-5/qgraphicsitem.html#boundingRect">bounding rect</a> and the <a href="http://doc.qt.io/qt-5/qgraphicsitem.html#shape">shape</a> of the edge, because we are essentially working in multiple coordination systems. I will not discuss these complications in detail here, but it is important to know that they can cause unwanted behaviour in visualisations.</p> <p>There is another, better solution that I eventually switched to after experiencing issues with my first solution. This solution starts with drawing an imaginary straight line between the start and the end points of our edge. We then calculate the midpoint of our line, as before. Then we draw a straight line perpendicular to our first line that crosses our midpoint, and we pick a point on that line as our control point. This sounds relatively straightforward, but it took me some time to figure out how to properly implement the formula for setting the control point.</p> <p>Rather than including all these steps in the <a href="http://doc.qt.io/qt-5/qgraphicsitem.html#paint">‘paint()’ function</a> of our edge, I wrote a separate <code class="language-plaintext highlighter-rouge">calculate()</code> function that makes the necessary calculations, and is called by the paint function (as well as by other functions that require knowledge of the control point’s position). See the two functions in the code snippet below.</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="kt">void</span> <span class="n">DirectedEdge</span><span class="o">::</span><span class="n">calculate</span><span class="p">()</span> 
<span class="p">{</span>
  <span class="c1">// We first calculate the distance covered by our edge</span>
  <span class="n">qreal</span> <span class="n">dX</span> <span class="o">=</span> <span class="n">end</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">().</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">().</span><span class="n">x</span><span class="p">();</span>
  <span class="n">qreal</span> <span class="n">dY</span> <span class="o">=</span> <span class="n">end</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">().</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">().</span><span class="n">y</span><span class="p">();</span>
  <span class="n">qreal</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">dX</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">dY</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="c1">// Then we create a straight line from our start point to our end point and shorten its length</span>
  <span class="n">QLineF</span> <span class="n">newLine</span> <span class="o">=</span> <span class="n">QLineF</span><span class="p">(</span><span class="n">start</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">(),</span> <span class="n">end</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">());</span>
  <span class="n">newLine</span><span class="p">.</span><span class="n">setLength</span><span class="p">(</span><span class="n">newLine</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">18</span><span class="p">);</span>
  <span class="c1">// Then we calculate the coordinates of our midpoint</span>
  <span class="n">qreal</span> <span class="n">mX</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">().</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">newLine</span><span class="p">.</span><span class="n">p2</span><span class="p">().</span><span class="n">x</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">qreal</span> <span class="n">mY</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">().</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">newLine</span><span class="p">.</span><span class="n">p2</span><span class="p">().</span><span class="n">y</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="c1">// And the coordinates of our control point. We use the edges height as a scaling factor</span>
  <span class="c1">// to determine the 'height' of the control point on a line perpendicular to our </span>
  <span class="c1">// original line (newLine).</span>
  <span class="n">qreal</span> <span class="n">cX</span> <span class="o">=</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">dY</span> <span class="o">/</span> <span class="n">distance</span><span class="p">))</span> <span class="o">+</span> <span class="n">mX</span><span class="p">;</span>
  <span class="n">qreal</span> <span class="n">cY</span> <span class="o">=</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="n">dX</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span> <span class="o">+</span> <span class="n">mY</span><span class="p">;</span>
  <span class="n">controlPoint</span> <span class="o">=</span> <span class="n">QPointF</span><span class="p">(</span><span class="n">cX</span><span class="p">,</span> <span class="n">cY</span><span class="p">);</span>
  <span class="c1">// We create another line from our control point to our end point and shorten its length</span>
  <span class="n">ghostLine</span> <span class="o">=</span> <span class="n">QLineF</span><span class="p">(</span><span class="n">controlPoint</span><span class="p">,</span> <span class="n">end</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">());</span>
  <span class="n">ghostLine</span><span class="p">.</span><span class="n">setLength</span><span class="p">(</span><span class="n">ghostLine</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">18</span><span class="p">);</span>
  <span class="c1">// Then we do the calculations we need to create our arrowhead</span>
  <span class="kt">double</span> <span class="n">angle</span> <span class="o">=</span> <span class="o">::</span><span class="n">acos</span><span class="p">(</span><span class="n">ghostLine</span><span class="p">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">/</span> <span class="n">ghostLine</span><span class="p">.</span><span class="n">length</span><span class="p">());</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ghostLine</span><span class="p">.</span><span class="n">dy</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">angle</span><span class="p">;</span>
  <span class="n">qreal</span> <span class="n">arrowSize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="n">arrowP1</span> <span class="o">=</span> <span class="n">ghostLine</span><span class="p">.</span><span class="n">p2</span><span class="p">()</span> <span class="o">-</span> <span class="n">QPointF</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">Pi</span> <span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrowSize</span><span class="p">,</span>
				     <span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrowSize</span><span class="p">);</span>
  <span class="n">arrowP2</span> <span class="o">=</span> <span class="n">ghostLine</span><span class="p">.</span><span class="n">p2</span><span class="p">()</span> <span class="o">-</span> <span class="n">QPointF</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">Pi</span> <span class="o">-</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrowSize</span><span class="p">,</span>
				     <span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">Pi</span> <span class="o">-</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrowSize</span><span class="p">);</span>
  <span class="c1">// We set the new line as the line for this edge object and communicate that we </span>
  <span class="c1">// are about to change the objects geometry (this will makes sure the bounding rect</span>
  <span class="c1">// is reset as well.</span>
  <span class="n">setLine</span><span class="p">(</span><span class="n">newLine</span><span class="p">);</span>
  <span class="n">prepareGeometryChange</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">DirectedEdge</span><span class="o">::</span><span class="n">paint</span><span class="p">(</span><span class="n">QPainter</span> <span class="o">*</span><span class="n">painter</span><span class="p">,</span> <span class="k">const</span> <span class="n">QStyleOptionGraphicsItem</span> <span class="o">*</span><span class="p">,</span> <span class="n">QWidget</span> <span class="o">*</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="c1">// We have to set a pen and its colours.</span>
  <span class="n">QPen</span> <span class="n">myPen</span> <span class="o">=</span> <span class="n">pen</span><span class="p">();</span>
  <span class="n">myPen</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
  <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setPen</span><span class="p">(</span><span class="n">myPen</span><span class="p">);</span>
  <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setBrush</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
  <span class="c1">// We call the calculate function outlined above.</span>
  <span class="n">calculate</span><span class="p">();</span>
  <span class="c1">// We create the arrowhead, using ghostLine (from the control point to slight before the end point)</span>
  <span class="c1">// to determine the direction from which the arrow is pointing.</span>
  <span class="n">arrowHead</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">arrowHead</span> <span class="o">&lt;&lt;</span> <span class="n">ghostLine</span><span class="p">.</span><span class="n">p2</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">arrowP1</span> <span class="o">&lt;&lt;</span> <span class="n">arrowP2</span><span class="p">;</span>
  <span class="c1">// We create a path object as a based for our curved edge.</span>
  <span class="n">QPainterPath</span> <span class="n">myPath</span><span class="p">;</span>
  <span class="c1">// We move this path to the start point of our edge.</span>
  <span class="n">myPath</span><span class="p">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">start</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">());</span>
  <span class="c1">// The we create a bezier curve to our end point, using the control point to curve it</span>
  <span class="n">myPath</span><span class="p">.</span><span class="n">quadTo</span><span class="p">(</span><span class="n">controlPoint</span><span class="p">,</span> <span class="n">ghostLine</span><span class="p">.</span><span class="n">p2</span><span class="p">());</span>
  <span class="n">strokePath</span> <span class="o">=</span> <span class="n">myPath</span><span class="p">;</span>
  <span class="c1">// And then we draw the arrowhead and the curved line</span>
  <span class="n">painter</span><span class="o">-&gt;</span><span class="n">drawPolygon</span><span class="p">(</span><span class="n">arrowHead</span><span class="p">);</span>
  <span class="n">painter</span><span class="o">-&gt;</span><span class="n">strokePath</span><span class="p">(</span><span class="n">myPath</span><span class="p">,</span> <span class="n">QPen</span><span class="p">(</span><span class="n">color</span><span class="p">));</span>
<span class="p">}</span></code></pre></figure> <h2 id="a-few-other-things-to-note-about-these-functions">A few other things to note about these functions</h2> <p>In addition to finding the control point (which I explained above how to do), there are a few other things we need to do to make sure that we end up with nice looking curved edges. First of all, we might have 3 or more parallel edges between the same nodes. If we want to make all edges visible, we need to increase the strength of the curve for each parallel edge that we add (to prevent them from overlapping). That is what the <code class="language-plaintext highlighter-rouge">height</code> scaling factor in the snippet above is used for. This height has to be set explicitly, for which I wrote a very simple function. Then it is simply a matter of keeping track of what edges we already have in our <code class="language-plaintext highlighter-rouge">scene</code> and to make sure that the <code class="language-plaintext highlighter-rouge">height</code>s of the curves of our edges are adjusted accordingly. This is something that needs to be handled at a higher level, and I will not discuss it any further here.</p> <p>We also need to make sure that our arrowhead actually points <em>from</em> the right direction. If we would attach our arrowhead to the original line we draw from the start point to the end point, it would make an awkward angle, as shown in the screenshot below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Wrong_Arrowhead-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Wrong_Arrowhead-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Wrong_Arrowhead-1400.webp"/> <img src="/assets/img/Wrong_Arrowhead.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> A bad arrowhead. </div> <p>This is relatively easy to correct with the resources that we already have. In the code snippet that I included above, you will see that I created an object that I called <code class="language-plaintext highlighter-rouge">ghostLine</code>, which is a line that runs from the control point that we calculated for the bezier curve to the end point of the edge (minus a small distance to prevent the line from overlapping with the node). This <code class="language-plaintext highlighter-rouge">ghostLine</code> is useful for determining where the curved edge should end, as well as for determining the angle that the arrowhead should point from. Essentially, what we can do is attach the arrowhead to the <code class="language-plaintext highlighter-rouge">ghostLine</code> and draw the arrowhead, but not draw the line itself. For illustrative purposes, I included a screenshot below where the <code class="language-plaintext highlighter-rouge">ghostLine</code> is drawn, so that you can get an idea of how it helps to determine the angle of the arrowhead.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Midpoint_Line-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Midpoint_Line-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Midpoint_Line-1400.webp"/> <img src="/assets/img/Midpoint_Line.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The ghost line. </div> <h2 id="final-comments">Final comments</h2> <p>And that is it. The code snippets above contain the most essential ingredients for drawing curved edges within the Qt Framework. Indeed, there is plenty of stuff that goes on around this that needs to be implemented for all of this to work. Later this year, the source code for Q-SoPrA will be open, which gives you the opportunity to examine the code in more detail.</p>]]></content><author><name></name></author><category term="Software"/><category term="Q-SoPrA"/><category term="Technical"/><category term="Qt"/><summary type="html"><![CDATA[Introduction I wrote a non-technical post on relationships in Q-SoPrA. One of the things I discuss there is plotting parallel edges, that is, multiple edges between the same pair of nodes. This is something I definitely wanted to be able to do, since I am interested in looking at social arrangements (of people, places, things, etc.) that can be related to each other in various ways. If I want to look at multiple relationships at the same time, being able to visualise parallel edges is a necessity. In this post I discuss some of the details of visualising parallel edges using Qt’s tools for visualisation. For a visual impression of what parallel edges look like in Q-SoPrA, see the screenshot below.]]></summary></entry><entry><title type="html">Relationships in Q-SoPrA</title><link href="https://wouterspekkink.github.io/blog/2018/relationships-in-qsopra/" rel="alternate" type="text/html" title="Relationships in Q-SoPrA"/><published>2018-02-21T20:00:00+01:00</published><updated>2018-02-21T20:00:00+01:00</updated><id>https://wouterspekkink.github.io/blog/2018/relationships-in-qsopra</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2018/relationships-in-qsopra/"><![CDATA[<h2 id="introduction-process-and-structure">Introduction: Process <em>and</em> structure</h2> <p>As the name suggests, Q-SoPrA (<strong>Q</strong>ualitative <strong>So</strong>ftware for <strong>Pr</strong>ocess <strong>A</strong>nalysis) is focused first and foremost on the qualitative analysis of social <em>processes</em>. However, I invested a lot of time and energy in also creating features that can be used to study how these processes relate to <em>structures</em>. In my opinion, this is a somewhat obvious thing to do, since so many social theories posit some kind of relationship between process and structure (often couched in terms of <em>agency</em> and <em>structure</em>. I can use my own application of Q-SoPrA as an example. I am currently using Q-SoPrA in a study that, conceptually, builds on <a href="https://books.google.co.uk/books?id=753WUmtDIiwC&amp;printsec=frontcover&amp;dq=The+Site+of+the+Social&amp;hl=nl&amp;sa=X&amp;ved=0ahUKEwjPvMuKta_ZAhWNLlAKHZz0DIMQ6AEIJzAA#v=onepage&amp;q=The%20Site%20of%20the%20Social&amp;f=false">Schatzki’s</a> concepts of <em>social practices</em> (in short, organised doings and sayings) and <em>social arrangements</em> of people, artefacts, places, and other types of entities. I use event graphs to reconstruct practices as networks of activities (<a href="https://books.google.co.uk/books?id=753WUmtDIiwC&amp;printsec=frontcover&amp;dq=The+Site+of+the+Social&amp;hl=nl&amp;sa=X&amp;ved=0ahUKEwjPvMuKta_ZAhWNLlAKHZz0DIMQ6AEIJzAA#v=onepage&amp;q=The%20Site%20of%20the%20Social&amp;f=false">Schatzki</a> also writes about <em>chains of action</em> in this context), and I use more traditional network graphs to reconstruct arrangements as networks of relationships between entities. One aspect of my investigation is to study how unfolding practices relate to (changes in) arrangements.</p> <p>I believe that many other theoretical perspectives are compatible with Q-SoPrA, although Q-SoPrA probably fits best with perspectives that assume <em>primacy of process over structure</em> (see <a href="https://books.google.co.uk/books?id=8MjR29eJLYIC&amp;printsec=frontcover&amp;dq=Process+metaphysics&amp;hl=nl&amp;sa=X&amp;ved=0ahUKEwj-8drota_ZAhVCZ1AKHVUwBKUQ6AEIJzAA#v=onepage&amp;q=Process%20metaphysics&amp;f=false">Rescher</a>). In other words, Q-SoPrA connects best with the assumption that (social) life is essentially a flux, and that the emergence and persistence of structures are generally <a href="https://en.wikipedia.org/wiki/Accident_(philosophy)">accidental</a> properties of processes, even if those these accidental properties can be widespread (and I think they are). This assumption can be opposed to the assumption that reality is fundamentally structural, and that change and development are accidental properties of structures.</p> <blockquote> I should perhaps add that, in my view, this does not necessarily mean that processes should always have priority in the explanation of social phenomena. I think it is perfectly reasonable to assume that structures emerge from process, but are then capable of shaping or inducing processes in radical ways, and are therefore of great explanatory value, depending on the specific research questions being asked. <br/><br/> That being said, from a process perspective it would then still be obvious to also ask the question what processes lead to the (re)production of that structure. </blockquote> <p>So how does Q-SoPrA assume primacy of social process? Well, by using <a href="/blog/2017/getting-started-with-qsopra/">incidents</a> as indicators for relationships (although it is of course equally possible to think of incidents as enactments of relationships without changing the general approach). More specifically, Q-SoPrA allows you to define relationships (I discuss the details below), and then assign these to incidents in the same way that you would assign <a href="/blog/2018/attributes-in-qsopra/">attributes</a>. This also creates the benefit that it becomes possible to study networks of relationships that were indicated by incidents in a particular episode of the process, thereby providing a rudimentary way to look at changes in networks of relationships over time, as I discuss further below.</p> <p>In the past, I used to do something similar by assigning actors to events (as attributes), and then looking at the <em>co-participation</em> (or co-affiliation) of actors in events over time (also see my post about <a href="/blog/2017/bi-dynamic-line-graphs/">bi-dynamic line graphs</a>). Two important limitations of this approach are that (1) <em>co-participation</em> is basically an abstract summary of many different ways in which actors can be related to each other through events, and (2) not all relationships that are <em>indicated</em> by events are necessarily captured by their co-participation. To offer an example of the first limitation, imagine that we have two events in which the same pair of actors interacted with each other, but that in one event the interaction concerned the joint organisation of an activity, and in the other event the interaction concerned one actor providing financial support to the other actor. If we simply model both occasions as co-participation, then we lose the ability to distinguish between the two situations. To offer an example of the second limitation, imagine that we have an activity in which an individual is acting as a representative of a certain group. If we want to capture this fact as a membership relation, it would be awkward to capture it as co-participation of the individual and the group in the activity. Instead, it would make more sense if we could simply define a <em>membership</em> relationship, and say that the activity is an indication of the individual being a member of the group.</p> <p>The way I implemented relationship coding in Q-SoPrA is basically an attempt to take away these limitations. In addition, I made sure that Q-SoPrA is able to visualise networks of relationships that have multiple modes (for an introduction into two-mode networks, see this <a href="https://toreopsahl.com/tnet/two-mode-networks/defining-two-mode-networks/">blog post</a>; Q-SoPrA allows you to define more than two modes), and multiple types of relationships. Parallel edges (multiple edges between the same pair of entities) are drawn with curved lines to make sure that multiple types of relationships can be visualised in one graph. In addition, it is possible to perform multi-mode transformations to infer ‘latent’ relationships from observed ones. I will explain all of this in detail in the remainder of this post.</p> <p>Before I proceed, I should make the note that the example data set that I use below is based on a narrative that Peter Abell provided in <a href="http://www.tandfonline.com/doi/abs/10.1080/0022250X.1993.9990119">one of his papers on Comparative Narratives</a>. Abell’s theory and method of Comparative Narratives are major sources of inspiration for the ideas implemented in Q-SoPrA.</p> <h2 id="the-relationships-widget">The relationships widget</h2> <p>In the screenshot below you see what the relationships widget looks like. If you’ve seen <a href="/blog/2018/attributes-in-qsopra/">my earlier post on attributes in Q-SoPrA</a>, you’ll notice that the relationships widget and attributes widget look very similar. Each incident in the data set can be inspected individually, with the information available on the incident displayed in the left half of the screen. With the navigation buttons at the bottom-left you can go through the previous or next incident as they appear in the overall chronological order (which you set in <a href="/blog/2017/getting-started-with-qsopra/">the data widget</a>), you can jump to the previous or next incident that is marked (incidents can be marked and unmarked with the <strong>Toggle mark</strong> button), or you can jump to a specific incident by using the <strong>Jump to</strong> button.</p> <p>In the right half of the screen you will see a relationships tree (when you start a new data set, this tree will be blank). This tree works a bit different from the <a href="/blog/2018/attributes-in-qsopra/">attributes tree</a>. One important difference is that the relationship tree can only have two levels. The first level of the tree shows <em>relationship types</em>, and the children of each relationship type are <em>instances</em> of this type. As we can see in the screenshot below, we have two instances of the <em>conceived of</em> relationship type, one of which captures that the <em>entity</em> “Cooperative Manager” conceived of the <em>entity</em> “Moratorium PLan”, while the other captures that the <em>entity</em> “External members” conceived of the <em>entity</em> “General assembly proposal”.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Relationships_Widget_2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Relationships_Widget_2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Relationships_Widget_2-1400.webp"/> <img src="/assets/img/Relationships_Widget_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Relationships widget </div> <p>We can learn more about the definition of this relationship type by hovering our mouse over it (or hovering it over one of its instances). A tool tip with a description of the relationship will appear, as shown in the screenshot below. The description will always start with an indication of the <em>directedness</em> of the relationship, which may be set to <em>Directed</em> or <em>Undirected</em>. This is followed by the definition of the relationship that was created by the user.</p> <p>The directedness of relationship types is also visualised in the labels that represent instances of that relationship type. As you can see in the screenshot below, the label of the two visible instances have a single arrow pointing from left to right, meaning that the relationship is directed from the entity on the left to the entity on the right. With undirected relationship types, there would be a double arrow pointing in both directions.</p> <blockquote> I assume that you are familiar with the idea of directedness in relationships (in the context of network analysis). If not, this probably means that you still need to familiarise yourself with the basics of social network analysis, and I would suggest taking a look at <a href="https://books.google.co.uk/books?id=CAm2DpIqRUIC&amp;printsec=frontcover&amp;redir_esc=y#v=onepage&amp;q&amp;f=false">the book by Wasserman and Faust</a>, which I think works great as an introduction, as well as an in-depth work of reference. </blockquote> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Relationships_Tooltip-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Relationships_Tooltip-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Relationships_Tooltip-1400.webp"/> <img src="/assets/img/Relationships_Tooltip.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> A directed relationship </div> <h3 id="defining-relationship-types">Defining relationship types</h3> <p>So how do we define relationship types in Q-SoPrA? This can be done by clicking the <strong>Add relationship type</strong> button. This will open a new dialog where the details of the relationship type can be written. The screenshot below shows an example of this, using the <em>conceived of</em> relationship type. As you can see, we can create a label for the relationship type, which is the label that is shown in the relationships tree. We are also required to offer a description of the relationship type, and we have to set its directedness. The same dialog will appear if you select an existing relationship type and click <strong>Edit relationship type</strong> in the relationships widget, but in this case the details of the existing relationship type will be shown in the dialog.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Relationship_Type-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Relationship_Type-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Relationship_Type-1400.webp"/> <img src="/assets/img/Relationship_Type.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Adding or editing a relationship type </div> <p>As you can see in the screenshot above, in the definition of this relationship type I have also indicated what types of entities can enter into this relationship (and in what role). In this case, I indicated that the source of the relationship should always be a (type of) actor, and the target should always be a (type of) plan. This implies that <em>actors</em> and <em>plans</em> are different types of entities in our data set, and in Q-SoPrA we can actually define different types based on attributes that we assign to entities. I’ll get back to this point further below.</p> <h3 id="creating-new-relationships">Creating new relationships</h3> <p>After we have defined a new relationship type, no instances of this relationship type will exist yet. For this, we have to explicitly create new relationships. This can be done by first selecting a relationship type in the relationships tree, and then clicking the <strong>Add relationship</strong> button. This will open another dialog (see below). In the dialog we see a list of entities (this list can be filtered with the <strong>Source filter</strong>), and several controls.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/New_Relationship-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/New_Relationship-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/New_Relationship-1400.webp"/> <img src="/assets/img/New_Relationship.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Adding a new relationship </div> <h4 id="defining-a-new-entity">Defining a new entity</h4> <p>The list of entities will be empty if you have not defined any entities yet. Let us assume for a moment that this is the case. Before we can actually create a new relationship, we need to define entities that can enter in that relationship. This can be done by clicking the <strong>Define new entity</strong> button. This will open another dialog where a new entity can be created, as shown below. You are always required to provide a name and a description for your entity. In addition, we can use an attributes tree to assign attributes to the entity. This work almost exactly the same as <a href="/blog/2018/attributes-in-qsopra/">assigning attributes to incidents</a>, except that we cannot associate any ‘raw text’ with <em>entity attributes</em>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/New_Entity-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/New_Entity-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/New_Entity-1400.webp"/> <img src="/assets/img/New_Entity.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Adding a new entity. </div> <p>New attributes can be created in this screen as well. For this we would click the <em>New attribute</em> button. This will open yet another dialog (see below), but you’ll be pleased to know that we won’t open any other dialogs from here. The new dialog is a simple dialog where a label and description for the new attribute can be created. After creating the new attribute, it will appear in the attributes tree of the previous dialog. For this example, I have decided not to create the entity “Toby, the magic purple elephant” anyway, because it doesn’t really contribute anything to my case study.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Attribute_Dialog_2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Attribute_Dialog_2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Attribute_Dialog_2-1400.webp"/> <img src="/assets/img/Attribute_Dialog_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Creating new attributes. </div> <h4 id="assigning-entities-to-relationships">Assigning entities to relationships</h4> <p>If we have defined at least two entities, we can assign them to the relationship that we are creating (in Q-SoPrA, entities cannot enter into a relationships with themselves). If you look at the screenshot of the relationships dialog below, you’ll see that under the list of entities, there are two buttons: <strong>use as source</strong> and <strong>use as target</strong>. Below these buttons you’ll see a description of the relationship as it is currently defined. When no entities have been assigned yet, in place of the <em>Source</em> and the <em>Target</em>, it will simply say “-Unselected-“. Entities can be assigned by selecting them in the list, and then clicking one of the <strong>use as…</strong> buttons. This will also change the description of the relationship (see below).</p> <p>After we have assigned entities to our relationship, we can save it. It will now appear as one of the instances of the selected relationship type in the relationships tree. Each relationship can only be defined once. I should note here that undirected relationships with the source and target switched around are treated as identical. So, a relationship like <em>Wouter&lt;–has contact with–&gt;Toby</em> is treated as being identical to <em>Toby&lt;–has contact with–&gt;Wouter</em>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Assigning_Entities-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Assigning_Entities-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Assigning_Entities-1400.webp"/> <img src="/assets/img/Assigning_Entities.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Assigning entities to a relationship. </div> <h4 id="editing-entities">Editing entities</h4> <p>In addition to defining new entities, we can also edit existing ones from this dialog. This can be done by selecting an entity in the list and clicking the <strong>Edit highlighted entity</strong> button, or by clicking the <strong>Edit left assigned entity</strong> or the <strong>Edit right assigned entity</strong> buttons to edit entities that were already assigned to the currently inspected relationship. This will open the same dialog that is used for defining new entities, but with the details of the selected entity already filled out.</p> <h3 id="assigning-relationships">Assigning relationships</h3> <p>Assigning a relationship to an incident does work the same as <a href="/blog/2018/attributes-in-qsopra/">assigning attributes</a>. In short, you select a relationship in the relationships tree, and then click the <strong>Assign relationship</strong> button to associate the relationship with the incident that is currently being inspected. It is also possible to associate a fragment of raw text (in the <strong>Raw</strong> field in the left half of the screen), by highlighting the text before clicking the <strong>Assign relationship</strong> button (this can also be done after the relationship is already assigned). If you want to disassociate a fragment of text from an assigned relationship you can either select this fragment of text in the <strong>Raw</strong> field, and then click the <strong>Remove text</strong> button, or you can click the <strong>Reset texts</strong> button, which will remove all fragments of text associated with the selected relationship and incident.</p> <p>As with attributes, it is possible to navigate incidents via relationships that are assigned to them. This can be done by clicking a relationship, and then clicking the <strong>Previous coded</strong> or the <strong>Next coded</strong> buttons, which will jump to the previous/next incident that has the selected relationship assigned to it.</p> <h3 id="filtering-and-commenting-on-relationships">Filtering and commenting on relationships</h3> <p>I think it is likely that you’ll create quite a large number of relationships if you’re going to make use of the relationships widget. This means that the relationships tree quickly becomes heavily populated. By grouping relationships under different types, it should be possible to keep an overview relatively easily. However, often it will be easier to simply filter the relationships by using the <strong>Filter relationships</strong> field. For example, if you’re looking for a relationship that involves a particular entity, you can type the entity’s name in this field, and Q-SoPrA will filter out all relationships that do not include this entity.</p> <p>You can also add comments to relationships. These comments are associated with the relationship itself, not with specific relationship-incident pairs. This is just like writing a comment/memo, but in this case the comment/memo applies specifically to a relationship. This can be achieved by selecting the relationship in the list, then typing the comment in the <strong>Comment</strong> field, and clicking the <strong>Set comment</strong> button afterwards.</p> <h2 id="visualising-networks-of-relationships">Visualising networks of relationships</h2> <p>In the previous sections, I discussed how relationships can be defined, and then assigned to incidents. After you have identified relationships in your data, the more interesting thing to do is indeed to visualise them. I created the network graph visualisation widget for this purpose.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Network_Graph_Widget-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Network_Graph_Widget-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Network_Graph_Widget-1400.webp"/> <img src="/assets/img/Network_Graph_Widget.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The Network Graph widget. </div> <p>When you switch to this widget, it will initially be blank. To start plotting a network, you have to select a relationship type from a drop-down menu in the top left of the screen. In this menu, all relationship types that you have created are listed (see above). If you select one of them, you can then click the <strong>Plot new</strong> button. This will open a dialog that you can use to assign a colour to the relationship type you wish to plot (see below). By assigning different colours to different relationship types, we can distinguish between them in the visualisation. The colours belonging to different relationship types are listed in the legend, which can be opened by clicking the <strong>Toggle legend</strong> button at the bottom right of the network graph widget’s screen.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Colour_Dialog-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Colour_Dialog-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Colour_Dialog-1400.webp"/> <img src="/assets/img/Colour_Dialog.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Assigning different colours to relationships. </div> <p>When you plot the network (I have chosen to plot the <em>has contact with</em> relationship, using the default black colour for the edges/relationships), it will appear in the draw screen (see below). The graph will initially just have a collection of unlabeled nodes (a selection of our entities) and the relationships between them. Q-SoPrA will always only show entities that are in a relationship that is currently visible (this also means that there can never be isolates in networks plotted by Q-SoPrA).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/First_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/First_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/First_Network-1400.webp"/> <img src="/assets/img/First_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 1. </div> <h3 id="the-graph-layout">The graph layout</h3> <p>The default layout by Q-SoPrA is a ‘spring-like layout’. It is basically an intuitive layout algorithm that I quickly implemented as a temporary placeholder when I was creating this widget. However, with some improvements over time it actually turned out to function quite well, so I never bothered to find and use another algorithm to replace it with. I did add a second layout algorithm, which is the circular layout. As the name suggest, this will simply layout the nodes in a circle.</p> <blockquote> The circular layout does in fact do a little bit more than that. If you have modes assigned to your network (discussed further below), the nodes in the circular layout will be sorted by mode. </blockquote> <p>It is possible to expand or contract the layout by using the appropriate controls (these can be found in the <strong>Controls</strong> menu, which can be opened by clicking the <strong>Toggle controls</strong> button). It is possible to drag around nodes by clicking and dragging them with your mouse cursor. If you select multiple nodes, you can drag them around as a group by holding the CTRL button while clicking and dragging. I implemented very basic collision detection to make sure that nodes push each other away when they bump into each other.</p> <p>In our current plot, it is impossible for us to clearly identify our entities. We can improve the visualisation a bit by adding labels to the graph. This is also done from the <strong>Controls</strong> menu, where you will find a button <strong>Toggle labels</strong>, which can be used to show/hide node labels. Like the nodes, node labels can be dragged around individually by clicking and dragging them with your mouse cursor. However, wherever a node label is located relative to its ‘parent node’, it will always mimic the movements of that parent node. This allows you to change the position of the labels to make the graph more readable (see below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Second_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Second_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Second_Network-1400.webp"/> <img src="/assets/img/Second_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 2. </div> <p>There is also another way to see more details about the nodes. We can hover our mouse cursor over nodes to see a tool tip with their name and description, or we can open the <strong>Details</strong> menu (by clicking the <strong>Toggle details</strong> button) to see the details we have available on the nodes that are currently selected, including attributes assigned to them (see below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Third_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Third_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Third_Network-1400.webp"/> <img src="/assets/img/Third_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 3. </div> <h3 id="filtering-relationships">Filtering relationships</h3> <p>The network we are currently visualising is quite dense. This is because nearly all actors have been in contact with each other at least once in the process. In this visualisation, all the moments that we observed that actors were in contact with each other are aggregated. It can be interesting to filter out certain episodes in the process, to see what the network looked like during a specific episode of the process.</p> <p>Q-SoPrA does this in a rudimentary way, by allowing you to set upper and lower bounds for the incidents that should be included in the visualisation. Indeed, the incidents themselves are not directly visible in the graph, but the relationships that were assigned to incidents are. By changing the upper and lower bounds in the <strong>Controls</strong> menu, we can thus manipulate the visualisation to only show relationships that were assigned to incidents that fall within those bounds. In the screenshot below you can see that our network becomes sparser if we filter out some of the later incidents in our data set.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Fourth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Fourth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Fourth_Network-1400.webp"/> <img src="/assets/img/Fourth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 4. </div> <p>Filters can also be disabled for individual relationship types. This can be done by selecting the relationship type in the legend, and clicking the <strong>Filter off</strong> button. This means that all relationships of this type will be shown, no matter what bounds you have set in the <strong>Controls</strong> menu, effectively allowing you to filter some relationship types, while keeping others fixed. To set the filter on again for a relationship type, you select the relationship type in the legend, and click the <strong>Filter on</strong> button.</p> <p>It is also possible to temporarily hide relationships of a certain type altogether, by selecting the relationship type in the legend and clicking the <strong>Hide</strong> button. Hidden relationships can be revealed again by clicking the <strong>Show</strong> button.</p> <h3 id="changing-colours">Changing colours</h3> <p>There are some basic ways to change the visualisation, in addition to a few more advanced ones that I discuss further below. A basic change we can make is to change the colour of the nodes, labels, as well as the background of the plot screen. This is all done using the appropriate controls in the <strong>Controls</strong> menu. Using one of the colour controls will open the colour-picking dialog that we have seen in an earlier screenshot.</p> <p>We can also change the colour of the current relationship type by double clicking its colour in the legend. This will also open the colour-picking dialog, where you can select the colour you would like to change to. In screenshot below, I have changed the colour of the nodes to red, I have changed the colour of the labels to blue, and I have changed the colour of the relationship type <em>has contact with</em> to orange. There is no other consequence of these changes beyond the visual ones.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Fifth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Fifth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Fifth_Network-1400.webp"/> <img src="/assets/img/Fifth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 5. </div> <h3 id="adding-additional-relationship-types">Adding additional relationship types</h3> <p>Now let’s make things a little bit more interesting. I will add another relationship type, in this case the <em>conceived of</em> relationship type that we saw earlier. I can do this by selecting this relationship type from the drop-down menu in the top left of the screen, and by clicking the <strong>Add relationship type</strong> button (Clicking <strong>Plot new</strong> would just overwrite the current plot). As the colour of this relationship, I pick dark blue in this case.</p> <p>Q-SoPrA will add the relationship type, as well as any new entities that this relationship type introduces to the network. The upper and lower bounds of the network filter will be reset, as well as the layout. The result can be seen in the screenshot below (I did adjust the position of the nodes and the labels already).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Sixth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Sixth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Sixth_Network-1400.webp"/> <img src="/assets/img/Sixth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 6. </div> <p>You can see that our legend now has two entries. You may also notice that two new entities have been added to the plot, namely the <em>Moratorium plan</em> and the <em>General assembly proposal</em>. If we would inspect their details, we could see that I assigned the attribute <em>Plan</em> to both these entities.</p> <h3 id="creating-modes">Creating modes</h3> <p>So now we have a network with two quite different types of nodes, but we haven’t made this explicit yet in the visualisation. We can do this by assigning modes to the network (see <a href="https://toreopsahl.com/tnet/two-mode-networks/defining-two-mode-networks/">this blog post</a> if you don’t know what modes in a network are). In Q-SoPrA, modes can be assigned to nodes based on attributes that we associated with entities. One attribute that I used while creating entities is the <em>Actor</em> attribute. If I want to create a new mode based on this attribute, I can click the <strong>Create mode</strong> button near the top of the <strong>Legend</strong> menu. This will open a screen with our tree of entity attributes, where we can select an attribute, as well as a node colour, and a label colour to be associated with that mode (see below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Mode_Creation-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Mode_Creation-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Mode_Creation-1400.webp"/> <img src="/assets/img/Mode_Creation.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Creating modes. </div> <p>In the example above, I have selected to create a mode based on the <em>Actor</em> attribute, and I set the node colour to light blue, and the label colour to black. I used the same procedure to create a second mode, using the <em>Plan</em> attribute, but here I set the node colour to green, and the label colour to black. The results of these operations are shown in the screenshot below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Seventh_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Seventh_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Seventh_Network-1400.webp"/> <img src="/assets/img/Seventh_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 7. </div> <p>You can see that Q-SoPrA has automatically changed the colours of the nodes and the labels. Q-SoPrA does this by looking through all entities that were assigned the attribute that serves as the basis for a mode, and then classifying the matching entities in the appropriate mode. You will also see that we now have another legend, which lists the modes that we have just created (the top part of the <strong>Legend</strong> menu).</p> <p>It is of course possible that an entity could be classified in multiple modes, based on the attributes assigned to it. However, any node in the network is allowed to be in only one mode at the same time. Q-SoPrA decides which mode a given entity should be assigned to based on the order in which the modes appear in the mode legend. Modes to the top of the list are always assigned first, which means that modes lower in the list may overwrite those higher in the list.</p> <p>For example, if we now decide to create yet another mode, using one of the children of the <em>Actor</em> attribute (like <em>Individual actor</em>), we will see that some nodes that were previously in the <em>Actor</em> mode will now be in the <em>Individual actor</em> mode (see screenshot below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Eighth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Eighth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Eighth_Network-1400.webp"/> <img src="/assets/img/Eighth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 8. </div> <blockquote> By now, we have a three-mode network, although technically we don't. Yes, that is confusing...<br/><br/> The reason why I say this is that in graph theory, two-mode networks are typically only considered to be two-mode networks if they are structurally bipartite. A network is bipartite if relationships only exist between nodes of two different modes, and never between nodes of the same mode.<br/><br/> In other words, whether or not a network is bipartite is essentially a structural question; we could determine that a network is bipartite by only looking at the patterns of relationships in the network, and without knowing anything about attributes that were assigned to the nodes. <br/><br/> It is of course possible that the graphs you create in Q-SoPrA are also bipartite (or maybe even tripartite) in this structural sense, but this makes no difference for how modes are interpreted in Q-SoPrA, which is purely attribute-based. </blockquote> <p>Since <a href="/blog/2018/attributes-in-qsopra/">my last post</a>, on attributes in Q-SoPrA, I have actually implemented a new feature, which allows you to change the order in which modes are assigned in the network graph widget and the event graph widget (discussed briefly in my <a href="/blog/2018/attributes-in-qsopra/">last post</a>). We can do this by selecting a mode, and then using the <strong>Up</strong> or <strong>Down</strong> buttons to change its position in the list. So, if we move the <strong>Actor</strong> mode to the bottom of the list, this means that the <strong>Individual Actor</strong> mode will be overwritten, as shown below. This allows you to control in a bit more detail how modes are assigned to nodes in the network.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Ninth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Ninth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Ninth_Network-1400.webp"/> <img src="/assets/img/Ninth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 9 </div> <p>This might be a good place to also write something about <em>mode transformations</em>, but with our current graph, there would not be an interesting transformation to look at. Let us therefore first add a little bit more complexity to our graph.</p> <h3 id="parallel-edges">Parallel edges</h3> <p>Q-SoPrA allows you to visualise parallel edges between nodes. These exist when multiple relationships exist between the same pair of nodes. To demonstrate this, I will add three additional relationship types to the graph, showing which actors have (1) shown <em>support</em> for certain plans, (2) offered <em>resistance</em> against them, or (3) shown a somewhat neutral <em>interest</em> in plans (that is, not being explicitly supportive, but also not dismissive of a plan).</p> <p>The resulting network is show below. The graph is quite complex, since all relationships observed over the entire case study period are visualised. Some actors changed their stance towards plans over time. For example, <em>older worker members</em> were first resistant against the <em>Moratorium plan</em>, but later on started showing mild interest, before finally giving the plan full support. Indeed, to see this development, we could simply change the lower and upper bounds of the network visualisation to filter the network, but in this case I want to demonstrate how parallel edges are visualised.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Tenth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Tenth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Tenth_Network-1400.webp"/> <img src="/assets/img/Tenth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 10. </div> <p>You will see that three edges are directed from the <em>Older worker members</em> entity to the <em>Moratorium plan</em> entity, capturing the three different attitudes that the former have had towards the latter. Q-SoPrA will automatically increase the ‘height’ of edge curves if another edge between the corresponding pair of nodes is already visible.</p> <h3 id="mode-transformations">Mode transformations</h3> <p>Now that we have a slightly more complex network, more interesting options for performing mode transformations arise. I think of mode transformations as a way of inferring ‘latent’ (not empirically observed) relationships from empirically observed ones.</p> <p>For example, imagine that we have a case study, in which we empirically observe (1) that some actors communicate with each other, and also (2) that some actors organise activities together. It is possible that we did not empirically observe some actors that co-organise activities also communicating with each other. However, it would actually make sense to assume that they did, because how will you co-organise something without getting in touch with each other?</p> <p>We could of course solve this by assuming that co-organisation entails communication, and thus assigning both relationship types to an incident whenever that incident describes an instance of co-organisation of activities. However, to keep things simple, I like to stick to relationships that I can observe more or less directly in my data, and it can be quite difficult to keep the level of concentration required for this type of double-coding. Therefore, I instead choose to tell Q-SoPrA that whenever two actors co-organised something, that must mean that they have been communicating as well. This is what mode transformations can be used for.</p> <p>In the example case study that we have here, we’ll look at a slightly different situation. We now have a network with several actors who have relationships to each other, but also to plans that have been conceived during the process of interest. One thing we could look at is to see if we can identify coalitions around plans based on the attitudes that actors have towards them.</p> <p>One way to do this would be to say that actors are in a coalition if they support the same plans, or if one of them conceived of a plan, and the other supports it. Creating a new relationship based on these situations will involve multiple transformations.</p> <p>Let us first simplify our network a bit by removing some of the relationships that we won’t be working with, that is, only keeping the <em>conceived of</em> and <em>supports</em> relationships. We can do this by selecting them in the edge legend, and then clicking the <strong>Remove</strong> button at the bottom of the <strong>Legend</strong> menu. See the result below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Eleventh_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Eleventh_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Eleventh_Network-1400.webp"/> <img src="/assets/img/Eleventh_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 11. </div> <p>Our next step could be to create a new relationship type based on situations where one actor conceived of a plan, and another actor supports that plan. After that we will create yet another relationship type for situations where two actors support the same plan. We will later merge these relationships into one. Since it is not possible to create a new relationship type with a label that is already taken by existing one, I will take the following steps:</p> <ol> <li>I will create the first new relationship type and call it <em>is in coalition with A</em>.</li> <li>I will create the second new relationship type and call it <em>is in coalition with B</em>.</li> <li>I will merge the two new relationship types in a third one and call it <em>is in coalition with</em>.</li> </ol> <p>As you will see, merging two relationships will actually remove their original versions from the plot (but not from the data set, unless the relationships were created through transformations, as is the case in this example).</p> <p>So let’s start with the first new relationship type. To create it, I click the <strong>Multimode trans.</strong> button (short for Multimode Transformation). This will open the dialog shown below (where I have already chosen my settings).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Mode_Transformation-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Mode_Transformation-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Mode_Transformation-1400.webp"/> <img src="/assets/img/Mode_Transformation.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Conducting multimode transformations. </div> <p>This dialog can be quite confusing when you first use it, or when you are unfamiliar with mode transformations (also, I take a somewhat different approach than is commonly used in other software, possibly adding to the confusion).</p> <p>We first have to select the modes that will be part of this transformation. We want to create a new relationship type between nodes of the mode <em>Actor</em>, based on the relationships that these nodes have to nodes of the mode <em>Plan</em>. The first mode to select in this dialog (<strong>Mode one</strong>) should always be the mode among which the new relationship type can exist. So, in this case we set <strong>Mode one</strong> to <em>Actor</em>. The second mode should always be the mode to which nodes of the first mode might have a shared relationship (this is exactly like co-affiliation), so in this case we select <em>Plan</em> for <strong>Mode two</strong>.</p> <p>We are not finished yet. We also have to set the relationship types that are to be considered for this transformation. It is possible that our nodes in the <em>Actor</em> mode have different types of relationships to nodes in the <em>Plan</em> mode, which is actually true in this case: Some actors <em>conceive of</em> plans, while others <em>support</em> them. In this case, we set <strong>Relationship ego</strong> to <em>supports</em>, and we set <strong>Relationship alter</strong> to <em>conceived of</em>. Why does it matter which relationship type we assign to ego or alter? Well, in this particular case it actually doesn’t matter. However, imagine that we were creating a relationship type called <em>is supportive of</em>, which is a directed relationship from actors that support plans to actors whose plans they are supportive of. In this case, we would thus want to create a directed relationship type from <em>ego</em> to <em>alter</em>, and then it matters which relationship types are set for ego and alter in the multimode transformation dialog.</p> <blockquote> If this is not clear, then simply trying out different settings will probably clarify things. </blockquote> <p>When we have set the relationship types, we get to the easy part: We need to create a label for the new relationship type, as well as a description. Finally, we need to choose the directedness of the relationship, which in this case we set to <em>Undirected</em>. Now we can save our new relationship type (we will be asked to pick a colour for the new relationship type), and it will be added to the graph. See the result below.</p> <blockquote> The multimode transformation dialog will only allow you to pick between modes and relationship types that are visible in the current network. This helps to simplify the procedure somewhat. </blockquote> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Twelfth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Twelfth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Twelfth_Network-1400.webp"/> <img src="/assets/img/Twelfth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 12. </div> <p>So, the first step is done. You will see that I have added a new relationship type with a pink-ish colour, and which exists between pairs of actors where one of those actors conceived of a plan, and the other actor supported that plan.</p> <p>Now let’s add the other relationship type. We again open the multimode transformation dialog. We set the modes in the same way we did the last time, but now we set the relationships of both ego and alter to <em>supports</em> (see below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Mode_Transformation2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Mode_Transformation2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Mode_Transformation2-1400.webp"/> <img src="/assets/img/Mode_Transformation2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Conducting another multimode transformation. </div> <p>As you will see in the screenshot of the dialog above, with these settings the options for choosing the directedness of the relationship are not available. Since we have set the relationship type for both ego and alter to the same type, it would not make sense to create a directed relationship based on this transformation. Essentially, we do not even have a way to really distinguish between an ego and an alter in this case.</p> <p>For our second relationship type, I have chosen the colour light blue. The result of our second transformation is shown in the screenshot below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Thirteenth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Thirteenth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Thirteenth_Network-1400.webp"/> <img src="/assets/img/Thirteenth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 13. </div> <p>I think the graph is quite pretty like this, but it is not really easy to read. Also, our two relationship types still exist separately from each other. To merge the two relationships, we can use the <strong>Merge</strong> option near the bottom of the <strong>Legend</strong> menu. This will open the dialog shown below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Merge_Dialog-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Merge_Dialog-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Merge_Dialog-1400.webp"/> <img src="/assets/img/Merge_Dialog.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Merging relationships </div> <p>In this case we are shown a list of check boxes, where each check box represents one of the currently visible relationship types. We can use the check boxes to select the relationship types that we wish to merge (we can select more than two). It is not possible to merge relationships that have a different directedness (<em>directed</em> vs. <em>undirected</em>).</p> <p>We are also asked to provide a label and a description for the new relationship type. Then, after saving the new relationship, we are again asked to pick a colour (I picked the colour black this time), and the new relationship will be added in the graph. At the same time, the relationships that we merged will be removed. See the result below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Fourteenth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Fourteenth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Fourteenth_Network-1400.webp"/> <img src="/assets/img/Fourteenth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 14. </div> <p>You can see that our network has already become much simpler after the merger. If we are interested in looking specifically at coalitions, we can hide the other relationship types to simplify things even further. We select them in the edge legend, and click the <strong>Hide</strong> button for each.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Fifteenth_Network-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Fifteenth_Network-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Fifteenth_Network-1400.webp"/> <img src="/assets/img/Fifteenth_Network.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example network 15. </div> <p>We can now see our new relationship type more clearly. We can see a coalition around the <em>General assembly proposal</em> in the bottom, and we can see a coalition around the <em>Moratorium plan</em> in the top. We can also see that there is one actor that appears in both coalitions (<em>Older worker members</em>).</p> <p>While making these transformations, we did actually also lose some information. For example, the newly created relationship types are no longer filterable, because they are not themselves associated with any particular incidents. Thus, if you want to create such networks for a more specific episode of the process, you will have to filter the network from the very beginning. If you wish to compare the network at different points in time, you will have to repeat this procedure several times.</p> <h3 id="exporting-data">Exporting data</h3> <p>We have now already discussed quite some details about how relationships can be used in Q-SoPrA. One thing that we haven’t discussed is the possibility to calculate network metrics. I will immediately say that it is not possible to do this in Q-SoPrA… yet. I do have long-term plans to support the calculation of network metrics, but there are a couple of difficulties that are hard to overcome. For example, in Q-SoPrA you can create quite complex networks, with multiple types of relationships that may differ in directedness. It will be a challenge to create an interface for network metrics that takes all these nuances into account. I want to prevent a situation in which one calculates network metrics that actually do not make a lot of sense for the type of network structure under consideration (for example, certain network measures for one-mode networks have to be adapted before they can be applied to two-mode networks).</p> <p>For now, I work with a much simpler solution: I allow the user to export network data from Q-SoPrA, which can then be imported into other software packages for further analysis. I have chosen to allow exports of node lists and edge lists that are structured in such a way that they can be imported directly into <a href="http://www.gephi.org">Gephi</a>. I have two main reasons for this. First, Gephi is open source software, and I prefer to support an open source solution over a commercial one. Second, data that is imported to Gephi can be exported in many different formats. Thus, I see Gephi as a kind of gateway to other software packages. In addition, the edge list format for Gephi is quite close to the edge list formats used by some other software packages.</p> <p>Exporting network data can be done from the <strong>Controls</strong> menu, using the <strong>Export nodes</strong> button and the <strong>Export edges</strong> button. The latter option will immediately open a dialog where you are asked to select a location and a name for your edge list, which is exported in CSV-format. If you click the <strong>Export nodes</strong> button, you will first be shown a table that shows the node list that will be exported. This list will include the <em>Id</em> of the nodes, the <em>Label</em> of the nodes (the labels are actually identical to the Ids, but this has something to do with how I typically structure the node lists I import into Gephi), the <em>Description</em> of the entities associated with the nodes, and the <em>Mode</em> that the nodes are in (this will be blank if no modes were assigned).</p> <p>In this screen, you can add additional variables to the node list, by clicking the <strong>Add attribute</strong> button. Attributes can be added as a <em>boolean</em>, or as a <em>valued</em> variable. Boolean variables simply indicate whether or not a given attribute was assigned to a node. When you select to add an attribute as a boolean, than a <code class="language-plaintext highlighter-rouge">1</code> will be inserted in the new column if (a) the selected attribute was assigned, or (b) one of the children of the selected attribute was assigned. A <code class="language-plaintext highlighter-rouge">0</code> will be inserted in all other cases. If you select the option to add <em>valued</em> variables, then only the values assigned to the selected attribute will be considered (and not its children). Assigning values to attributes is not something I discussed in this post, but it works exactly the same as explained in <a href="/blog/2018/attributes-in-qsopra/">my earlier post on attributes</a>.</p> <p>In the screenshot below, you see an example where I have added two attributes to the node list that indicate, respectively, whether a node has the attribute <em>collective actor</em> and whether a node has the attribute <em>Individual actor</em>. After adding attributes, the final node list can be exported as a CSV-file by clicking the <strong>Export</strong> button. This will also automatically close this dialog.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Export_Nodes-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Export_Nodes-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Export_Nodes-1400.webp"/> <img src="/assets/img/Export_Nodes.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Exporting nodes. </div> <p>It is also possible to export the visualisation of the network graph you have created. This can be done by clicking the <strong>Export svg</strong> button in the <strong>Controls</strong> menu. This will open a dialog where you are asked to provide a name and location for the SVG-file. The SVG-file can be opened with <a href="https://inkscape.org/en/">Inkscape</a>, which is another wonderful open source tool. In Inkscape you will be able to manipulate your graph further (each element of the graphic can still be manipulated individually), and then export it as (for example) a PNG file or a PDF, with several options to determine the resolution of the exported graphic.</p> <h2 id="final-comments">Final comments.</h2> <p>This concludes my discussion of relationships in Q-SoPrA. I hope it has given you some ideas about how Q-SoPrA can be used for (mostly qualitative) network analysis.</p>]]></content><author><name></name></author><category term="Software"/><category term="Q-SoPrA"/><category term="Non-Technical"/><summary type="html"><![CDATA[Introduction: Process and structure As the name suggests, Q-SoPrA (Qualitative Software for Process Analysis) is focused first and foremost on the qualitative analysis of social processes. However, I invested a lot of time and energy in also creating features that can be used to study how these processes relate to structures. In my opinion, this is a somewhat obvious thing to do, since so many social theories posit some kind of relationship between process and structure (often couched in terms of agency and structure. I can use my own application of Q-SoPrA as an example. I am currently using Q-SoPrA in a study that, conceptually, builds on Schatzki’s concepts of social practices (in short, organised doings and sayings) and social arrangements of people, artefacts, places, and other types of entities. I use event graphs to reconstruct practices as networks of activities (Schatzki also writes about chains of action in this context), and I use more traditional network graphs to reconstruct arrangements as networks of relationships between entities. One aspect of my investigation is to study how unfolding practices relate to (changes in) arrangements.]]></summary></entry><entry><title type="html">Attributes in Q-SoPrA</title><link href="https://wouterspekkink.github.io/blog/2018/attributes-in-qsopra/" rel="alternate" type="text/html" title="Attributes in Q-SoPrA"/><published>2018-01-26T00:26:00+01:00</published><updated>2018-01-26T00:26:00+01:00</updated><id>https://wouterspekkink.github.io/blog/2018/attributes-in-qsopra</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2018/attributes-in-qsopra/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>One of the tasks that you are likely to use Q-SoPrA for is the qualification of incident data, by assigning codes to them (see <a href="/blog/2017/getting-started-with-qsopra/">this earlier post</a> for an explanation of what incidents are). The tools you will use for this are not very different from those that you would typically use to assign codes to interviews or the contents of documents when using <a href="https://en.wikipedia.org/wiki/Computer-assisted_qualitative_data_analysis_software">CAQDAS software</a>. In Q-SoPrA, the codes that are used to qualify incident data are referred to as <em>attributes</em>.</p> <p>You can use attributes to capture any information included in incident data that is meaningful for your study. For example, you could use attributes to distinguish between different types of activities, to identify actors or other entities involved in incidents, to record changes in variables associated with the incidents, and so on. What exactly you will use attributes for will depend heavily on your research question(s), and the theoretical basis of your research. You might of course also use attributes in a ‘grounded research’ approach, where you develop attributes on the fly, and develop these further as you proceed with your project. In this post I try to be mostly agnostic to different ways in which attributes might be used, while discussing various ways in which attributes (can) play a role when using Q-SoPrA in research projects.</p> <p>In this post I discuss four main topics. I first discuss some basic, somewhat technical details of what attributes in Q-SoPrA are, how they can be organised, and how they are stored, and so on (but this is really quite simple). I then discuss different ways in which attributes can be assigned to incidents (and more abstract events; more on this later). This is followed by a brief discussion of various other simple ways to interact with attributes. Finally, I discuss some ways in which attributes can be used in visualisation and analysis.</p> <h2 id="attributes-in-q-sopra">Attributes in Q-SoPrA</h2> <p>Attributes have to be defined by the user. There are three different widgets in which this can be done, but the most obvious ‘place’ to define new attributes is the <em>Attributes Widget</em> (see screenshot below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Attributes_Widget-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Attributes_Widget-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Attributes_Widget-1400.webp"/> <img src="/assets/img/Attributes_Widget.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The Attributes widget. </div> <p>On the left side of this screen you see some fields that show the data associated with the incident that is currently being inspected (the timing, source, description, raw source text, and other comments/memos written by the analyst). On the right side of the screen you can see the attributes view. When you create a new database, this view will be empty. In the bottom-right of the screen you see all controls that are specifically associated with attributes. For example, you find controls to define new attributes, to edit existing ones, to assign the currently selected attribute to the present incident, and etcetera.</p> <h3 id="creating-new-attributes">Creating new attributes</h3> <p>We will focus first on the creation of new attributes. Attributes in Q-SoPrA can be understood to have three main properties:</p> <ol> <li>All attributes have a unique label (or name);</li> <li>All attributes have a description (or definition);</li> <li>Attributes <em>can</em> have a parent attribute.</li> </ol> <p>To create a new attribute, click the <strong>New Attribute</strong> button. This will open the dialog shown below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Attribute_Dialog-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Attribute_Dialog-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Attribute_Dialog-1400.webp"/> <img src="/assets/img/Attribute_Dialog.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The Attribute dialog. </div> <p>You are always required to provide a label and a description for your attributes. If one of these is missing, then Q-SoPrA won’t allow you to save the attribute. Also, the name of the attribute has to be unique. The idea behind forcing you to provide a description is to make you think immediately about the definition of your attribute, and about the phenomena that your attribute is supposed to capture.</p> <h3 id="attribute-hierarchies">Attribute hierarchies</h3> <p>I mentioned above that attributes <em>can</em> have parents. That is, attributes in Q-SoPrA can be hierarchically organised by assigning parents/children to them. A parent is automatically assigned to a new attribute if you select an existing one before clicking the <em>New Attribute</em> button. In this case, the new attribute will be created as a child of the existing attribute you selected. You can re-parent attributes by dragging and dropping them onto other attributes. If you drag an attribute to an empty space in the attribute view, the attribute will be ‘orphaned’, and appear in the highest level of the attribute hierarchy. In this way, you can create as many hierarchical levels of attributes as you like.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Attributes_Tree-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Attributes_Tree-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Attributes_Tree-1400.webp"/> <img src="/assets/img/Attributes_Tree.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The Attributes tree. </div> <p>The position of an attribute in the hierarchy has important consequences. An attribute that has a parent is always considered as a sub-type of that parent. For example, if you have an attribute called <em>Activities</em>, and you have another attribute called <em>Night-time activities</em> that is a child of <em>Activities</em>, then Q-SoPrA assumes that <em>Night-time activities</em> are a kind of <em>Activities</em>. In this way, any attribute can serve as a sort of category for other attributes.</p> <p>The specific organisation of your attributes hierarchy will be important in, among other things, the identification of ‘modes’ in your event graph (modes are discussed in a bit more detail further below): When you create a new mode based on the attribute <em>Activities</em>, then all incidents and events that were assigned an attribute that is a child of <em>Activities</em> (or grandchild, or great-grandchild, or great-great… Well, you get the idea) will also be considered to belong to that mode.</p> <blockquote> Like all other data imported into, or created with Q-SoPrA, attributes are stored in sql tables. One of these tables simply lists the names, descriptions and parents of attributes. The parent of an attribute is either (1) one of the other attributes, or (2) a string called 'NONE', which tells Q-SoPrA that the attribute exist at the highest level of the attributes hierarchy. </blockquote> <h2 id="assigning-attributes">Assigning attributes</h2> <p>After you create an attribute, you can assign the attribute to <a href="/blog/2017/getting-started-with-qsopra/">incidents</a> in your data set. The attributes widget lets you scroll through all incidents in your data set, and assign attributes to them. Assigning an attribute to an incident can be done by first selecting it in your attributes tree, and then clicking the <em>Assign attribute</em> button.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Assigning_Attribute-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Assigning_Attribute-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Assigning_Attribute-1400.webp"/> <img src="/assets/img/Assigning_Attribute.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Assigning an attribute. </div> <p>If an attribute has been assigned to the incident that you are currently inspecting, it will show up in the attributes tree with a <strong>bold</strong> font. If an attribute has a child that has been assigned to the currently inspected incident, then it will show up in the attributes tree with an <em>italic</em> font. If an attribute is assigned to the incident, and also has a child that was assigned to the same incident, it will show up with a font that is both <strong><em>italic and bold</em></strong>.</p> <p>After assigning an attribute, it is also possible to give the attribute a value. This value can be anything from a numeric value to a string of words. Assigning a value can only be done after assigning the attribute itself. The value can be typed into the appropriate field (the <strong>Value</strong> field below the attributes tree), and then stored by clicking the <em>Store value</em> button (which is greyed out in the screenshot above).</p> <blockquote> Combinations of attributes and incidents are stored in a separate sql-table. Each row in this table records (1) the name of the attribute, (2) the ID of the incident that the attribute was assigned to, and (3) the value of the attribute (if one was assigned). </blockquote> <p>You may have noticed in the screenshot above that a small fragment of the text in the <em>Raw</em> field is highlighted (it is underlined and it is bolded). As I explained in a <a href="/blog/2017/getting-started-with-qsopra/">previous post</a>, the <em>Raw</em> field is used to record any fragments of text from your sources (for example, interviews, documents, news items, and etcetera) that were the basis for creating the incident. Q-SoPrA allows you to associate fragments of text in the <em>Raw</em> field with attributes that you assign to incidents (you can also assign an attribute without highlighting text). Associating a fragment of text with an attribute can be achieved by (1) selecting the attribute, (2) selecting a piece of text with your mouse cursor, and (3) then clicking the <em>Assign attribute</em> button. Even when an attribute has already been assigned, you can assign additional fragments of text to the attribute by using this procedure. If fragments of text are assigned to an attribute, these will be highlighted whenever the attribute is selected.</p> <blockquote> The fragments of text assigned to combinations of attributes and incidents are stored in yet another sql table. In this case the rows of the table record (1) the name of the attribute, (2) the name of the incident that the attribute was assigned to, and (3) the fragment of text that is associated with the attribute-incident combination. Multiple fragments of text may exist per attribute-incident combination. </blockquote> <h3 id="assigning-attributes-in-the-event-graph-widget">Assigning attributes in the Event Graph Widget</h3> <p>There are two other ‘places’ in Q-SoPrA where attributes can be assigned to incidents (or events). One of these places is the <em>Event Graph Widget</em>. I won’t go into the details of the <em>Event Graph Widget</em> here, but, briefly, the <em>Event Graph Widget</em> is what you will use to visualise (1) incidents and/or events, and (2) relationships between these incidents/events. An event graph gives an abstract overview of the process of interest, and how different developments in the process are related.</p> <p>You can also use the <em>Event Graph Widget</em> to build more abstract events from your incident data. I will dedicate a future post to an explanation of how exactly this works, but the basic idea underlying the creation of abstract events is that you take a group of inter-related incidents, and say that these together constitute some larger event. For example, we might have a few incidents that capture meetings between actors ‘X’ and ‘Y’ that took place over time, and group these together in an event that we describe as ‘X and Y meet over an extended period of time.’ Abstract events are different from your incidents, because they are constituted from incidents, and thus an additional level above your data (or even more than one level, because you can also use abstract events as building blocks for yet more abstract events).</p> <p>In the screenshot below you see an example of an event graph that includes incidents, as well as an abstract event that has been built from incidents.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Event_Graph_1-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Event_Graph_1-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Event_Graph_1-1400.webp"/> <img src="/assets/img/Event_Graph_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example Event Graph 1. </div> <blockquote> In the screenshot above, notice how the labels of most nodes are numbers, whereas there is one node (the wide elipse) that has the label "P-3". This node is an abstract event, and the labels of abstract events are based on what type of constraints were used when creating them. I will discuss the details of the possible constraints in a future post.<br/><br/>If you are curious, check out Peter Abell's approach to abstracting narrative graphs, as outlined in his book "The Syntax of Social Life" (1987), which is unfortunately very hard to get hold of for a reasonable price (I got lucky one time). I based two types of constraints on Abell's approach: (1) path based constraints (which are quite severe) and (2) semi-path based constraints (which are far less severe). The label of an abstract event will always start with a "P-" if it was created with path based constraints, and it will always start with an "S-" if it was created with semi-path based constraints. </blockquote> <p>In the left part of the screenshot, you see some details of the currently selected incident (the same details you would see in the <em>Attributes Widget</em>), as well as an attributes tree. In the <em>Event Graph Widget</em>, you can select any incident, and then assign attributes to them in the same way you would do this in the <em>Attributes Widget</em>.</p> <p>One important difference is that, in this case, you can also assign attributes to abstract events. This works largely in the same way (you select an abstract event in the event graph, after which you can assign attributes), with the exception that you cannot associate a particular fragment of text with the attribute-event combination. This is because the abstract events don’t have ‘raw’ data directly associated with them (indeed, ‘raw’ data can still be indirectly associated, through the incidents that constitute abstract events). Abstract events therefore don’t have a <em>Raw</em> field (see the screenshot below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Event_Graph_2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Event_Graph_2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Event_Graph_2-1400.webp"/> <img src="/assets/img/Event_Graph_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example Event Graph 2. </div> <h3 id="assigning-attributes-in-hierarchy-graphs">Assigning attributes in Hierarchy Graphs</h3> <p>Say that you have created an event graph in which you have abstracted numerous events. In the event graph, the incidents and events that were made into components of more abstract events are no longer visible themselves. This is a problem when you want to inspect those incidents and events, or when you want to change something in the attributes that you assigned to them. This is why I introduced <em>Hierarchy Graphs</em> to Q-SoPrA. Hierarchy graphs visualise the complete hierarchy of a given abstract event in your visible event graph. A hierarchy graph for a given abstract event can be inspected by selecting the event in your event graph, and then clicking the <em>Components</em> button (see screenshot below);</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Details_Screen-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Details_Screen-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Details_Screen-1400.webp"/> <img src="/assets/img/Details_Screen.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Inspecting an abstract event. </div> <p>Clicking this button will cause Q-SoPrA to switch to the <em>Hierarchy Graph</em> widget, where the hierarchy of the currently selected event will be visualised.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Hierarchy_Graph-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Hierarchy_Graph-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Hierarchy_Graph-1400.webp"/> <img src="/assets/img/Hierarchy_Graph.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The Hierarchy Graph. </div> <p>In the screenshot above, we are inspecting the hierarchy of abstract event “P-3”, which consists of two other abstract events “P-1” and “P-2”, which, in turn, each consist of three incidents (<strong>P-1</strong>: 14, 15, 16, and <strong>P-2</strong>: 17, 19, 20).</p> <p>In this screen, we can select all visible events individually. As you can see, we again have the attributes tree available to the left of the screen, and we can assign attributes in the same way we would in the <em>Event Graph Widget</em>. Hierarchy graphs are thus the third ‘place’ where you can assign attributes to incidents (and events).</p> <h2 id="other-interactions-with-attributes">Other interactions with attributes</h2> <p>Of course, assigning attributes to incidents is not the only type of interaction with attributes that we need. Occasionally, we will want to edit the name or the description of an attribute, which can be done by selecting the attribute in the attributes tree, and clicking the <em>Edit attribute</em> button. This will simply open the dialog that we have seen before (when creating a new attribute), but with the details of the currently selected attribute already filled in.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Attribute_Options-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Attribute_Options-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Attribute_Options-1400.webp"/> <img src="/assets/img/Attribute_Options.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Editing attributes. </div> <p>If we want to unassigning an attribute, we just select it in the attributes tree, and click the <em>Unassign attribute</em> button. We can also remove all attributes that are not currently being used by clicking the <em>Remove unused attributes</em> button.</p> <blockquote> I did not include the possibility to simply remove an attribute by clicking some kind of delete button. I thought that having this option is risky, because you might delete an attribute that you assigned to some other incident, for good reasons, that you have forgotten about. The only way you can thus get rid of attributes for good is by unassigning them from all incidents, and then clicking the <b>Remove unused attributes</b> button. </blockquote> <p>If there are fragments of ‘raw’ texts associated with the attribute, we can either select one of these fragments and click the <em>Remove text</em> button to remove an individual fragment, or we can simply click the <em>Reset texts</em> button to remove all fragments associated with the selected attribute (of course, this will only remove fragments that are associated with the combination of this attribute and the currently inspected incident). Any fragments of ‘raw’ text associated with an attribute will also be removed when you unassign the attribute.</p> <p>We can also navigate incidents via attributes, by selecting an attribute, and clicking the <em>Previous coded</em> or the <em>Next coded</em> button, which will jump to the previous/next incident that was assigned to the selected attribute (or one of its children).</p> <p>One other thing you’ll notice in the screenshot above is the tool tip that is displayed when you hover your mouse over an attribute in the attributes tree. The tool tip will show the description that you gave the attribute, making it easy for you to read the description without having to open another dialog.</p> <h3 id="attributes-in-tables">Attributes in tables</h3> <p>There are a few other widgets in which attributes appear. These are tables that, for your convenience, present information that we have already seen in a somewhat different form. For example, in the screenshot below you see a table of attributes, the incidents they were assigned to, and the fragments of ‘raw’ texts associated with them.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Table_1-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Table_1-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Table_1-1400.webp"/> <img src="/assets/img/Table_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Attribute table. </div> <p>This particular table is mostly useful for a comparison of the various fragments of ‘raw’ text that are associated with an attribute. Based on such comparisons you can make decisions about, for example, the appropriateness of the name and description that you assigned to a given attribute. This is particularly useful in more grounded approaches to coding, where you will be revising your coding scheme (or, in this case, attribute scheme) repeatedly as you progress with your study.</p> <p>In this table, incidents are identified by a number that corresponds to the order in which incidents appear (this is used as the primary way to identify incidents to the user throughout Q-SoPrA). Indeed, this number alone won’t tell the user very much, but as the screenshot above demonstrates, the description that was given to incidents can be revealed by hovering the mouse cursor over them.</p> <p>It is possible to filter this table by using the filter field below the table. You can apply this filter to any of the visible table columns. The table can also be sorted by double clicking one of the column headers, and the order of columns can be changed by dragging columns to another place. Fragments of text can be removed by selecting a row in the table and clicking the <em>Remove selected</em> button. Attributes can be edited by selecting a row in the table and clicking the <em>Edit attribute</em> button. Finally, the table currently being shown can be exported by clicking the <em>Export visible table</em> button.</p> <p>Another table in which attributes appear is shown in the screenshot below. In this case, the table shows attributes, the incidents that they were assigned to, and the values that were given to the attributes. The screenshot shows an example where I am inspecting an attribute that I used to map projects to which the activities recorded in incidents are related. To do this, I simply created an attribute called project, and I gave values to the attribute to indicate which project a given incident (activity) belongs to.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Table_2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Table_2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Table_2-1400.webp"/> <img src="/assets/img/Table_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Another attributes table. </div> <p>Like the previous table, this table can be filtered. Values that were assigned to attribute-incident combinations can be changed in this table by clicking the <em>Edit value</em> button. It is also possible to export a matrix of incident-attribute combinations. The exported matrix will be an incidence matrix, where the incidents appear in the rows, and the attributes appear in the columns. If you choose to use the <em>Export normal matrix</em> option, the cells of this table will show a <code class="language-plaintext highlighter-rouge">1</code> if the corresponding incident-attribute combination exists, and a <code class="language-plaintext highlighter-rouge">0</code> if it doesn’t. If you choose to use the <em>Export valued matrix</em> option, the cells will instead show the values that were assigned to incident-attributes combinations, wherever these are available. If no value was given, then the table will again show either a <code class="language-plaintext highlighter-rouge">1</code> or <code class="language-plaintext highlighter-rouge">0</code> depending on whether the corresponding incident-attribute combination was observed.</p> <p>The final table I will discuss here is the one shown in the screenshot below. This is actually not a table in which attributes appear. Instead, it is a table that shows all incidents that do not have an attribute assigned to them. When you are coding a large data set, you are likely to at some point overlook something. For example, you may have inserted a new incident somewhere in your data set at some point, but you have forgotten to assign attributes to it. The table shown below makes it easier to spot any incidents that you may have forgotten about. In the example offered in the screenshot, the incidents shown are simply the incidents that I haven’t gotten to yet in the coding process.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Table_3-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Table_3-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Table_3-1400.webp"/> <img src="/assets/img/Table_3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Missing attributes table. </div> <p>This table has something special, which is the last column of the table, called <strong>Marked</strong>. In Q-SoPrA all incidents can be marked, which simply makes it easier to find them back when using one of the coding widgets (in these widgets, you have the possibility to jump back and forth between incidents that are marked, skipping all other incidents). In this table, you can mark an incident by clicking its corresponding check box in the last column.</p> <h2 id="attributes-in-visualisations">Attributes in visualisations</h2> <p>So, now we get to the last major part of this post, which is about how to use attributes in visualisations, which can be one step in your analysis of the data.</p> <h3 id="attributes-in-event-graphs">Attributes in event graphs</h3> <p>We have already seen the <em>Event Graph Widget</em> and how we can assign attributes to incidents/events there. Attributes can also be used to manipulate the visualisation of event graphs. One thing we can do is to create <em>modes</em> in the network based on attributes. In Q-SoPrA, a mode can be understood as a special identifier for nodes in the event graph (modes also appear in network graphs, but this is yet another topic that I will need to discuss in a future post). Any node (incident or abstract event) in the event graph can only have one mode at a time. What mode a given node belongs to is made visible by giving it a distinct colour.</p> <p>In order to achieve this, the user has to create a mode. This can be done from the legend menu (see screenshot below). In the screenshot the legend is currently empty, because no modes have been created yet. A new mode can be created by clicking the <em>Create mode</em> button (in the bottom-right area of the screenshot). This will open a dialog with the attributes tree, as well as a few buttons that can be used to choose a colour for the mode (colours can be chosen for the nodes and for the labels).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Event_Graph_Mode-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Event_Graph_Mode-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Event_Graph_Mode-1400.webp"/> <img src="/assets/img/Event_Graph_Mode.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Modes in Event Graphs. </div> <p>After choosing an attribute and the colours to be associated with it, we can save the new mode. Q-SoPrA will immediately identify all nodes in the graph that were assigned the selected attribute, <em>or one of its children.</em> I emphasise the last bit, because it is important to realise that modes in the event graph are inclusive in the following sense: A mode is identified by an attribute, as well as by all children of that attribute. Thus, in the screenshot below, all the red coloured nodes can be understood as incidents in which some kind of <em>meeting</em> took place, without specifying what type of meeting we are referring to. A label identifying the newly created mode will also be shown in the legend, to the right of the screen.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Event_Graph_Mode_2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Event_Graph_Mode_2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Event_Graph_Mode_2-1400.webp"/> <img src="/assets/img/Event_Graph_Mode_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Modes in Event Graphs 2. </div> <p>Modes are, in a sense, also hierarchical. In deciding what mode an incident or abstract event should be assigned to, Q-SoPrA will always work its way from the top of the list of modes (the legend) to the bottom. Any modes that appear near the bottom of the list will overrule modes that appear above them. For example, In this case, we could add an additional mode that refers to a more specific kind of meeting (a child of the <em>Meetings</em> attribute).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Event_Graph_Mode_3-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Event_Graph_Mode_3-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Event_Graph_Mode_3-1400.webp"/> <img src="/assets/img/Event_Graph_Mode_3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Modes in Event Graphs 3. </div> <p>In the screenshot above, you will see that two nodes have been switched to another mode (incidents 22 and 24). In this case, the attribute <em>Knowledge-oriented meetings</em> overruled the attribute <em>Meetings</em> in deciding which mode should be assigned to these incidents.</p> <p>So what happens if we add a mode that is associated with a parent of the <em>Meetings</em> attribute, rather than a child? Let’s test this by creating a mode based on the <em>Organizational activities</em> attribute, which is the parent of the <em>Meetings</em> attribute.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Event_Graph_Mode_4-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Event_Graph_Mode_4-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Event_Graph_Mode_4-1400.webp"/> <img src="/assets/img/Event_Graph_Mode_4.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Modes in Event Graphs 4. </div> <p>As you see in the screenshot shown above, this causes the earlier created modes to be overruled. Imagine that, at this point, we realise that we have made a mistake; that it was never our intention to overrule our first two modes. We can easily recover from this situation by selecting the last mode we created, and clicking the <em>Remove mode</em> button. This will remove the mode from the event graph, and Q-SoPrA will automatically reassign the earlier created modes, basically reverting the graph to the version we saw earlier.</p> <blockquote> I plan to make playing around with the modes even easier, by adding the option to move modes up or down in the hierarchy. This will be implemented in a future version of Q-SoPrA. </blockquote> <p>These modes are not just for visualisation purposes. One feature of Q-SoPrA that makes use of modes is the creation of transition matrices. These matrices show how often an event of a given mode has a relationship to an event of another given mode. Making such matrices can tell you a lot about how different types of events in your graph tend to be related. For example, it can give you crude measures of how likely an event of a given type is to be followed by various other types of events.</p> <p>In the screenshot below, I have assigned modes that cover nearly all of the incidents visible in the current screen.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Event_Graph_Mode_5-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Event_Graph_Mode_5-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Event_Graph_Mode_5-1400.webp"/> <img src="/assets/img/Event_Graph_Mode_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Modes in Event Graphs 5. </div> <p>What I can do now, is to click the button <em>Export transitions</em>. This will open a new dialog (shown below), where I can choose what kind of transition matrix I want to export.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Transitions_Dialog-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Transitions_Dialog-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Transitions_Dialog-1400.webp"/> <img src="/assets/img/Transitions_Dialog.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Transitions dialog. </div> <p>Now, the first two options shown here (modes vs. attributes) require a bit of explanation. In the above, we have learned that any incident can have only one mode at a time. However, an incident can of course have multiple attributes, and sometimes we will want to take <em>all</em> attributes into account when calculating transitions, rather than taking into account only the currently assigned modes. This is basically what you can do by selecting the <em>Attributes based</em> option in the dialog shown above. In this example, we’ll go with the <em>Modes based</em> option instead.</p> <p>The other two options are much more straightforward: You can either (1) export a transition matrix with the raw counts of the observed transitions, or (2) export a transition matrix where these counts were divided by the row marginals (the number of times the source event of the transition appears), which converts the value into a crude measure of probability. We’ll go with the latter option.</p> <p>Q-SoPrA will now ask us what we want to name our file (which is a csv-file), and where we want to store it. After saving the file, we can open it with a spreadsheet editor, like LibreOffice Calc or Microsoft Excel. In the screenshot below, I show the matrix I exported from the last version of the event graph. I slightly edited the matrix before making the screenshot, adding bold fonts to the rows and columns, making the final row and column italic font, and formatting the transition probabilities to show 4 decimal numbers.</p> <blockquote> As you will see below, the transition matrices that Q-SoPrA exports always contain a column with the row marginals. Thus, if you export a transition matrix with the raw counts, then you can easily calculate probabilities yourself by dividing these counts by the row marginals.<br/><br/> In addition to the row marginals, the transition matrices will always include a row with the number of times the different event times participated in transitions (as the source event). </blockquote> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Transitions_Matrix-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Transitions_Matrix-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Transitions_Matrix-1400.webp"/> <img src="/assets/img/Transitions_Matrix.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Transition matrix. </div> <p>One of the things we see in this table is that, based on the observed event graph (which I filtered to only show the first 26 incidents), there is a probability of 0.6 that an event of the mode <em>Meetings</em> followed an event of the same mode. Given that the row marginal for this mode is 10, this must mean that this particular transition was observed 6 times (6/10 = 0.6). We also see that it is as likely that an event of the mode <em>Planning</em> follows an event of the mode <em>Communication</em> as it is to follow an event of the mode <em>Group formation</em> (0.5 probability in both cases). You can do a visual check of our screenshot of the event graph to confirm this.</p> <p>Of course, with this small number of observations, these numbers are unlikely to be very meaningful. However, I hope the example demonstrates how transition matrices can be useful in summarising patterns in your data. Patterns like these will be especially hard to detect without transition matrices once you start considering larger numbers of incidents/events.</p> <h3 id="attributes-in-occurrence-graphs">Attributes in occurrence graphs</h3> <p>The last thing I will discuss here is the use of attributes in the creation of <em>Occurrence Graphs</em>. Occurrence graphs visualise which attributes co-occur at which points in time. Attributes can co-occur, for example, because they are assigned to the same incident, because they are assigned to incidents/events that were grouped in the same abstract event, or because they are assigned to incidents that occurred in parallel (incidents and events can be made parallel in the <em>Event Graph Widget</em>).</p> <p>Occurrence graphs are basically a slightly adapted variant of <a href="/blog/2017/bi-dynamic-line-graphs/">Bi-Dynamic Line Graphs (BDLGs)</a>, which, I should emphasise, is not a type of graph I came up with myself (see the link to my earlier post on BDLGs to learn more about them). I will discuss occurrence graphs in more detail in another post, and only touch on some basic details here.</p> <p>In an occurrence graph, attribute-incident (or attribute-event) combinations are visualised as nodes. The position of the nodes on the horizontal axis is based on the chronological ordering of the incidents/events (this ordering can also be matched to that of customised event graphs). In the occurrence graphs edges only appear between nodes that refer to the same attribute, and they always point to the next attribute-incident (or attribute-event) combination in which that attribute occurs. When attributes co-occur, their attribute-incident (or attribute-event) nodes appear at the same coordinate of the horizontal axis.</p> <p>Occurrence graphs can thus be understood to show the ‘history’ of one or more attributes’ appearance/involvement in the process of interest. Imagine that you have a set of attributes that identify different actors that participate in the process your are studying. An occurrence graph can give you a quick overview of (1) when these actors were active, (2) how frequently they were active, and (3) which actors tend to be involved in the same incidents/events. For another example, imagine that you have a set of attributes that identify different types of activities that occur in incidents/events. An occurrence graph can give you a quick overview of (1) when these activities occur, (2) how frequently these activities occur, and (3) which activities are typically carried out in combination.</p> <p>Q-SoPrA has a separate widget for the visualisation of occurrence graphs. An occurrence graph is built by adding attributes one by one, as I will demonstrate in the example below.</p> <p>In this example, I will use an occurrence graph to study a specific issue of interest me. The data set that I use in this example records the emergence and development of a community sustainability initiative, somewhere in the UK. One of the ambitions of the initiative is to stimulate people in the community to adopt more sustainable practices (that is, what the members of the initiative understand to be sustainable practices, like growing your own food, commuting by bicycle rather than by car, crafting your own products from locally sourced materials, and so on). I have various attributes that refer to these different kinds of practices, and these all share a parent that I called <em>Sustainability practices</em>. What I want to know is what other activities the members of the initiative use to promote sustainable practices. One way to do this is to study what other activities the <em>Sustainability practices</em> co-occur with.</p> <p>The first thing that I do is to add the <em>Sustainability practices</em> attribute to my occurrence graph. As was the case with modes in the event graphs, this will create nodes for all incidents that have the <em>Sustainability practices</em> attribute assigned to them, <em>or</em> one of its children.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Occurrence_Graph-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Occurrence_Graph-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Occurrence_Graph-1400.webp"/> <img src="/assets/img/Occurrence_Graph.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example Occurrence Graph 1. </div> <p>Q-SoPrA will plot the nodes that refer to the same attribute on a straight line, where the position of the nodes on the horizontal axis respects their position in the chronological order of incidents. A small portion of the graph is shown in the screenshot above. Not terribly exciting, is it?</p> <p>Let’s add some other attributes. One of the things that I learned is that members of the community sustainability initiative I studied like to make use of workshops to teach other members of the community certain skills associated with <em>Sustainability practices</em>. I therefore add an attribute that I used to capture the occurrence of workshops, called <em>Initiative workshop</em>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Occurrence_Graph_2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Occurrence_Graph_2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Occurrence_Graph_2-1400.webp"/> <img src="/assets/img/Occurrence_Graph_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example Occurrence Graph 2. </div> <p>There are immediately quite some co-occurrences that appear in the graph (see the screenshot above for a fragment of the graph). I made sure that Q-SoPrA initially plots all attributes-incident combinations on their own line, and that combinations that co-occur appear close to each other, so that co-occurrences are more pronounced (of course, you can move the nodes around a bit to adapt the visualisation).</p> <p>What I unfortunately cannot show you without flooding this post with screenshots is that the occurrence graph shows that workshops occur quite often, but mostly in a particular episode of the process. Thus, it is interesting to explore some other types of activities that might be used to promote <em>Sustainability practices</em> to see if these are perhaps bound to certain episodes as well. The next attribute I’ll add is <em>Competition</em>, which captures those occasions where members of the community sustainability initiative organised some kind of competition to engage people in certain practices (e.g., cycling competition, a competition for who builds the nicest planter, and more).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Occurrence_Graph_3-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Occurrence_Graph_3-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Occurrence_Graph_3-1400.webp"/> <img src="/assets/img/Occurrence_Graph_3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example Occurrence Graph 3. </div> <p>The screenshot above shows just a small segment of the graph, but it shows one example where a <em>Competition</em> co-occurs with <em>Sustainability practices</em>. Actually, these co-occurrences appear in various parts of the graph, but overall they appear more sporadically than those of <em>Sustainability practices</em> and <em>Workshops</em>.</p> <p>For this example, let me add just one more attribute. In this case I added the attribute <em>Door-to-door advice</em>, which is an activity in which members of the initiative went door-to-door in their community to provide community members advice about energy saving measures that can be taken at home.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Occurrence_Graph_4-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Occurrence_Graph_4-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Occurrence_Graph_4-1400.webp"/> <img src="/assets/img/Occurrence_Graph_4.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Example Occurrence Graph 4. </div> <p>As the screenshot above shows, I apparently only used this attribute once. There are no edges going into, or out from the yellow node shown in the screenshot, indicating that the node only appears once in this graph. The fact that this activity only occurs once is easily explained. The activity was carried out as part of a project for which the community sustainability initiative obtained funding, and which was dedicated to implementing and promoting energy saving measures in the community. As part of the project, some members of the initiative were trained to provide personalised energy advice, and these members went door-to-door in their community. Of course, this is a relative expensive operation for a small initiative, and it is not something you would expect to happen on a regular basis. The organisation of workshops, for example, typically requires lower investments of time and money, which perhaps makes it a more attractive type of activity for the initiative to make use of.</p> <p>If we really want to make a more in-depth analysis, we would of course not stop here, and we would probably repeatedly go back and forth between our underlying data, the occurrence graph, and other visualisations and tools, but I think this small example gives you a basic idea of what you can do with attributes and occurrence graphs.</p> <p>There is just one other thing I want to demonstrate. If you are familiar with <a href="https://en.wikipedia.org/wiki/Computer-assisted_qualitative_data_analysis_software">CAQDAS</a>, then you are probably also familiar with the concept of co-occurrence of codes. Basically, the occurrence graphs visualise a certain type of co-occurrence, a type that is sensitive to temporal order. However, it can also be useful to just have an aggregate measure of co-occurrence, like you would have in most <a href="https://en.wikipedia.org/wiki/Computer-assisted_qualitative_data_analysis_software">CAQDAS</a>. After creating an occurrence graph in Q-SoPrA it is possible to export a (co-)occurrence matrix that records aggregate measures of (co-)occurrence. The screenshot below shows an example of such a matrix.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Occurrence_Matrix-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Occurrence_Matrix-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Occurrence_Matrix-1400.webp"/> <img src="/assets/img/Occurrence_Matrix.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Occurrence matrix. </div> <p>The diagonal of the matrix simply shows how often a given attribute occurs overall. The other cells of the matrix show co-occurrences of the attributes associated with the corresponding rows and columns. This matrix basically gives us similar information to the occurrence graphs we studied earlier. For example, it shows that, when workshops occur, they typically co-occur with sustainability practices. It also shows that workshops were used more often than competitions, and that door-to-door advice occurred only once. Of course, what the matrix does not show us is when in the process all these activities (co-)occurred, so with the matrix we do loose some potentially relevant information.</p> <h2 id="closing-comments">Closing comments</h2> <p>There are of course more things that can be done with attributes. It is relatively easy to export data from Q-SoPrA, and to import it into some other software package for further analysis. For example, you could try to import the incidence matrix of incidents and attributes into some network visualisation tool, and make a network graph of what attributes are related to what incidents, giving you an overview that is otherwise perhaps hard to obtain.</p> <p>It is very likely that I will also be adding additional features to Q-SoPrA over time. For now, I hope that the above demonstrates how attributes in Q-SoPrA can support in the analysis of social processes.</p>]]></content><author><name></name></author><category term="Software"/><category term="Q-SoPrA"/><category term="Non-Technical"/><summary type="html"><![CDATA[Introduction One of the tasks that you are likely to use Q-SoPrA for is the qualification of incident data, by assigning codes to them (see this earlier post for an explanation of what incidents are). The tools you will use for this are not very different from those that you would typically use to assign codes to interviews or the contents of documents when using CAQDAS software. In Q-SoPrA, the codes that are used to qualify incident data are referred to as attributes.]]></summary></entry><entry><title type="html">QSqlTableModels, booleans and check boxes</title><link href="https://wouterspekkink.github.io/blog/2018/qsltablemodels-booleans-and-check-boxes/" rel="alternate" type="text/html" title="QSqlTableModels, booleans and check boxes"/><published>2018-01-19T10:07:00+01:00</published><updated>2018-01-19T10:07:00+01:00</updated><id>https://wouterspekkink.github.io/blog/2018/qsltablemodels-booleans-and-check-boxes</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2018/qsltablemodels-booleans-and-check-boxes/"><![CDATA[<h2 id="interfacing-with-sql-databases-with-qt5">Interfacing with sql databases with Qt5</h2> <p>This post is on an issue that I struggled with very recently, while working on Q-SoPrA. What I wanted to achieve was relatively simple: I wanted to have tables that fetch data from sql databases, and in which one column shows check boxes to set/unset a boolean variable. The screenshot below shows an example.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/table-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/table-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/table-1400.webp"/> <img src="/assets/img/table.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> An example table. </div> <p>What you see in the screen shot is <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> widget that shows data that it fetches from a <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> that interfaces with a table of a <a href="https://sqlite.org/">sqlite</a> database. This post is about how to create the interactive check boxes shown in the right-most column. There are two main hurdles in getting the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> widget to work with check boxes:</p> <ol> <li>Sqlite databases don’t actually support boolean variables. You can use an integer variable to ‘simulate’ a boolean variable by setting it to <code class="language-plaintext highlighter-rouge">0</code>(for <code class="language-plaintext highlighter-rouge">false</code>) or <code class="language-plaintext highlighter-rouge">1</code> (for <code class="language-plaintext highlighter-rouge">true</code>), but you will of course need to do a bit of extra work to make the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> properly treat it as a boolean (or something that can be switched on or off) in read &amp; write operations. This can be done by sub-classing the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a>, and re-implementing its <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#flags">flags()</a>, <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#data">data()</a> and <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#setData">setData()</a> functions, as suggested <a href="http://www.qtcentre.org/threads/12008-QSqlTableModel-and-checkboxes-with-SQLite-database">here</a>.</li> <li>But if you do that, you’ll have a quite ugly looking table, since the check boxes are all left-aligned in their column, with no obvious way to change that. In this case, the only solution seems to be to use a <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a> to handle the <code class="language-plaintext highlighter-rouge">paint()</code> function that determines how the column is visualised. A somewhat outdated example of how to do that is offered in the <a href="https://wiki.qt.io/Technical_FAQ#How_can_I_align_the_checkboxes_in_a_view.3F">Qt FAQ</a>.</li> </ol> <p>For good results in my use-case, where I want to have check boxes that (1) are able to handle a ‘pretend boolean’ variable (a boolean that is actually an integer) from a sqlite database, and (2) are not all aligned to the extreme left of their column, you have to combine the two solutions mentioned above. I haven’t really encountered a worked out example of this combination, which is why I decided to provide one in this post.</p> <p>In the below, I briefly outline how you could achieve a result like the one shown in the screenshot above.</p> <details> <summary>In case you are not familiar with Qt5...</summary> <blockquote> <a href="https://www.qt.io/">Qt5</a> is a popular library for C++ that can be used for the development of Graphical User Interfaces (GUIs). It also includes a module that allows for easy interfacing of your program with sql databases. I make heavy use of the Qt5 library for the development of Q-SoPrA, including the possibilities it offers for interfacing with <a href="https://sqlite.org/">sqlite</a> databases. Qt5 comes packed with a number of great <a href="https://doc.qt.io/qt-5.10/sql-programming.html">sql database classes</a>, such as <a href="https://doc.qt.io/qt-5.10/qsqldatabase.html">QSqlDatabase</a>, <a href="https://doc.qt.io/qt-5.10/qsqlquerymodel.html">QSqlQueryModel</a>, <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a>, <a href="https://doc.qt.io/qt-5.10/qsqlrelationaltablemodel.html">QSqlRelationalTableModel</a>, and <a href="https://doc.qt.io/qt-5.10/qsqlquery.html">QSqlQuery</a>. <br/><br/>For the development of Q-SoPrA, I make use of most of all these classes, although often a sub-classed version of them in which I re-implemented some of their member functions. <br/><br/>I think a very common setup for interfacing with sql databases is to have a <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> (or <a href="https://doc.qt.io/qt-5.10/qsqlrelationaltablemodel.html">QSqlRelationalTableModel</a>) that fetches data from a table in your sql database, a <a href="https://doc.qt.io/qt-5.10/qsortfilterproxymodel.html">QSortFilterProxyModel</a> that reads from the QSqlTableModel and acts as a 'filtering layer', and a <a href="https://doc.qt.io/qt-5.10/qtableview.html">QTableView</a> that reads from the filter and displays the results on the user's screen. This is also the kind of setup that I use for several widgets that I included in Q-SoPrA, although I typically subclass the QSqlTableModel / QSqlRelationalTableModel to change some of the ways in which the data is presented to the user (such as tool tip behaviour). </blockquote> </details> <p><br/></p> <h2 id="an-assumption-about-your-pretend-boolean-variable">An assumption about your ‘pretend boolean’ variable</h2> <p>In the below I make one main assumption about your ‘pretend boolean’ variable, which is that this variable is stored in one of the tables of your sql database as an integer, and that you programmatically set this integer to <code class="language-plaintext highlighter-rouge">0</code> or <code class="language-plaintext highlighter-rouge">1</code> whenever necessary. I tend to use the <a href="https://doc.qt.io/qt-5.10/qsqlquery.html">QSqlQuery</a> class for this, but as Doug Forester pointed out in the comment section below, this is a bit inefficient. Instead, it is enough to subclass the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> and re-implement some of its functions as discussed further below.</p> <p>Before showing how this works, I should add that in the particular use case discussed here, the pretend boolean is stored in a particular column of the sql table that my <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> interfaces with. In the code snippets below you will regularly see a conditional that checks if the current column index is <code class="language-plaintext highlighter-rouge">7</code>, because that is the column that holds the ‘pretend boolean’ in my specific example. You would of course need to adapt this column index to your own specific use case.</p> <h2 id="sub-classing-qsqltablemodel">Sub-classing QSqlTableModel</h2> <p>If we want user interaction with our ‘pretend boolean’ variable to be handled by a check box, we need to sub-class the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> that interfaces between the sql table and the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> that visualises the data for the user. More specifically, we need to re-implement the <code class="language-plaintext highlighter-rouge">flags()</code>, <code class="language-plaintext highlighter-rouge">data()</code> and <code class="language-plaintext highlighter-rouge">setData()</code> member functions, and make our ‘pretend boolean’ (an integer set to <code class="language-plaintext highlighter-rouge">0</code> or <code class="language-plaintext highlighter-rouge">1</code>) behave as an item that can be checked and unchecked (I believe it was <a href="http://www.qtcentre.org/threads/12008-QSqlTableModel-and-checkboxes-with-SQLite-database">this discussion</a> that led me to this insight). The <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#flags">flags()</a> function basically determines how items recorded in the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> can be manipulated (see <a href="http://doc.qt.io/qt-5/qt.html#ItemFlag-enum">this list</a> of possible flags). We want to re-implement this function to make sure that items that correspond to our ‘pretend boolean’ can be checked or unchecked by the user. This can be achieved quite easily:</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* 
   To make sure that the column with the pretend boolean is recognised
   as a 'checkable' column, we need to re-implement the flags() function
   and create a special case for the target column.
*/</span>
<span class="n">Qt</span><span class="o">::</span><span class="n">ItemFlags</span> <span class="n">EventTableModel</span><span class="o">::</span><span class="n">flags</span><span class="p">(</span><span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="c1">// Column 7 always records the mark variable (our boolean).</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Make sure that this item is checkable.</span>
    <span class="k">return</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">flags</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">::</span><span class="n">ItemIsUserCheckable</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Default behaviour in all other cases.</span>
  <span class="k">return</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">flags</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>As mentioned previously, in the code snippet above we assume that our ‘pretend boolean’ is recorded in the seventh column of our sql table. We therefore check whether the current index being accessed exists in the seventh column. If yes, then we communicate to the program that the item at this index should be checkable by the user (we also make sure that we return all flags that are set by default). If no, then we revert to the default behaviour of the <code class="language-plaintext highlighter-rouge">QSqlTableModel::flags()</code> member function.</p> <p>Our sub-classed version of <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> still won’t understand how to handle our ‘pretend boolean’ properly. For that, we also need to re-implement the <code class="language-plaintext highlighter-rouge">data()</code> and <code class="language-plaintext highlighter-rouge">setData()</code> functions. The <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#data">data()</a> and <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#setData">setData()</a> are used to read data from, and write data to the sql table with which the QSqlTableModel is interfacing.</p> <p>We should keep in mind here that in the QSqlTableModel, data are stored under different ‘roles’ (see an overview of these roles <a href="http://doc.qt.io/qt-5/qt.html#ItemDataRole-enum">here</a>). For example, data stored under the <code class="language-plaintext highlighter-rouge">Qt::DisplayRole</code> are the data that are actually shown to the user in the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a>, data stored under the <code class="language-plaintext highlighter-rouge">Qt::ToolTipRole</code> are the data that are shown when the user hovers his/her mouse cursor over an entry in the table, and data stored under the <code class="language-plaintext highlighter-rouge">Qt::EditRole</code> are the data that the user can manipulate in an editor. In the <a href="http://doc.qt.io/qt-5/qt.html#ItemDataRole-enum">list of roles</a> you will also find the <code class="language-plaintext highlighter-rouge">Qt::CheckStateRole</code>, and this is the role that we want to (re-)implement for our ‘pretend boolean’.</p> <p>Another thing we should keep in mind is that we don’t want <em>all</em> data in our sql table to be treated as ‘pretend booleans.’ We will want to keep the default behaviour of the <code class="language-plaintext highlighter-rouge">data()</code> and <code class="language-plaintext highlighter-rouge">setData()</code> functions in most cases. We can do that in the same way by as we did with the <code class="language-plaintext highlighter-rouge">flags()</code> function: We create a special case for the column that holds our <code class="language-plaintext highlighter-rouge">pretend boolean</code> variable, and we revert to the default implementation of <code class="language-plaintext highlighter-rouge">QSqlTableModel::data()</code> and <code class="language-plaintext highlighter-rouge">QSqlTableModel::SetData()</code> in all other cases.</p> <blockquote>Actually, in the example below we have one other exception, which is the special case in which the user is hovering the mouse cursor over a cell, which will cause the QSqlTableModel to return data under the Qt::ToolTipRole.</blockquote> <p>Let’s start with our <code class="language-plaintext highlighter-rouge">data()</code> function. See a snippet with its re-implemented version below. <strong>EDIT: The updated version below implements a suggestion made by Doug Forester in the comments. It is more efficient than what I originally came up with.</strong></p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">QVariant</span> <span class="n">EventTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">,</span> <span class="kt">int</span> <span class="n">role</span><span class="p">)</span> <span class="k">const</span> 
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> 
    <span class="p">{</span> <span class="c1">// This is always the column with the boolean variable</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">CheckStateRole</span><span class="p">)</span> 
	<span class="p">{</span> <span class="c1">// Only do the below when we are setting the checkbox.</span>
	  <span class="c1">// We can simply fetch the value from the current index</span>
	  <span class="kt">int</span> <span class="n">checked</span> <span class="o">=</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">).</span><span class="n">toInt</span><span class="p">();</span>
	  <span class="c1">// If checked == 1, then it evaluates to true in the if-statement below.</span>
	  <span class="c1">// If checked == 0, the statement evaluates to false.</span>
	  <span class="k">if</span> <span class="p">(</span><span class="n">checked</span><span class="p">)</span>
	    <span class="p">{</span>
	      <span class="k">return</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Checked</span><span class="p">;</span>
	    <span class="p">}</span>
	  <span class="k">else</span>
	    <span class="p">{</span>
	      <span class="k">return</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Unchecked</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
      <span class="k">else</span> 
	<span class="p">{</span>
	  <span class="cm">/*
	    We return an empty variant in all other cases. This is to prevent, for example,
	    that we also see a '0' or '1' in the same column.
	  */</span>
	  <span class="k">return</span> <span class="n">QVariant</span><span class="p">();</span>
	<span class="p">}</span>
      <span class="c1">// Only do the below if we want to fetch a tool tip.</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">ToolTipRole</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="c1">// I just want the tool tip to show the data in the column.</span>
      <span class="k">const</span> <span class="n">QString</span> <span class="n">original</span> <span class="o">=</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">DisplayRole</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
      <span class="n">QString</span> <span class="n">toolTip</span> <span class="o">=</span> <span class="n">breakString</span><span class="p">(</span><span class="n">original</span><span class="p">);</span> <span class="c1">// breakString() breaks the text in smaller lines.</span>
      <span class="k">return</span> <span class="n">toolTip</span><span class="p">;</span>
      <span class="c1">// I want to make sure that broken lines have a space between them.</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">DisplayRole</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="k">const</span> <span class="n">QString</span> <span class="n">original</span> <span class="o">=</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">DisplayRole</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
      <span class="n">QString</span> <span class="n">shownText</span> <span class="o">=</span> <span class="n">fixBreakLines</span><span class="p">(</span><span class="n">original</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">shownText</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">else</span> 
    <span class="p">{</span>
      <span class="cm">/* 
	 In all other cases, we want the default behaviour of this function. 
	 This can be done easily by returning the default version of the function,
	 rather than the re-implemented version we have here.
      */</span>
      <span class="k">return</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">role</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="nf">QVariant</span><span class="p">();</span> <span class="c1">// This prevents a compiler warning.</span>
<span class="p">}</span></code></pre></figure> <p>So, the basic structure of this function is quite simple. We first check if the column of the sql table that is being accessed is the column with our <code class="language-plaintext highlighter-rouge">pretend boolean</code>. If yes, then we check whether the data are being accessed under the ‘Qt::CheckStateRole’. If the answer is yes again, we can fetch the current value of our ‘pretend boolean’ by accessing the data stored in the current index, and we store this value in <code class="language-plaintext highlighter-rouge">int checked</code>. The function will return <code class="language-plaintext highlighter-rouge">Qt::Checked</code> if <code class="language-plaintext highlighter-rouge">checked == 1</code>, and it will return <code class="language-plaintext highlighter-rouge">0</code> if <code class="language-plaintext highlighter-rouge">checked==0</code>.</p> <p>There are a few other situations that the re-implemented function handles. If we are accessing data in the column with our <code class="language-plaintext highlighter-rouge">pretend boolean</code>, but we are not accessing the data under the <code class="language-plaintext highlighter-rouge">Qt::CheckState</code> role, then the function simply returns an empty QVariant(), effectively returning nothing. I did this to make sure that the corresponding column in the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> only shows a check box that visualises the current check state, and nothing else. If we are accessing data in any other column, the function first checks whether we are accessing data under the <code class="language-plaintext highlighter-rouge">Qt::ToolTipRole</code>. If yes, then we treat it as another special case, in which the user gets shown a tool tip that simply contains the visible contents of the cell currently being hovered over with the mouse cursor. If we are not accessing the data under the <code class="language-plaintext highlighter-rouge">Qt::ToolTipRole</code> (in all other cases), we just revert to the default implementation of the <code class="language-plaintext highlighter-rouge">QSqlTableModel::data()</code> function.</p> <p>If you have re-implemented the <code class="language-plaintext highlighter-rouge">data()</code> function in this way, then your <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> should already show check boxes in the corresponding column. So far, so good. However, there are still a few problems. One problem is that the check boxes are aligned to the extreme left of the column, which makes the table look ugly. We will deal with this later. A more urgent problem is that checking / unchecking the check boxes won’t actually do anything meaningful with the underlying data, unless we also re-implement the <code class="language-plaintext highlighter-rouge">setData()</code> function. Let’s do that next.</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="kt">bool</span> <span class="n">EventTableModel</span><span class="o">::</span><span class="n">setData</span><span class="p">(</span><span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span> <span class="n">index</span><span class="p">,</span>
			      <span class="k">const</span> <span class="n">QVariant</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">role</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="cm">/* 
     Let's check whether the selected column is the column with our boolean variable
     (always column 7), and whether we are trying to set data under the 
     Qt::CheckStateRole.
  */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">7</span> <span class="o">&amp;&amp;</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">CheckStateRole</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="c1">// Writing the data when the check box is set to checked.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Checked</span><span class="p">)</span> 
	<span class="p">{</span>
	  <span class="c1">// Let's write the new value</span>
	  <span class="k">return</span> <span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	  <span class="c1">// Writing the data when the check box is set to unchecked</span>
	<span class="p">}</span>
      <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Unchecked</span><span class="p">)</span> 
	<span class="p">{</span>
	  <span class="c1">// Let's write the new value</span>
	  <span class="k">return</span> <span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>
  <span class="c1">// In all other situations revert to default behaviour.</span>
  <span class="k">return</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">role</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>We have a similar kind of check to the one we had with the <code class="language-plaintext highlighter-rouge">data()</code> function: We check whether thes column we are writing to is the column that contains our <code class="language-plaintext highlighter-rouge">pretend boolean</code> variable. In this case, we check at the same time whether we are trying to write data under the <code class="language-plaintext highlighter-rouge">Qt::CheckStateRole</code>. If yes, we write either a <code class="language-plaintext highlighter-rouge">1</code> or a <code class="language-plaintext highlighter-rouge">0</code> to the corresponding index, depending on what value was passed to the function. In all other situations we simply refer to the default implementation of the <code class="language-plaintext highlighter-rouge">QSqlTableModel::setData()</code> function.</p> <p>After re-implementing the <code class="language-plaintext highlighter-rouge">data()</code> function this way, checking / unchecking the check boxes in our <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> will actually do something meaningful with the data in the underlying sql table.</p> <p>If you don’t care about the alignment of the check boxes in their corresponding column of the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a>, then you’re done. However, I think that the table looks much nicer with the check boxes aligned to the centre of their column. How to achieve this is what I will discuss next.</p> <h2 id="styling-the-column-with-the-check-boxes">Styling the column with the check boxes</h2> <p>It turns out that the only way to align the check boxes to the centre of their column is to use a <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a>. Well, there is <a href="https://falsinsoft.blogspot.co.uk/2013/11/qtablewidget-center-checkbox-inside-cell.html">another approach that uses layouts</a>, but that only works if you (1) manually append another column to your <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a>, (2) explicitly create <code class="language-plaintext highlighter-rouge">QCheckBox</code> objects, (3) assign these to a parent <code class="language-plaintext highlighter-rouge">QWidget</code> object, (4) to which you then apply a centralised layout. This is quite an expensive procedure that can significantly reduce the performance of your program, and it only works well if you don’t update your <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> frequently.</p> <blockquote> This is because every time that you update your QSqlTableModel the manually appended column will disappear. You can of course solve this by writing a function that creates the extra column, and fills it with your manually created check boxes, and run this function whenever the QSqlTableModel's select() function gets called. However, this will slow down your program quite a bit, and I also found some other drawbacks to this approach that are a bit outside the scope of this discussion. </blockquote> <p>The approach that uses a <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a> is actually what is recommended in <a href="http://www.qtcentre.org/threads/12008-QSqlTableModel-and-checkboxes-with-SQLite-database">Qt’s FAQ</a> section. An example code snippet is offered there as well, although it is a bit outdated (it uses some functions that were deprecated in Qt5). Essentially, what you are required to do is to create your own sub-class of <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a>, and re-implement its <code class="language-plaintext highlighter-rouge">paint()</code> and <code class="language-plaintext highlighter-rouge">editorEvent()</code> functions. The <code class="language-plaintext highlighter-rouge">paint()</code> function determines how the check box is visualised to the user, and the <code class="language-plaintext highlighter-rouge">editorEvent()</code> function determines how the user can interact with the check box.</p> <p>I included the snippet with my slightly adapted version of the re-implemented functions below. I am not going to pretend that I grasp every detail of what happens in these functions. I mostly replaced some of the deprecated functions in the example offered in <a href="http://www.qtcentre.org/threads/12008-QSqlTableModel-and-checkboxes-with-SQLite-database">Qt’s FAQ</a>.</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* 
   This is a slightly adapted version of the example that is provided here:
   https://wiki.qt.io/Technical_FAQ#How_can_I_align_the_checkboxes_in_a_view.3F
*/</span>

<span class="kt">void</span> <span class="n">CheckBoxDelegate</span><span class="o">::</span><span class="n">paint</span> <span class="p">(</span><span class="n">QPainter</span> <span class="o">*</span> <span class="n">painter</span><span class="p">,</span> <span class="k">const</span> <span class="n">QStyleOptionViewItem</span> <span class="o">&amp;</span> <span class="n">option</span><span class="p">,</span>
	    <span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">QStyleOptionViewItem</span> <span class="n">viewItemOption</span><span class="p">(</span><span class="n">option</span><span class="p">);</span>
  <span class="c1">// Only do this if we are accessing the column with boolean variables.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This basically changes the rectangle in which the check box is drawn.</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">textMargin</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">::</span><span class="n">style</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">pixelMetric</span><span class="p">(</span><span class="n">QStyle</span><span class="o">::</span><span class="n">PM_FocusFrameHMargin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">QRect</span> <span class="n">newRect</span> <span class="o">=</span> <span class="n">QStyle</span><span class="o">::</span><span class="n">alignedRect</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignCenter</span><span class="p">,</span>
					<span class="n">QSize</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">decorationSize</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">+</span>
					      <span class="mi">5</span><span class="p">,</span><span class="n">option</span><span class="p">.</span><span class="n">decorationSize</span><span class="p">.</span><span class="n">height</span><span class="p">()),</span>
					<span class="n">QRect</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">textMargin</span><span class="p">,</span> <span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span>
					      <span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span>
					      <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">textMargin</span><span class="p">),</span> <span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">()));</span>
    <span class="n">viewItemOption</span><span class="p">.</span><span class="n">rect</span> <span class="o">=</span> <span class="n">newRect</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Draw the check box using the new rectangle.</span>
  <span class="n">QStyledItemDelegate</span><span class="o">::</span><span class="n">paint</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span> <span class="n">viewItemOption</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">CheckBoxDelegate</span><span class="o">::</span><span class="n">editorEvent</span><span class="p">(</span><span class="n">QEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">,</span> <span class="n">QAbstractItemModel</span> <span class="o">*</span><span class="n">model</span><span class="p">,</span>
			 <span class="k">const</span> <span class="n">QStyleOptionViewItem</span> <span class="o">&amp;</span><span class="n">option</span><span class="p">,</span>
			 <span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Q_ASSERT</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
  <span class="n">Q_ASSERT</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>

  <span class="c1">// make sure that the item is checkable</span>
  <span class="n">Qt</span><span class="o">::</span><span class="n">ItemFlags</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">model</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">::</span><span class="n">ItemIsUserCheckable</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">::</span><span class="n">ItemIsEnabled</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// make sure that we have a check state</span>
  <span class="n">QVariant</span> <span class="n">value</span> <span class="o">=</span> <span class="n">index</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">::</span><span class="n">CheckStateRole</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="n">isValid</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// make sure that we have the right event type</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">::</span><span class="n">MouseButtonRelease</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">textMargin</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">::</span><span class="n">style</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">pixelMetric</span><span class="p">(</span><span class="n">QStyle</span><span class="o">::</span><span class="n">PM_FocusFrameHMargin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">QRect</span> <span class="n">checkRect</span> <span class="o">=</span> <span class="n">QStyle</span><span class="o">::</span><span class="n">alignedRect</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignCenter</span><span class="p">,</span>
					  <span class="n">option</span><span class="p">.</span><span class="n">decorationSize</span><span class="p">,</span>
					  <span class="n">QRect</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">textMargin</span><span class="p">),</span> <span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span>
						<span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">textMargin</span><span class="p">),</span>
						<span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">()));</span>
    <span class="c1">// We handle the mouse event...</span>
    <span class="n">QMouseEvent</span> <span class="o">*</span><span class="n">mEvent</span> <span class="o">=</span> <span class="p">(</span><span class="n">QMouseEvent</span><span class="o">*</span><span class="p">)</span> <span class="n">event</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">checkRect</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">mEvent</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// as well as the key press event.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">::</span><span class="n">KeyPress</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">QKeyEvent</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">()</span> <span class="o">!=</span>
	<span class="n">Qt</span><span class="o">::</span><span class="n">Key_Space</span><span class="o">&amp;&amp;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">QKeyEvent</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Key_Select</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Determine the new check state</span>
  <span class="n">Qt</span><span class="o">::</span><span class="n">CheckState</span> <span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Qt</span><span class="o">::</span><span class="n">CheckState</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Checked</span>
			  <span class="o">?</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Unchecked</span> <span class="o">:</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Checked</span><span class="p">);</span>
  <span class="c1">// And set the new check state by calling the model's setData() function.</span>
  <span class="k">return</span> <span class="n">model</span><span class="o">-&gt;</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">CheckStateRole</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>The re-implemented version of the <code class="language-plaintext highlighter-rouge">paint()</code> function basically just changes the position at which the check box is drawn, by changing the rectangle within which the paint event takes place, and then calling the default version of the <code class="language-plaintext highlighter-rouge">paint()</code> function with an option parameter that includes the altered rectangle.</p> <p>The re-implemented version of the <code class="language-plaintext highlighter-rouge">editorEvent()</code> function handles various events through which the user might manipulate the current state of the check box. If an event meets the required conditions (e.g., a <code class="language-plaintext highlighter-rouge">QEvent::MouseButtonRelease</code> took place within the rectangle where the check box is drawn), then we call the <code class="language-plaintext highlighter-rouge">setData()</code> function (the one we re-implemented earlier) with the appropriate parameters.</p> <p>There is actually one other thing we need to do if we want our <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a> to work. We need to tell our <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> object to use the delegate in its seventh column. In my case, the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> object is named <code class="language-plaintext highlighter-rouge">tableView</code>, and the sub-classed version of the <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a> I created is named <code class="language-plaintext highlighter-rouge">CheckBoxDelegate</code>. I set <code class="language-plaintext highlighter-rouge">tableView</code> to use the <code class="language-plaintext highlighter-rouge">CheckBoxDelegate</code> by using the following function:</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">tableView</span><span class="o">-&gt;</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="k">new</span> <span class="nf">CheckBoxDelegate</span><span class="p">(</span><span class="n">tableView</span><span class="p">));</span></code></pre></figure> <p>And that should do the trick! Now you should have a <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> with a nice-looking column of check boxes through which the user can interact with ‘pretend boolean’ variables in your sql database.</p>]]></content><author><name></name></author><category term="Software"/><category term="Q-SoPrA"/><category term="Technical"/><category term="C++"/><category term="Qt"/><summary type="html"><![CDATA[Interfacing with sql databases with Qt5 This post is on an issue that I struggled with very recently, while working on Q-SoPrA. What I wanted to achieve was relatively simple: I wanted to have tables that fetch data from sql databases, and in which one column shows check boxes to set/unset a boolean variable. The screenshot below shows an example. An example table. What you see in the screen shot is QTableView widget that shows data that it fetches from a QSqlTableModel that interfaces with a table of a sqlite database. This post is about how to create the interactive check boxes shown in the right-most column. There are two main hurdles in getting the QTableView widget to work with check boxes: Sqlite databases don’t actually support boolean variables. You can use an integer variable to ‘simulate’ a boolean variable by setting it to 0(for false) or 1 (for true), but you will of course need to do a bit of extra work to make the QSqlTableModel properly treat it as a boolean (or something that can be switched on or off) in read &amp; write operations. This can be done by sub-classing the QSqlTableModel, and re-implementing its flags(), data() and setData() functions, as suggested here. But if you do that, you’ll have a quite ugly looking table, since the check boxes are all left-aligned in their column, with no obvious way to change that. In this case, the only solution seems to be to use a QStyledItemDelegate to handle the paint() function that determines how the column is visualised. A somewhat outdated example of how to do that is offered in the Qt FAQ. For good results in my use-case, where I want to have check boxes that (1) are able to handle a ‘pretend boolean’ variable (a boolean that is actually an integer) from a sqlite database, and (2) are not all aligned to the extreme left of their column, you have to combine the two solutions mentioned above. I haven’t really encountered a worked out example of this combination, which is why I decided to provide one in this post.]]></summary></entry><entry><title type="html">Getting started with Q-SoPrA</title><link href="https://wouterspekkink.github.io/blog/2017/getting-started-with-qsopra/" rel="alternate" type="text/html" title="Getting started with Q-SoPrA"/><published>2017-12-28T14:39:00+01:00</published><updated>2017-12-28T14:39:00+01:00</updated><id>https://wouterspekkink.github.io/blog/2017/getting-started-with-qsopra</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2017/getting-started-with-qsopra/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>As I mentioned in <a href="/blog/2017/a-better-csv-parser/">my previous post</a>, I am currently working on an integrated software package for the qualitative study of social processes, called Q-SoPrA (<strong>Q</strong>ualitative <strong>So</strong>cial <strong>Pr</strong>ocess <strong>A</strong>nalysis). The program can be used for various tasks, including data management, qualitative coding, and visualisation. It is still under construction, and I have not opened the source or distributed any binaries yet (but I will once a more or less fully-featured and stable version is ready). In addition to some more technical posts about the software (<a href="/blog/2017/a-better-csv-parser/">such as the previous one</a>), I intend to write several non-technical posts, discussing the features of Q-SoPrA and how to use them. Eventually, most of this information will also be available from the GitHub wiki of Q-SoPrA, but I think having some less condensed discussions of features is also useful.</p> <details> <summary><b>Also...</b></summary> <blockquote> I understand that having posts like this one will be more useful once the software is actually released, but for me writing this post is a way to prepare for the release, as well as a way to document some thoughts that might help me decide how to improve things further. </blockquote></details> <p><br/></p> <p>In this post, I want to discuss the basics of how to get started with Q-SoPrA. I start with a discussion of the logic behind the kind of data that Q-SoPrA works with. Then, I discuss the creation and loading of data sets, as well as data management (e.g., entering data, editing data, importing data).</p> <h2 id="incidents-as-data-points">Incidents as data points</h2> <p>I usually refer to the data sets that Q-SoPrA works with as <em>event data sets</em>, because it gives an intuitive sense of the kind of data stored in them, but the name <em>incident data sets</em> is actually more appropriate. The data sets consist of chronologically ordered <em>incidents</em>, which are bracketed, qualitative descriptions of interest to the process under study. The concept of incidents was, as far as I can tell, invented during the <a href="https://pubsonline.informs.org/doi/abs/10.1287/orsc.1.3.313">Minnesota Innovation Research Program</a> (also see <a href="https://books.google.co.uk/books/about/Organizational_Change_and_Innovation_Pro.html?id=Z5Ob8pYfPc8C&amp;redir_esc=y">this book</a> for detailed instructions on how to construct data sets like those used during the program, and <a href="https://books.google.co.uk/books?id=UPxyvH8kOdQC&amp;hl=nl&amp;source=gbs_similarbooks">this book</a> for some empirical results of the program).</p> <p>The operational definition of an incident that I use, and that I implemented in Q-SoPrA, is slightly different from that of the original inventors of the concept. In Q-SoPrA, an incident is assumed to include the following information:</p> <ol> <li>A <strong>description</strong> of the activity captured in the incident (created by the analyst).</li> <li>An indication of the <strong>time of occurrence</strong> (e.g., the hour, the day, the month, the year).</li> <li>The <strong>source</strong> of data.</li> <li>(Optionally / if available) A fragment of <strong>‘raw’ data</strong>, such as a fragment from an interview transcript, or a passage from a document in which the activity is reported.</li> <li>(Optionally) A <strong>comment / memo</strong> written on the incident by the researcher.</li> </ol> <p>I discuss each of these elements in more detail below.</p> <h3 id="description">Description</h3> <p>Incidents are supposed to capture activities of importance to the process under study. Indeed, what exactly these activities are depends on various factors, including characteristics of the process, the nature of the available data (e.g., granularity of data), the research questions of the analyst, the theoretical angle chosen for the study, and so on (see the earlier mentioned references, and also see <a href="http://www.tandfonline.com/doi/abs/10.1080/01615440.1984.10594134?journalCode=vhim20">this</a>, <a href="http://journals.sagepub.com/doi/abs/10.1177/0730888491018004001">this</a> (and other) work by Abbott for good discussions on this matter).</p> <p>Moreover, not all social processes are best reconstructed at the same level of abstraction. Some studies may be about processes that unfold over a period of several years (e.g., innovation processes), whereas other processes unfold over a period of just a few hours (e.g., a meeting), or even just a few minutes (e.g., a conversation). The level of detail available in the source data, and the desired level of detail of incident descriptions is quite different across different types of processes.</p> <p>The activities of interest are captured in brief descriptions (typically just a few sentences), created by the researcher. These descriptions typically mention at least what activity was performed, and by whom. Providing such descriptions is mandatory when using Q-SoPrA.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/description-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/description-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/description-1400.webp"/> <img src="/assets/img/description.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> An incident description. </div> <p>Writing incidents is an important step in the analytic process, and the descriptions used for incidents tell us a lot about the analyst’s interpretations of the raw data. As <a href="https://books.google.co.uk/books/about/Organizational_Change_and_Innovation_Pro.html?id=Z5Ob8pYfPc8C&amp;redir_esc=y">Poole and his colleagues write</a>, incidents can be understood to be “one step above the raw material for analysis” (page 140). When parsing the raw data into incidents, the analyst makes various decisions about, among other things (1) what activities are important to record explicitly, (2) the granularity of the activities (e.g., are we just interested in the occurrence of a political debate, or are we interested in the specific questions raised during the debate, and how people responded to these?), (3) what aspects of the described activity are important (do we only need to record the activity itself, or perhaps also, for example, where the activity took place and what instruments were used in the performance of the activity?).</p> <p>In the <a href="https://pubsonline.informs.org/doi/abs/10.1287/orsc.1.3.313">Minnesota Innovation Research Program</a>, the researchers agreed on a set of explicit decision rules that were applied across the different cases that they studied. I believe that making explicit decision rules is valuable for the transparency of the process, but I also believe that an important part of the interpretive process is to reconsider these choices repeatedly, and to make adjustments to the data set accordingly. It is important to record such decisions in some kind of research diary (Q-SoPrA includes a Journal Widget that can be used for this purpose).</p> <h3 id="time-of-occurrence">Time of occurrence</h3> <p>As I mentioned before, incidents are chronologically ordered in data sets. The order is to be determined by the analyst. I did not implement automatic sorting of incidents by date in Q-SoPrA, since the precise date of an incident may not be known, and a more descriptive indication of the time of occurrence is then required. For example, of some incidents we may only know that they happened before or after a certain other incident. In addition, I believe that determining the appropriate order of incidents is an important and informative task from which the analyst can learn a lot about the process of interest.</p> <p>That being said, Q-SoPrA requires the analyst to always provide an indication of the time of occurrence. This may be a very precise time stamp (e.g., “At 15:30 on 25-12-2017”), or it may be a very vague indication of the time of occurrence (e.g., “Somewhere in 2013”). It may of course also be some form of duration, rather than a discrete point in time (e.g., “from March to April 2016”).</p> <h3 id="the-sources-of-data">The sources of data</h3> <p>Q-SoPrA also requires you to always mention the sources of data. For most academics, this is a bit of a no-brainer. The specific sources of data used will depend on the design of the research project. In the studies included in the <a href="https://pubsonline.informs.org/doi/abs/10.1287/orsc.1.3.313">Minnesota Innovation Research Program</a>, which were carried out as the innovations of interest unfolded, sources of data include observations, records of phone calls, notes of meetings, interview transcripts, and others.</p> <p>I typically work with archival data, including newspaper articles, documents produced by people involved in the process of interest (e.g., minutes of meetings or project documents), as well as web sites (I make heavy use of <a href="https://archive.org/">The Internet Archive</a>). I store files on these sources on my disk, and typically give them simple labels, such as “Webpage_1”, “Document_20”, “News_101” and so on. In the data set, I refer to these sources by their labels.</p> <h3 id="raw-data">‘Raw’ data</h3> <p>As much as possible, I also like to include fragments from raw sources of data whenever I create incidents. I believe that including these ‘raw’ fragments alongside my own descriptions of the activities contributes to the transparency of the interpretive process. Also, when I assign codes to the incidents, these fragments of ‘raw’ data are my main pieces of evidence. In fact, in the coding widgets that I have created for Q-SoPrA I have also included the possibility to highlight particular fragments of text that are to be associated with the codes (see below). Anyone who has used software like RQDA, Atlas.ti, NVivo, or MaxQDA will understand how this works.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/text-highlighting-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/text-highlighting-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/text-highlighting-1400.webp"/> <img src="/assets/img/text-highlighting.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Text highlighting. </div> <p>Q-SoPrA does not require the analyst to include fragments of raw data, because there is not guarantee that these are available in the form of text. For example, some of my raw sources of data are images. However, I would encourage anyone to include raw fragments as much as possible, if only because such fragments are a great help in the qualitative coding process. I have personally noticed that I have become much more precise in my coding after implementing the possibility to highlight fragments of text.</p> <h3 id="comments-by-the-researcher">Comments by the researcher</h3> <p>Finally, in Q-SoPrA the analyst has the option to include comments, which may be anything from personal observations or thoughts on the incident, or perhaps reminders that certain aspect of the incident should be double checked (Q-SoPrA also offers the possibility to mark incidents, and to jump back and forth between incidents that were marked).</p> <p>People that have experience with qualitative research (and particularly grounded theory) are probably familiar with the notion of <a href="https://www.quirkos.com/blog/post/memos-qualitative-data-analysis-research">memos</a>. In Q-SoPrA, the comment field can be used to write such memos. Comment fields are the only fields related to incidents that can be altered at any time (the other incident-related fields, i.e., the indication of timing, the description, the sources of data, and the ‘raw’ data can only be changed from the Data Widget).</p> <h2 id="the-structure-of-q-sopras-datasets">The structure of Q-SoPrA’s datasets</h2> <p>The structure of Q-SoPrA’s input datasets is quite simple: A data set is a table with 7 columns. Only 5 of these columns are visible to the user (see below), which are the columns that record the <em>Timing</em>, the <em>Description</em>, the <em>Raw</em> data, the <em>Comments</em>, and the <em>Source(s)</em> associated with incidents. The information included in these columns should be supplied by the analyst, by writing new incidents, or by importing data sets from external csv files (also see <a href="/blog/2017/a-better-csv-parser/">my previous post</a> for a technical discussion on importing data from csv files).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/data_widget-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/data_widget-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/data_widget-1400.webp"/> <img src="/assets/img/data_widget.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The Data widget. </div> <p>The other two columns of the table are hidden from the user, and are always created and filled automatically. The first of these columns holds a unique <em>ID</em> for the incidents. The unique incident IDs are of crucial importance, because Q-SoPrA uses these IDs to refer to incidents in other tables of Q-SoPrA’s database. A unique ID is created whenever an incident is added to a data set. The first incident in the data set has the ID ‘0’, the second has the ID ‘1’, and so on. To ensure that we never confuse incidents, Q-SoPrA never reuses an ID number that has already been used before in the same data set.</p> <details> <summary><b>What are the incident IDs for?</b></summary> <blockquote> Q-SoPrA uses sqlite databases to store all information that the user creates while working on a data set. These databases currently have 40 different tables (more may be added as I expand the program), but the only table that the user interacts with more or less directly is the table of incidents. Other tables are used, for example, to store the attributes that the user creates while coding, to store information on which attributes were assigned to which incidents, to store information on the fragments of text that have been associated with certain pairs of incidents and attributes, and so on. Obviously, it is important that Q-SoPrA knows which specific incidents we are referring to in these different tables, which is why we need unique IDs for all incidents. </blockquote></details> <p><br/></p> <p>The second column that is hidden from the user contains an <em>order</em> variable, which simply records the current position of an incident in the chronological order (the table of the data widget does show a row number, which always has the same value as the order variable). The value of this variable determines the position of an incident as it is shown to the user in the data widget (see the screenshot above). The value of this variable is changed whenever an incident is moved up our down in the table, which can be done from the data widget. Whenever the analyst performs such an operation, Q-SoPrA automatically calculates the new values of the order variable for the affected incidents. The values of the order variable also determine how the data are presented to the user in other widgets, such as the qualitative coding widgets. In addition, in the visualisation widgets the order variable can be used to filter visualisations to only visualise data from a particular episode in the process (I will discuss these topics in more detail in future posts).</p> <h2 id="working-with-q-sopras-datasets">Working with Q-SoPrA’s datasets</h2> <p>When you start up Q-SoPrA, you will always be shown a Welcome Dialog first (see screenshot below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/welcome_dialog-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/welcome_dialog-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/welcome_dialog-1400.webp"/> <img src="/assets/img/welcome_dialog.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The welcome screen. </div> <p>The Welcome Dialog gives you three options: (1) You can create a new database, (2) you can open an existing database, or (3) you can exit the program. If you select the first option, Q-SoPrA will open a file dialog, which you can then use to select the name and location for your new database. After doing so, a new <a href="https://www.sqlite.org/">sqlite database</a> is created. Essentially, this database is just a large collection of (initially empty) tables, but nearly all information created by, and presented to the user while using Q-SoPrA is stored in these tables. If the user selects to create a new database, and then selects an existing database in the file dialog, then the existing data base will be overwritten. <strong>This action cannot be undone, but the user will be shown a warning dialog before proceeding.</strong></p> <p>The user can indeed also select to open an existing database. In this case, Q-SoPrA will not attempt to create a new database, but any tables that are missing from the existing database will be added.</p> <p>After choosing to create a new database, or to open an existing one, Q-SoPrA’s main window will be opened, and the data widget will be shown. All other widgets can be accessed from the main window, using the window’s menu bar (see screenshot below). I will discuss these other widgets in future posts.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/menu-bar-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/menu-bar-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/menu-bar-1400.webp"/> <img src="/assets/img/menu-bar.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The menu bar. </div> <p>If the user selected to create a new dataset, then the data widget will simply show an empty table, as well as a few buttons that can be used to interact with the data set. From this point, the analyst can either start creating new incidents from scratch, or import incidents from an external csv file, which is done by selecting the appropriate option from the <em>File</em> menu in the menu bar.</p> <p>Imported csv files should meet two main requirements: (1) the file should have the column headers that Q-SoPrA works with, and they should exist in the same order (“Timing”, “Description”, “Raw”, “Comments”, and “Source”), (2) cells of the “Timing”, “Description” and “Source” columns are not allowed to be empty. If the user attempts to import files that do not meet these requirements, an error dialog will be shown to inform the user that the data will not be imported and why.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/example_error-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/example_error-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/example_error-1400.webp"/> <img src="/assets/img/example_error.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> An example error message. </div> <p>If the user wishes to create new incidents from scratch, the option <em>Append incident</em> can be used to add a new incident to the end of the data set. The user will then be shown a new dialog that can be used to enter information on the incident (see screenshot below). The user is always required to enter information into the “Timing”, “Description” and “Source” fields. If these fields are empty, the user is not allowed to create the incident, and will be shown an error dialog that explains why.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/append-incident-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/append-incident-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/append-incident-1400.webp"/> <img src="/assets/img/append-incident.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Appending an incident. </div> <p>After saving the incident, it will be shown in the table of the data widget. The fields of the incident can now be manipulated by double clicking cells and changing the details. However, when the user clears a cell that is not allowed to be empty, Q-SoPrA will simply reset the cell. An incident can also be edited by selecting it, and then using the <em>Edit incident</em> option. This will open the same dialog that is used for the creation of new incidents, but the fields will be filled with the information that was already present.</p> <details> <summary><b>Other minor features of the data widget table</b></summary> <blockquote> The table in the data widget has various other features. For example, the information contained in a cell can be shown in a popup dialog by hovering the mouse cursor over it. This allows the user to display information on incidents without having to open another dialog. To the left of the table, the user will see a column with row numbers. The lower border of the cells in this column can be dragged up or down to decrease / increase the height of rows. The lower border of these cells can also be double clicked to maximise a row's height. If the user wishes to restore a row's height to its default value, the user should simply double click the corresponding cell with the row number. The user can also increase or decrease the table's font size by holding the CTRL button and scrolling the mouse wheel up or down. </blockquote></details> <p><br/></p> <p>Once the user has filled the table with some data, (s)he also might want to insert new incidents in between two existing ones, rather than appending them to the end of the table. For this reason, the user also has the option to <em>insert a new incident</em> before or after an existing one. These options work the same as appending a new incident (e.g., a dialog will be shown that can be used to enter information on the new incident), but the new incident will be inserted at the location chosen by the user.</p> <p>Sometimes it also makes sense to duplicate an existing incident, and make only small adjustments to the duplicate, rather than having to enter all information again. For example, I often use this option if I decide to split up an existing incident into multiple incidents. This can be achieved by selecting an existing incident, and using the <em>Duplicate incident</em> option. The result will be similar to editing an incident, but in this case a new incident is created when saving the changes. Duplicates will always be inserted immediately after the incident that they are a duplicate of.</p> <p>The user will occasionally want to change the order of the incidents (for example, after creating a duplicate). This can be done by selecting an incident, and using the <em>Move up</em> or <em>Move down</em> options. This will simply switch the selected incident with the one prior to it or the one following it.</p> <p>Finally, the user can remove an incident from the table by using the <em>Remove incident</em> option. Removing an incident will also remove all information that has been associated with it, such as assigned attributes (not the attributes themselves), and linkages that have been created with other incidents (I discuss this in a future post). The user will always be shown a warning dialog when using this option, <strong>since it cannot be undone.</strong></p> <h2 id="getting-started-with-q-sopra">Getting started with Q-SoPrA</h2> <p>In conclusion, getting started with Q-SoPrA is easy. You simply create a new data set, and starting filling the data widget’s table with incidents. In my view, by building your data set you are basically building your case.</p> <p>Indeed, while analysing the data you will often find yourself going back to the data widget to add more incidents, to edit, split or merge existing ones, or to change the order of the incidents. In my experience you will continue to do so throughout most of the analytic process, as your understanding of the case of interest gets more refined.</p> <p>This is exactly the reason why the data widget was integrated into Q-SoPrA. In fact, the main reason I had for building Q-SoPrA was to have a program in which the tasks of data management and data coding are integrated (but things escalated quickly from there, as I kept adding other features to Q-SoPrA). Before building Q-SoPrA, I built several standalone tools that perform some of the tasks that Q-SoPrA performs (although Q-SoPrA performs these tasks much better, which is simply a result of my increased experience with coding software). One of the main problems with these standalone tools was that I often found myself having to re-import data sets after making small changes. Since this was quite a time-consuming and error prone process, I also often found myself postponing changes or ignoring certain flaws in the data set, simply because I did not want to waste too much time. One of the main ideas underlying Q-SoPrA is that management of the data set is actually a crucial part of the analytic process, and therefore I have attempted to make the process of going back and forth between your data and your analysis as painless as possible.</p> <p>Of course, data management is only one part of what Q-SoPrA does, and the data widget is primarily a support for the various other tasks that can be performed with Q-SoPrA. I discuss these other tasks in future posts.</p>]]></content><author><name></name></author><category term="Software"/><category term="Q-SoPrA"/><category term="Non-Technical"/><summary type="html"><![CDATA[Introduction As I mentioned in my previous post, I am currently working on an integrated software package for the qualitative study of social processes, called Q-SoPrA (Qualitative Social Process Analysis). The program can be used for various tasks, including data management, qualitative coding, and visualisation. It is still under construction, and I have not opened the source or distributed any binaries yet (but I will once a more or less fully-featured and stable version is ready). In addition to some more technical posts about the software (such as the previous one), I intend to write several non-technical posts, discussing the features of Q-SoPrA and how to use them. Eventually, most of this information will also be available from the GitHub wiki of Q-SoPrA, but I think having some less condensed discussions of features is also useful.]]></summary></entry><entry><title type="html">A better csv parser</title><link href="https://wouterspekkink.github.io/blog/2017/a-better-csv-parser/" rel="alternate" type="text/html" title="A better csv parser"/><published>2017-12-21T10:07:00+01:00</published><updated>2017-12-21T10:07:00+01:00</updated><id>https://wouterspekkink.github.io/blog/2017/a-better-csv-parser</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2017/a-better-csv-parser/"><![CDATA[<h2 id="background">Background</h2> <p>Before I get to the main topic of this post, I should offer a bit of background. I am currently working on an integrated software package for the qualitative study of social processes, called Q-SoPrA (an acronym for <strong>So</strong>cial <strong>Pr</strong>ocess <strong>A</strong>nalysis). The program can be used for data entry, data management, hierarchical coding for attributes (think CAQDAS-style coding), coding for network relationships, coding for linkages between events (see the work of <a href="http://www.indiana.edu/~socpsy/ESA/">David Heise</a> for a main source of inspiration in this), abstracting larger events from smaller ones, visualising event graphs, visualising event hierarchies, visualising network graphs, visualising occurrence graphs (similar to <a href="/blog/2017/bi-dynamic-line-graphs/">Bi-Dynamic Line Graphs</a>), and basic analysis. I intend to write some technical as well as non-technical posts about Q-SoPrA and its development. The technical posts will deal primarily with what happens on ‘the back stage’ of the program, that is, discuss the underlying source code. The non-technical posts will focus primarily on Q-SoPrA’s ‘front stage’, discussing its features and how to use them. This post is going to be a technical one.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/welcome_dialog-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/welcome_dialog-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/welcome_dialog-1400.webp"/> <img src="/assets/img/welcome_dialog.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Welcome dialog of Q-SoPrA. </div> <p>The main reason for writing the more technical posts is that I have made heavy use of information and advice on writing code that I found online. In fact, I learned almost everything I know about coding from people willing to share their knowledge via the Web (of course, a lot of it was simply learning by doing). Occasionally, I run into difficult problems that I am only able to solve after seeing various posts on websites like Stack Overflow. That being said, the solutions I finally come up with are typically a variant of a particular suggestion that was made online, or a combination of various suggestions. I thought it was a nice idea to give something back, by discussing some solutions for <del>problems</del> challenges I encountered while writing the code for Q-SoPrA, and making those discussion available online, in the hope that someone in search for answers to similar problems might one day stumble upon my posts.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/SO-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/SO-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/SO-1400.webp"/> <img src="/assets/img/SO.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <h2 id="whats-the-problem">What’s the problem?</h2> <p>In this post I will discuss something related to the <em>Data Widget</em> that I wrote for Q-SoPrA. I divided Q-SoPrA into several widgets that perform the main tasks of the program (the tasks listed in the background discussion above). The Data Widget handles the user’s interaction with data. In this case, the data take the form of chronologically ordered <em>incidents</em>, which are bracketed, qualitative descriptions of activities. The concept of incidents was introduced during the <a href="https://pubsonline.informs.org/doi/abs/10.1287/orsc.1.3.313">Minnesota Innovation Research Program</a>, although I work with a slightly different idea of what information should be included in an incident:</p> <ol> <li>An indication of the <strong>time of occurrence</strong> (e.g., the hour, the day, the month, the year).</li> <li>A <strong>description</strong> of the activity captured in the incident (created by the analyst).</li> <li>The <strong>source</strong> of data.</li> <li>(Optionally / if available) A fragment of <strong>‘raw’ data</strong>, such as a fragment from an interview transcript, or a passage from a document in which the activity is reported.</li> <li>(Optionally) A <strong>comment / memo</strong> written on the incident by the researcher.</li> </ol> <p>The Data Widget allows the analyst to create incidents, and store them in a table. To enter / edit data, the user can use a popup dialog. After saving a new incident, a row is added to the Data Widget table, after which the user can still change the location of the incident (i.e., change its position in the chronological order of all incidents), edit its details, duplicate it, or remove it. All changes are immediately written to an sqlite database. See a screenshot of the Data Widget table below.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/data_widget-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/data_widget-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/data_widget-1400.webp"/> <img src="/assets/img/data_widget.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The Data widget. </div> <p>One thing that the user can also do is to import an existing data set that was stored in <a href="https://en.wikipedia.org/wiki/Comma-separated_values">csv format</a>. I implemented this future because I have been building data sets before I started using Q-SoPrA myself (I am already using the program while I am building it, which is also a good way to test it). I wanted to have the option to import these existing data sets. The most obvious way to do this (to me, at least) is to store the data sets in csv files, and then import them into Q-SoPrA. <strong>And here is where we finally get to the main topic of this post:</strong> I needed a good way to parse csv files submitted by the user. This in itself is a somewhat trivial task. However, the csv files that I created in the past are a bit ‘messy’, primarily due to the fact that I typically included text from sources of ‘raw data’, such as written news items, and other types of documents. I typically just copy and paste this data, and in a csv file this will often lead to the inclusion of embedded line breaks, and embedded double quotes (e.g., when someone is quoted in a news item).</p> <p>Most of the relatively simple csv parsers that I have seen will run into problems when trying to read such messy files. After several iterations, I created the set of functions listed in full below. I included a lot of comments in the code to explain what happens at different steps. Most of the code is standard C++ code, but there are also some objects that are based on the Qt library (e.g., QString, QPointer, QMessageBox, QSqlQuery). This is because I used the Qt5 library for the graphical user interface of Q-SoPrA, as well as for interaction with sqlite data sets.</p> <p>Let’s start with the main function, called <code class="language-plaintext highlighter-rouge">importFromCsv()</code>, (which calls two other customised functions).</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* 
   This function is designed to facilitate importing data from 
   an external csv file. We read each line of data in turn, 
   check whether we should append any other lines due to 
   embedded line breaks, then cut up the resulting line 
   into tokens, and store these in a data vector before writing 
   the data into our sqlite database.

   We also check whether the file has the correct headers.
*/</span>
<span class="kt">void</span> <span class="n">MainWindow</span><span class="o">::</span><span class="n">importFromCsv</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// We ask the user to open a file to import from.</span>
  <span class="n">QString</span> <span class="n">csvName</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">::</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">tr</span><span class="p">(</span><span class="s">"Select csv file"</span><span class="p">),</span><span class="s">""</span><span class="p">,</span>
						 <span class="n">tr</span><span class="p">(</span><span class="s">"csv files (*.csv)"</span><span class="p">));</span>
  <span class="c1">// We then create an ifstream object that goes through the file.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">file</span> <span class="p">((</span><span class="n">csvName</span><span class="p">.</span><span class="n">toStdString</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span> <span class="c1">// To store our data in.</span>
  <span class="kt">bool</span> <span class="n">headerFound</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// To be used in a condition further below.</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The buffer will hold each line of data as we read the file.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">buffer</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">getline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">buffer</span><span class="p">))</span> <span class="k">break</span><span class="p">;</span> <span class="c1">// We get the current line/</span>

    <span class="c1">// We should check and handle any extra line breaks in the file.</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">checkLineBreaks</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">extra</span><span class="p">;</span>
      <span class="n">getline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">extra</span><span class="p">);</span>
      <span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span> <span class="o">+</span> <span class="n">extra</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// We need an object to keep the separate tokens in a line.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">tokens</span><span class="p">;</span> 
    <span class="c1">// We then split the current line into different tokens.</span>
    <span class="n">splitCsvLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tokens</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
    <span class="cm">/* 
       If we still need to import the header, let's do that first.
       We immediately check if the correct headers were used.
       If not, we report an error and return, letting the user fix the issue.
    */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">headerFound</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"Timing"</span> <span class="o">&amp;&amp;</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"timing"</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">QPointer</span><span class="o">&lt;</span><span class="n">QMessageBox</span><span class="o">&gt;</span> <span class="n">errorBox</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s">"&lt;b&gt;ERROR&lt;/b&gt;"</span><span class="p">));</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s">"Expected </span><span class="se">\"</span><span class="s">Timing</span><span class="se">\"</span><span class="s"> in first column."</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">();</span>
	<span class="k">delete</span> <span class="n">errorBox</span><span class="p">;</span>
	<span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"Description"</span> <span class="o">&amp;&amp;</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"description"</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">QPointer</span><span class="o">&lt;</span><span class="n">QMessageBox</span><span class="o">&gt;</span> <span class="n">errorBox</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s">"&lt;b&gt;ERROR&lt;/b&gt;"</span><span class="p">));</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s">"Expected </span><span class="se">\"</span><span class="s">Description</span><span class="se">\"</span><span class="s"> "</span>
				     <span class="s">"in second column."</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">();</span>
	<span class="k">delete</span> <span class="n">errorBox</span><span class="p">;</span>
	<span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"Raw"</span> <span class="o">&amp;&amp;</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"raw"</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">QPointer</span><span class="o">&lt;</span><span class="n">QMessageBox</span><span class="o">&gt;</span> <span class="n">errorBox</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s">"&lt;b&gt;ERROR&lt;/b&gt;"</span><span class="p">));</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s">"Expected </span><span class="se">\"</span><span class="s">Raw</span><span class="se">\"</span><span class="s"> in third column."</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">();</span>
	<span class="k">delete</span> <span class="n">errorBox</span><span class="p">;</span>
	<span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"Comments"</span> <span class="o">&amp;&amp;</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"comments"</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">QPointer</span><span class="o">&lt;</span><span class="n">QMessageBox</span><span class="o">&gt;</span> <span class="n">errorBox</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s">"&lt;b&gt;ERROR&lt;/b&gt;"</span><span class="p">));</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s">"Expected </span><span class="se">\"</span><span class="s">Comments</span><span class="se">\"</span><span class="s"> in "</span>
				     <span class="s">"fourth column."</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">();</span>
	<span class="k">delete</span> <span class="n">errorBox</span><span class="p">;</span>
	<span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"Source"</span> <span class="o">&amp;&amp;</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"source"</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">QPointer</span><span class="o">&lt;</span><span class="n">QMessageBox</span><span class="o">&gt;</span> <span class="n">errorBox</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s">"&lt;b&gt;ERROR&lt;/b&gt;"</span><span class="p">));</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s">"Expected </span><span class="se">\"</span><span class="s">Source</span><span class="se">\"</span><span class="s"> in "</span>
				     <span class="s">"fifth column."</span><span class="p">);</span>
	<span class="n">errorBox</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">();</span>
	<span class="k">delete</span> <span class="n">errorBox</span><span class="p">;</span>
	<span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="cm">/* 
	 If we checked all headers and imported the header correctly,
	 we can set the headerFound bool to true, so that this block 
	 is skipped in all subsequent line reads.
      */</span>
      <span class="n">headerFound</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// This is the block that is run after the header was</span>
      <span class="n">already</span> <span class="n">imported</span><span class="p">.</span>
      <span class="c1">// We iterate through the tokens and push them into the row vector.</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">row</span><span class="p">;</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span><span class="p">;</span> 
      <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">tokens</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">it</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">row</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Then we push the row vector into the data vector.</span>
      <span class="n">data</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="cm">/* 
     Writing to sqlite databases is quite slow, so if the 
     csv-file is large, it will take a while. We use a progress bar 
     to report to the user how much we have already imported 
     into the sqlite database.
  */</span>
  <span class="n">loadProgress</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ProgressBar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="n">loadProgress</span><span class="o">-&gt;</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">Qt</span><span class="o">::</span><span class="n">WA_DeleteOnClose</span><span class="p">);</span>
  <span class="n">loadProgress</span><span class="o">-&gt;</span><span class="n">setModal</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">loadProgress</span><span class="o">-&gt;</span><span class="n">show</span><span class="p">();</span>

  <span class="cm">/* 
     We need a pointer to the data widget to determine the 
     number of rows already in the table
  */</span>
  <span class="n">DataWidget</span> <span class="o">*</span><span class="n">dw</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">DataWidget</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">stacked</span><span class="o">-&gt;</span><span class="n">widget</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
  <span class="n">dw</span><span class="o">-&gt;</span><span class="n">updateTable</span><span class="p">();</span> <span class="c1">// A function to make sure all table rows are read.</span>
  <span class="cm">/* 
     Since imported rows are appended to the end of the data base, 
     we can assume that the order variable is the number of 
     existing rows + 1.
  */</span>
  <span class="kt">int</span> <span class="n">order</span> <span class="o">=</span> <span class="n">dw</span><span class="o">-&gt;</span><span class="n">incidentsModel</span><span class="o">-&gt;</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">it</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We create all the necessary variables and write them to the table.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">currentRow</span> <span class="o">=</span> <span class="o">*</span><span class="n">it</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromStdString</span><span class="p">(</span><span class="n">currentRow</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">QString</span> <span class="n">description</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromStdString</span><span class="p">(</span><span class="n">currentRow</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">QString</span> <span class="n">raw</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromStdString</span><span class="p">(</span><span class="n">currentRow</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="n">QString</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromStdString</span><span class="p">(</span><span class="n">currentRow</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="n">QString</span> <span class="n">source</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromStdString</span><span class="p">(</span><span class="n">currentRow</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
    <span class="n">QSqlQuery</span> <span class="o">*</span><span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QSqlQuery</span><span class="p">;</span> <span class="c1">// For this we use the QSqlQuery object.</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">(</span><span class="s">"INSERT INTO incidents "</span>
		   <span class="s">"(ch_order, timestamp, description, raw, comment, "</span>
		   <span class="s">"source, mark) "</span>
		   <span class="s">"VALUES "</span>
		   <span class="s">"(:order, :timestamp, :description, :raw, :comment, "</span>
		   <span class="s">":source, :mark)"</span><span class="p">);</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">bindValue</span><span class="p">(</span><span class="s">":order"</span><span class="p">,</span> <span class="n">order</span><span class="p">);</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">bindValue</span><span class="p">(</span><span class="s">":timestamp"</span><span class="p">,</span> <span class="n">timeStamp</span><span class="p">);</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">bindValue</span><span class="p">(</span><span class="s">":description"</span><span class="p">,</span> <span class="n">description</span><span class="p">);</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">bindValue</span><span class="p">(</span><span class="s">":raw"</span><span class="p">,</span> <span class="n">raw</span><span class="p">);</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">bindValue</span><span class="p">(</span><span class="s">":comment"</span><span class="p">,</span> <span class="n">comment</span><span class="p">);</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">bindValue</span><span class="p">(</span><span class="s">":source"</span><span class="p">,</span> <span class="n">source</span><span class="p">);</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">bindValue</span><span class="p">(</span><span class="s">":mark"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">query</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">();</span>		   
    <span class="n">order</span><span class="o">++</span><span class="p">;</span> <span class="c1">// Make sure that we increment the order variable.</span>
    <span class="n">loadProgress</span><span class="o">-&gt;</span><span class="n">setProgress</span><span class="p">(</span><span class="n">order</span><span class="p">);</span> <span class="c1">// Set progress and report</span>
    <span class="n">qApp</span><span class="o">-&gt;</span><span class="n">processEvents</span><span class="p">();</span> <span class="c1">// Make sure that the progress is visible</span>
    <span class="k">delete</span> <span class="n">query</span><span class="p">;</span> <span class="c1">// Memory management</span>
  <span class="p">}</span>
  <span class="n">loadProgress</span><span class="o">-&gt;</span><span class="n">close</span><span class="p">();</span> <span class="c1">// We can close the progress bar.</span>
  <span class="k">delete</span> <span class="n">loadProgress</span><span class="p">;</span> <span class="c1">// Memory management</span>
  <span class="c1">// The imported data won't be visible unless we run the following lines.</span>
  <span class="n">dw</span><span class="o">-&gt;</span><span class="n">incidentsModel</span><span class="o">-&gt;</span><span class="n">select</span><span class="p">();</span>
  <span class="n">dw</span><span class="o">-&gt;</span><span class="n">updateTable</span><span class="p">();</span>
  <span class="c1">// We should also update the attributes widget at this point. </span>
  <span class="n">AttributesWidget</span> <span class="o">*</span><span class="n">aw</span> <span class="o">=</span> <span class="n">qobject_cast</span><span class="o">&lt;</span><span class="n">AttributesWidget</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">stacked</span><span class="o">-&gt;</span><span class="n">widget</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span> 
  <span class="n">aw</span><span class="o">-&gt;</span><span class="n">retrieveData</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure> <h3 id="handling-embedded-line-breaks">Handling embedded line breaks</h3> <p>So, what exactly happens here? Well, I won’t discuss all the lines of code in detail, but I will discuss the ones most important to the problem at hand (parsing ‘messy’ csv-files). The basic logic of the function is that we read a csv file line by line, and that we process each line in turn. One challenge that we might encounter while parsing ‘messy’ csv files is the presence of embedded line breaks. This means that one cell includes multiple lines of data, separated by so-called line breaks. See the screenshot below for an example. In the second row of data (below the header), we see a couple of line breaks.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/embedded_line_breaks-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/embedded_line_breaks-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/embedded_line_breaks-1400.webp"/> <img src="/assets/img/embedded_line_breaks.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Embedded line breaks. </div> <p>The line breaks are even more obvious if we open our csv file with a basic text editor. We will see something this:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
timing,description,raw,comments,source
1,test1,"Let's make
this

example",,s1
2,test2,What?,,s2
3,test3,Nothing,,s3

</code></pre></div></div> <details> <summary>Click here for some additional info on what we see here</summary> <blockquote> Looking at the text fragment above actually gives us a pretty good idea of how a csv file is typically structured. One thing to notice is that we see a lot of commas that we did not see in the original screenshot. These commas are used to separate between different columns of data, and are the reason why csv files are often referred to as comma-delimited files (actually, csv stands for <b>C</b>omma <b>S</b>eparated <b>V</b>alue). In the file above, we sometimes see two commas. This simply means that the cell between those commas is empty. We also see that cells with line breaks in them are double quoted, while we did not add double quotes in our original file. Double quotes are often used for text fields if there is something special about them, such as the presence of line breaks, or the presence of embedded commas (commas that do not indicate additional columns, but simply break up sentences into different segments). </blockquote> </details> <p><br/></p> <p>If we use the C++ <code class="language-plaintext highlighter-rouge">getline()</code>function to read the lines in this file, then the first line it will read is <code class="language-plaintext highlighter-rouge">"timing","description","raw","comments","source"</code>, the second line it will read is <code class="language-plaintext highlighter-rouge">1,"test1","Let's make</code>, the third line <code class="language-plaintext highlighter-rouge">this</code>, and so on. This is a bit of a problem, because we actually want the second line of data to be something like <code class="language-plaintext highlighter-rouge">1,"test1","Let's make this example",,"s1"</code>. Fortunately, the <a href="http://www.creativyst.com/Doc/Articles/CSV/CSV01.htm#FileFormat">csv standard</a> prescribes that we embed text fields with line breaks in them in double quotes. We can use the number of double quotes on a given line of data as clue about whether or not that line might have line breaks embedded in them. For example, in the second line of data, we find only 1 double quote, which suggest that we might not be finished reading the line (otherwise we should have encountered a matching closing double quote somewhere down the line).</p> <p>One thing we could do whenever we encounter an unequal number of quotes, is to check if we can perhaps find the missing quotes in the next line(s) of data. If this indeed the case (it should be the case), then we can append these other lines to our current line in order to complete it.</p> <p>That is what happens in the <code class="language-plaintext highlighter-rouge">while (checkLineBreaks(buffer) == true)</code> loop. ‘checkLineBreaks(QString line)’ is an additional function that I wrote, and that returns true if the parser thinks there is an embedded line break in the current line. I show the while loop and the accompanying ‘checkLineBreaks(QString line)’ function below.</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">while</span> <span class="p">(</span><span class="n">checkLineBreaks</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">extra</span><span class="p">;</span>
  <span class="n">getline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">extra</span><span class="p">);</span>
  <span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span> <span class="o">+</span> <span class="n">extra</span><span class="p">;</span>
<span class="p">}</span>
	
<span class="cm">/* 
   Function to check for line breaks in current line of imported csv file.
   The logic is that a finished line of data will always have an 
   equal number of double quotes ("). If this is not the case, we can assume 
   that another line of data should be appended. 
*/</span>
<span class="kt">bool</span> <span class="n">MainWindow</span><span class="o">::</span><span class="n">checkLineBreaks</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">line</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="n">lineBreak</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// This is the variable that will be returned.</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">line</span><span class="p">.</span><span class="n">length</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* 
       If we did not find a quote yet, and we find one,
       we set the lineBreak variable to true.
    */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lineBreak</span> <span class="o">==</span> <span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'"'</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">lineBreak</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="cm">/*
	If we then find another quote, 
	we can assume that no embedded line break exists.
      */</span>
    <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">lineBreak</span> <span class="o">==</span> <span class="nb">true</span> <span class="o">&amp;&amp;</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'"'</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">lineBreak</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// After reading the line, we return the result.</span>
  <span class="k">return</span> <span class="n">lineBreak</span><span class="p">;</span>  
<span class="p">}</span></code></pre></figure> <p>The <code class="language-plaintext highlighter-rouge">buffer</code> object is the original line of data that we are currently reading. If we find a line break in this object, then we create a new object <code class="language-plaintext highlighter-rouge">extra</code>, put the next line of data in it, and append it to <code class="language-plaintext highlighter-rouge">buffer</code> (we also include two line breaks to mimic the original line break; why I chose to use two has to do with something that is not important right now). Since we are using a while loop, the program will keep doing this as long as it encounters line breaks in the current version of <code class="language-plaintext highlighter-rouge">buffer</code>. Pretty neat, huh?</p> <h3 id="handling-text-fields-with-embedded-double-quotes">Handling text fields with embedded double quotes</h3> <p>Another challenge we are likely to encounter when reading ‘messy’ csv files is the inclusion of text fields (cells with longer strings of text in them) that might also have embedded double quotes, for example when the text includes a fragment where someone is quoted. More importantly, they might have embedded commas that separate different parts of a sentence. The problem with this is that we also use commas to distinguish between different columns of our csv file, and we somehow need to keep the two different types of comma separate. Let us first slightly adapt our example file to demonstrate what happens to the csv file if we embed double quotes and commas in a text field.</p> <p><em>Just as a note on the side:</em> Depending on what text editor you use, you might not actually see the additional double quotes shown below. The csv standard prescribes that fields with embedded quotes are themselves quoted, and that single embedded quotes are always represented by two double quotes. However, some text editors may parse these double quotes out when you open the file, based on this standard.</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>timing,description,raw,comments,source
1,test1,"Let’s make this example",,"s1"
2,test2,"If there is one thing I hate, it is a single "" What about you?",,"s2"
3,test3,"""Nothing interesting really happened"", said Toby the magic purple elephant.",,"s3"
4,test4,"What about commas, huh?",,"s4"
</code></pre></div></div> <p>In the second line below the header, you’ll find a text cell with a single embedded double quote. As you can see, it is represented by two double quotes rather than one. In the second to last line of data, we find an example of someone being quoted. In the last line we find an embedded comma. For a simple csv parser, these are all quite challenging cases to deal with appropriately, especially if we find them in some combination.</p> <p>In the csv parser that I wrote, these cases are all handled by the <code class="language-plaintext highlighter-rouge">splitCsvLine(&amp;tokens, buffer)</code> function. In the first block of code I included above, the function is called right after we have checked the lines for any line breaks. In other words, the version of buffer that is fed into the <code class="language-plaintext highlighter-rouge">splitCsvLine(&amp;tokens, buffer)</code> function is already a complete version, where all line breaks have been dealt with.</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* 
   Function to split csv lines.
   Here, we should be careful with embedded quotes in text fields.
   Text fields in csv-files are marked by quotes.
   We repeatedly check whether or not we are in a text field and 
   respond accordingly.

   We also clean up the line of text a bit before we cut it up.
*/</span>
<span class="kt">void</span> <span class="n">MainWindow</span><span class="o">::</span><span class="n">splitCsvLine</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">tokens</span><span class="p">,</span>
			      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">line</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="n">inTextField</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// To check whether or not we are in a text field.</span>
  <span class="cm">/* 
     The next two variables are to make sure that 
     we cut out clean segments of the line.
  */</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span> <span class="n">stringLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span> <span class="n">previousPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// We use this integer to count the number of quotes in a line so far.</span>
  <span class="kt">int</span> <span class="n">quoteCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
  <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">line</span><span class="p">.</span><span class="n">length</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'"'</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">quoteCount</span><span class="o">++</span><span class="p">;</span> <span class="c1">// If we found a quote, we increment this variable.</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inTextField</span> <span class="o">==</span> <span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'"'</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* 
	 Finding a quote will mean that we are now 
	 in a text field if we weren't already.
      */</span>
      <span class="n">inTextField</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="n">previousPos</span><span class="o">++</span><span class="p">;</span> <span class="c1">// We don't want to include the quote itself.</span>
      <span class="n">stringLength</span><span class="o">--</span><span class="p">;</span>
      <span class="cm">/* 
	 If we are in a text field, and we encounter another quote, then we
	 should first check if it is accompanied by yet another pair of quotes. 
	 This is based on the fact that csv files (if written correctly), 
	 always use double quotes for
	 quotes that are embedded in text fields. 

	 We also double check by checking if the current amount of 
	 quotes is divisible by 2, that is, if we have an 
	 equal number of quotes.
      */</span>
    <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">inTextField</span> <span class="o">==</span> <span class="nb">true</span> <span class="o">&amp;&amp;</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'"'</span> <span class="o">&amp;&amp;</span>
	       <span class="n">line</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'"'</span> <span class="o">&amp;&amp;</span> <span class="n">quoteCount</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// If these conditions hold, it means that we have now left the text field.</span>
      <span class="n">inTextField</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">stringLength</span><span class="o">--</span><span class="p">;</span> <span class="c1">// We don't want to include the quote itself.</span>
    <span class="p">}</span>
    <span class="c1">// If we encounter a comma, it means that we have encountered a new token.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inTextField</span> <span class="o">==</span> <span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">','</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// We remove any white spaces before the start of this new token.</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">previousPos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">' '</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">previousPos</span><span class="o">++</span><span class="p">;</span>
	<span class="n">stringLength</span><span class="o">--</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// We create a substring here.</span>
      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">tempString</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">previousPos</span><span class="p">,</span> <span class="n">stringLength</span><span class="p">);</span>
      <span class="c1">// In case we have any remaining double quotes, let us remove them.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tempString</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">tempString</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">tempString</span><span class="p">.</span><span class="n">end</span><span class="p">();)</span> <span class="p">{</span>
	  <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">it</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="sc">'"'</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">it</span> <span class="o">==</span> <span class="sc">'"'</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">tempString</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
	  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">it</span><span class="o">++</span><span class="p">;</span>
	  <span class="p">}</span>
	<span class="p">}</span>
      <span class="p">}</span>
      <span class="c1">// And then we store the resulting string as a new token.</span>
      <span class="n">tokens</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">tempString</span><span class="p">);</span>
      <span class="n">previousPos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// We set a new starting position for the next token.</span>
      <span class="n">stringLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// And we reset the string length.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">stringLength</span><span class="o">++</span><span class="p">;</span> <span class="c1">// We increment the string length as we go on.</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// After we finish reading the line, we should still include the last token.</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">previousPos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">' '</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">previousPos</span><span class="o">++</span><span class="p">;</span>
    <span class="n">stringLength</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">tempString</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">previousPos</span><span class="p">,</span> <span class="n">stringLength</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tempString</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">tempString</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">tempString</span><span class="p">.</span><span class="n">end</span><span class="p">();)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">it</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="sc">'"'</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">it</span> <span class="o">==</span> <span class="sc">'"'</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">tempString</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">it</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">tokens</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">tempString</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>This function reads through the object <code class="language-plaintext highlighter-rouge">buffer</code> (which is a string) character by character, and eventually pulls different substrings from the <code class="language-plaintext highlighter-rouge">buffer</code> object that we use as tokens to be written to our database. Near the beginning of this function, we define a bool variable <code class="language-plaintext highlighter-rouge">bool inTextField</code> that we use to check whether we are currently reading characters that are part of a text field. The idea behind this is very simple: If the bool is set to false, and we encounter a double quote, then this is taken as a sign that we are, from now on, inside a text field. As long as we are inside a text field, any commas we encounter will be ignored, and any double quotes we encounter will be handled in a special way.</p> <p>So, what happens once we read the last version of our example csv file, focusing only on the way that double quotes and embedded commas are handled? Let’s start first with the line of data where we have one embedded quote. We first hit the double quote before the word “If”, setting <code class="language-plaintext highlighter-rouge">quoteCount</code> to 1, and setting <code class="language-plaintext highlighter-rouge">inTextField</code> to true. We then hit the first double quote after the word “single”. We set <code class="language-plaintext highlighter-rouge">quoteCount</code> to 2, and given that we are now in a text field, we check whether both the current character at position <em>i</em>, and the next character at position <em>i + 1</em> are double quotes. The <code class="language-plaintext highlighter-rouge">} else if () {</code> statement returns false, because we find a double quote at both positions, so we continue. We immediately encounter the second double quote after the word “single”. Thus, we set <code class="language-plaintext highlighter-rouge">quoteCount</code> to 3, and check the conditional again. In this case, we do not find a double quote at position <em>i + 1</em> (we find a “.” instead), but the last part of the conditional still makes it return false, since 3 % 2 does not equal 0. Just in case you don’t know the meaning of the % symbol in this context, it means that we take the remainder after dividing <code class="language-plaintext highlighter-rouge">quoteCount</code> by 2. Whenever <code class="language-plaintext highlighter-rouge">quoteCount</code> is an even number, this statement will return 0. Given that the <code class="language-plaintext highlighter-rouge">} else if() {</code> still returns false, we continue again. We encounter the last quote of this line after “them.”. We set <code class="language-plaintext highlighter-rouge">quoteCount</code> to 4, and we check the conditional again, which in this case returns true, since (1) we are currently in a text field, (2), at position <em>i</em> we find a double quote, and at position <em>i + 1</em> we do not, and the <code class="language-plaintext highlighter-rouge">quoteCount % 2</code> equals 0. This means that we have now (correctly) decided that we are no longer in a text field, and that we can continue treating commas and double quotes as we normally would.</p> <p>Let’s consider the second to last line of data next. After two columns, we hit the three consecutive double quotes. The first of these sets the <code class="language-plaintext highlighter-rouge">inTextField</code> bool to true. The two other double quotes don’t do anything but increment the <code class="language-plaintext highlighter-rouge">quoteCount</code> object, since the first of them is followed by another double quote, and since the second of them brings <code class="language-plaintext highlighter-rouge">quoteCount</code> to 3, an unequal number. We continue to the two double quotes after the word “happened”, which again do nothing, since the first is followed by another double quote, and since the second brings <code class="language-plaintext highlighter-rouge">quoteCount</code> to an unequal number (5). The last double quote is encountered after “elephant.”. This one brings <code class="language-plaintext highlighter-rouge">quoteCount</code> to a total of 6 for this line, and since it is not followed by another double quote, the function decides that we have finished reading the current text field.</p> <p>Now, let’s discuss the last line of data in the file. This case is quite simple. Once we encounter the first double quote, <code class="language-plaintext highlighter-rouge">inTextField</code> is set to true, and therefore the comma we encounter after the word “commas” is ignored. After we encounter the second double quote, we set <code class="language-plaintext highlighter-rouge">inTextField</code> to false again, and the commas that we encounter in the remainder of the line are handled as delimiting commas.</p> <p>Thus, the problematic cases we discussed earlier are handled quite well. In fact, I am still quite surprised myself how flexible this set of functions is with messy data.</p> <h2 id="closing-comments">Closing comments</h2> <p>As mentioned before, the functions discussed above take inspiration from various comments I encountered while browsing sites like Stack Overflow, and it would be nice to acknowledge everyone who has shared the knowledge that I made use of to write these functions, but I honestly do not remember where I found the different snippets of information. I guess I’ll just have to thank the Stack Overflow community at large.</p> <p>The functions were written and repeatedly revised over quite a long period of time. After all this time, I had to study them in detail myself to understand their underlying logic again. There might still be important details that I forgot to mention here. However, in these cases “the proof of the pudding is in the eating.” It should be easy to integrate these functions in your own software, and try them out for yourself.</p> <p>I hope they turn out to be useful to others!</p>]]></content><author><name></name></author><category term="Software"/><category term="Q-SoPrA"/><category term="Technical"/><category term="C++"/><category term="Qt"/><summary type="html"><![CDATA[Background Before I get to the main topic of this post, I should offer a bit of background. I am currently working on an integrated software package for the qualitative study of social processes, called Q-SoPrA (an acronym for Social Process Analysis). The program can be used for data entry, data management, hierarchical coding for attributes (think CAQDAS-style coding), coding for network relationships, coding for linkages between events (see the work of David Heise for a main source of inspiration in this), abstracting larger events from smaller ones, visualising event graphs, visualising event hierarchies, visualising network graphs, visualising occurrence graphs (similar to Bi-Dynamic Line Graphs), and basic analysis. I intend to write some technical as well as non-technical posts about Q-SoPrA and its development. The technical posts will deal primarily with what happens on ‘the back stage’ of the program, that is, discuss the underlying source code. The non-technical posts will focus primarily on Q-SoPrA’s ‘front stage’, discussing its features and how to use them. This post is going to be a technical one.]]></summary></entry><entry><title type="html">Bi-dynamic Line Graphs</title><link href="https://wouterspekkink.github.io/blog/2017/bi-dynamic-line-graphs/" rel="alternate" type="text/html" title="Bi-dynamic Line Graphs"/><published>2017-03-10T15:25:10+01:00</published><updated>2017-03-10T15:25:10+01:00</updated><id>https://wouterspekkink.github.io/blog/2017/bi-dynamic-line-graphs</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2017/bi-dynamic-line-graphs/"><![CDATA[<h1 id="introduction">Introduction</h1> <p>This program is based on an idea first proposed in an article by Chiara Broccatelli, Martin Everett, and Johan Koskinen, entitled <em>Temporal dynamics in covert networks</em> and published in 2016 in the journal <em>Methodological Innovations</em> (vol 9, pp. 1-14). The program was written by Wouter Spekkink. All mistakes that might exist in the program are his.</p> <h1 id="downloads">Downloads</h1> <p>You can download the program using the following links:</p> <ul> <li> <p><a href="https://github.com/WouterSpekkink/BDLG_Matrix_Converter/releases/download/BDLG_Matrix_Converter_Linux_V1.0.1/BDLG_Matrix_Converter_Linux_v1.0.1.tar.gz">Download for Linux</a></p> </li> <li> <p><a href="https://github.com/WouterSpekkink/BDLG_Matrix_Converter/releases/download/BDLG_Matrix_Converter_Windows_V1.0.1/BDLG_Matrix_Converter_Windows_v1.0.1.zip">Download for Windows</a></p> </li> </ul> <h1 id="bi-dynamic-line-graphs">Bi-dynamic line graphs</h1> <p>In their article, Brocatelli et al. (2016) introduce bi-dynamic line-graph (BDLG) projections of social processes to study dynamics in social networks. The BDLG can be understood as a special projection of a two-mode network of actors and events. In matrix form, a two-mode network is usually presented as an incidence matrix with actors in rows, and events in columns, like so (example based on article mentioned above):</p> <table> <thead> <tr> <th> </th> <th>1</th> <th>2</th> <th>3</th> <th>4</th> <th>5</th> </tr> </thead> <tbody> <tr> <td>A</td> <td>1</td> <td>1</td> <td>1</td> <td>0</td> <td>0</td> </tr> <tr> <td>B</td> <td>0</td> <td>1</td> <td>1</td> <td>1</td> <td>0</td> </tr> <tr> <td>C</td> <td>0</td> <td>1</td> <td>0</td> <td>1</td> <td>1</td> </tr> <tr> <td>D</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>1</td> </tr> </tbody> </table> <p>In Social Network Analysis, it is common to convert two-mode networks to one-mode networks that indicate which actors participated in the same events (and how many times they participated in events together). This is done by multiplying the incidence matrix to a weighted adjacency matrix, which can be achieved by converting the incidence matrix with a transposed version of itself. If we would do that for the incidence matrix above, we would get the following adjacency matrix:</p> <table> <thead> <tr> <th> </th> <th>A</th> <th>B</th> <th>C</th> <th>D</th> </tr> </thead> <tbody> <tr> <td>A</td> <td>3</td> <td>2</td> <td>1</td> <td>0</td> </tr> <tr> <td>B</td> <td>2</td> <td>3</td> <td>2</td> <td>0</td> </tr> <tr> <td>C</td> <td>1</td> <td>2</td> <td>3</td> <td>1</td> </tr> <tr> <td>D</td> <td>0</td> <td>0</td> <td>1</td> <td>1</td> </tr> </tbody> </table> <p>Although this gives insight in the ties that emerge from the events in which actors participate, the drawback is that all temporal information is lost; only a static network remains. This can be solved partially by making separate adjacency matrices for different segments of the incidence matrix, but the choice for the size of the segments is always arbitrary, and information about changes within each segment is still lost (see Brocatelli et al. 2016 for a discussion on this).</p> <p>Brocatelli et al. (2016) propose BDLGs as an alternative projection of two-mode networks that have a temporal dimension. In a BDLG the edges between actors and events of the original two-mode graph are ‘converted’ to nodes. For example, the edge between actor <em>A</em> and event <em>1</em> in the original two-mode graph becomes the node <em>A1</em> in the BDLG. In a BDLG, two types of relationships can exist between these nodes. Mutual (or reciprocal) edges only exist between nodes that indicate actors that are involved in the same event (e.g., <em>A1</em>&lt;-&gt;<em>B1</em>). Edges with only one direction indicate the continued presence of actors throughout events (e.g., <em>A1</em>-&gt;<em>A2</em>-&gt;<em>A4</em>). To prevent the inclusion of redundant information in the BDLG, Brocatelli et al. (2016) also introduce the rule that transitive paths are always reduced to a single path. For example, if actor <em>A</em> was involved in events <em>1</em>, <em>2</em>, and <em>4</em>, it is only necessary to create the edges <em>A1</em>-&gt;<em>A2</em> and <em>A2</em>-&gt;<em>A4</em>. The edge <em>A1</em>-&gt;<em>A4</em> introduces redundant information about the continued involvement of actor <em>A</em>, and can therefore be excluded. This rule leads to more elegant presentations that allow researchers to trace actors’ involvement in the studied process. The matrix form of the BDLG thus becomes as follows (rows with only <em>0</em> values, as well as their corresponding columns, have been removed from the matrix):</p> <table> <thead> <tr> <th> </th> <th>A1</th> <th>A2</th> <th>A3</th> <th>B2</th> <th>B3</th> <th>B4</th> <th>C2</th> <th>C4</th> <th>C5</th> <th>D5</th> </tr> </thead> <tbody> <tr> <td>A1</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> <tr> <td>A2</td> <td>0</td> <td>0</td> <td>1</td> <td>1</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>0</td> </tr> <tr> <td>A3</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> <tr> <td>B2</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>0</td> </tr> <tr> <td>B3</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> <tr> <td>B4</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr> <tr> <td>C2</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr> <tr> <td>C4</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> </tr> <tr> <td>C5</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>1</td> </tr> <tr> <td>D5</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> </tr> </tbody> </table> <h1 id="the-program">The program</h1> <p>Based on the ideas outlined above, Wouter Spekkink wrote a simple tool that converts incidence matrices into BDLG matrices. The program expects the user to import a csv-file with the incidence matrix of the two-mode network. The program assumes that the columns of the incidence matrix are ordered in time from left to right. The order of the actors is unimportant.</p> <p>The tool can export the matrix itself to a csv-file. In addition, the tool can export a node list and edge list, where the edge list contains the same information as the matrix, whereas the nodes list also includes some variables that indicate, for each node, the event that is part of the node (<em>Order_Original</em>), the actor that is part of the node (<em>Actor</em>), and the order in which the events occurred (<em>Order_Closed</em>).</p> <h1 id="running-the-program">Running the program</h1> <p>The Windows version of the program can be run by simply opening the application. The Linux version can be run by using the accompanying shell script. It might be necessary to change permissions for the shell script first, by typing the following in the console:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; sudo chmod+x ./bdlg-matrix.sh
</code></pre></div></div> <h1 id="using-the-program-with-gephi">Using the program with Gephi</h1> <p>A quick way to visualise the results is to use the tool to export the node list and edge list, and import these into <a href="http://www.gephi.org">Gephi</a>. Importing of the edge list and node list should be done from Gephi’s data laboratory. The user should make sure that the order variables of the node list are imported as numeric variables (doubles are the safest option, but integers should also work in most situations). To make useful plots of the results, the user should make sure to also install the Event Graph Layout (this can be done from within the Plugins menu of Gephi). The user should then select one of the order variables as the order variable for the Event Graph Layout plugin. The <em>Actor</em> variable can be used to give nodes colours based on the actors associated with them. This allows one to more easily spot lineages in the graph.</p> <h1 id="dependencies">Dependencies</h1> <p>The program was written in C++, and with the help of Qt5 libraries. Thus, Qt5 must be installed on your system if you wish to build the program yourself.</p>]]></content><author><name></name></author><category term="Software"/><category term="Non-Technical"/><summary type="html"><![CDATA[Introduction This program is based on an idea first proposed in an article by Chiara Broccatelli, Martin Everett, and Johan Koskinen, entitled Temporal dynamics in covert networks and published in 2016 in the journal Methodological Innovations (vol 9, pp. 1-14). The program was written by Wouter Spekkink. All mistakes that might exist in the program are his.]]></summary></entry><entry><title type="html">A simple example of Multidimensional Scaling with R and Gephi</title><link href="https://wouterspekkink.github.io/blog/2015/a-simple-example-of-mds-using-r-and-gephi/" rel="alternate" type="text/html" title="A simple example of Multidimensional Scaling with R and Gephi"/><published>2015-12-15T10:07:00+01:00</published><updated>2015-12-15T10:07:00+01:00</updated><id>https://wouterspekkink.github.io/blog/2015/a-simple-example-of-mds-using-r-and-gephi</id><content type="html" xml:base="https://wouterspekkink.github.io/blog/2015/a-simple-example-of-mds-using-r-and-gephi/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>During my PhD project I developed a fascination for geometric approaches to exploratory data analysis, such as Multidimensional Scaling (MDS) and Correspondence Analysis. These methods have some very interesting applications. For example, they can help you to strongly reduce the dimensionality of datasets, capturing the most essential patterns in your data. I especially like the ways in which these methods can help you to visually explore concepts that can be captured in terms of ‘distances,’ such as (dis)similarities between people, social groups, events, and etcetera. I thought it would be nice to write a few posts in which I offer basic examples of the methods in use (without going into the technical details), using only open source software. In this post, I focus specifically on MDS, and I offer a basic demonstration of the method, using <a href="https://www.r-project.org/">R</a> and <a href="https://gephi.org/">Gephi</a>, two amazing pieces of software.</p> <h2 id="a-very-brief-introduction-into-mds">A very brief introduction into MDS</h2> <p>Let me first say that I am not going to give an in-depth methodological introduction into MDS. I like to keep things at an intuitive level for this post (and I am likely to do so in future posts on this topic). There are plenty of books that offer a great technical introduction into MDS, including <a href="https://books.google.nl/books?id=ZzmIPcEXPf0C&amp;redir_esc=y">Kruskal and Wish (1978)</a> (I love those little green books on Quantitative Applications in the Social Sciences) and <a href="https://books.google.nl/books?id=k5iAAAAAMAAJ&amp;q=Gatrell+Distance+and+Space&amp;dq=Gatrell+Distance+and+Space&amp;hl=nl&amp;sa=X&amp;ved=0ahUKEwjIwJ7CuN7JAhXCeQ8KHQO8A6gQ6AEIKTAA">Gatrell (1983)</a> (oh, the smell of old books). I should also say that there is more than one type of MDS. For example, there is the distinction between metric and non-metric MDS. I am not going into all these nuances either, but I can at least share with you that, in the example below, I am applying non-metric MDS.</p> <p>Basically, what MDS can do for you is to take a matrix in which the distances between a set of entities are recorded (i.e., a distance matrix), and try to create a low-dimensional spatial configuration in which the same entities are located in a way that the distances between them are proportional to the distances in the original distance matrix. This may sound trivial, but keep in mind that some types of distances may be very difficult to accurately reproduce in a low-dimensional space. For example, I have experimented with using MDS to visualize the (dis)similarities between social events, based on the actors and issues (e.g, problem and solution definitions) that the events have in common. I usually ended up needing at least 6 dimensions to accurately express these (dis)similarities. Unfortunately, it is impossible to visualize any space with more than three dimensions in one picture, and trying to do so is a serious threat to your mental health.</p> <p>At this point, some of you might already wonder how we can decide the number of dimensions that we need to accurately represent the contents of a given distance matrix. MDS comes with a measure called ‘stress,’ which you can interpret as a measure of fit between the spatial configuration produced, and the original distance matrix. The higher the stress, the worse the fit. In other words: The higher the stress, the less confidence you should have that the spatial configuration you produced accurately represents the distances in your original distance matrix. <a href="https://books.google.nl/books?id=ZzmIPcEXPf0C&amp;redir_esc=y">Kruskal and Wish (1978)</a> offer an insightful discussion on stress, and on different rules of thumb on how to interpret stress values. A very rough rule of thumb is that stress values below 0.10 usually indicate a good fit, and that values above 0.20 are unacceptable (but don’t cite me on this!).</p> <h2 id="our-example-of-today">Our example of today</h2> <p>The example that I will be using is a bit silly, but it serves quite well to show how powerful MDS can be at creating spaces that accurately reflect the distances that you feed into the analysis. For this example, I have taken 12 cities in the Netherlands, and I looked up the distances between all of them. To find the distances, I used <a href="http://afstand-berekenen.com/">this website</a> (thank you, Google). See the distance matrix that I produced below (some of the larger pictures in this post may be easier to read if you click on them).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_1-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_1-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_1-1400.webp"/> <img src="/assets/img/Distance_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Distance matrix. </div> <p>There is no particular reason why I picked these cities, except for the fact that they are spread out quite nicely throughout the Netherlands. I already know that it will be very easy to represent these distances in a 2-dimensional space, because that is what we do all the time with geographical maps. So the results will not be very surprising, but I still think the results are cool enough.</p> <h2 id="lets-get-to-work">Let’s get to work!</h2> <p>So, let’s do this! The first thing I did is to save the matrix shown above as a comma-delimited file (.csv extension), because it is easy to import such files into R. If you don’t know how to do this, go to ‘save as’ in Excel, and find comma-delimited in the file options. Comma-delimited files are basically text-files that use commas, or other symbols, to separate columns. I always use semicolons ‘;’ as separators, but you can use whatever you like.</p> <p>Next, we start up R. My R-session may look at bit weird to you, because I embedded R in <a href="https://www.gnu.org/software/emacs/">Emacs</a>, using <a href="http://ess.r-project.org/Manual/news.html">Emacs Speaks Statistics</a>, and that is just because I am a nerd. You can of course use the standard GUI for R if you like. R comes with built-in functions that can do MDS, but I like to work with a package called ‘vegan.’ I already had the package installed, but if you don’t, then you can install the package by typing install.packages(“vegan”) into the R-console. After that, you can activate the package by typing library(vegan).</p> <p>After starting R, I imported the csv-file as a matrix object (see picture further below for a log of all the commands that I used). I called the matrix geoMatrix. After importing the file, I immediately turned the matrix into a so-called dist object (called geoDist), which is something that R uses to store distances. This is also the object that I fed into the MDS analysis.</p> <p>The ‘vegan’ package comes with a function called metaMDS(). The function takes a lot of arguments, but most of them have default values, and for our example these default values will work just fine. There are two arguments that I would like to draw your attention to: The first argument to the function should be the distance object that you want to use as the input for the MDS analysis. There is another argument k, which indicates the number of dimensions that you want the spatial configuration to have. The default value for k is 2, which is fine for us. However, if you find that with this default value you end up with high stress values, then you might want to consider increasing the value of k. You would then, for example, use the function with the following arguments: metaMDS(geoDist, k = 3).</p> <p>I use the function with the geoDist object as the only argument, and I tell R to assign the results of the function to an object called geoMDS. The function will start an iterative process in which it attempts to come up with increasingly accurate spatial configurations, and it will spit out the stress value that it ends up with at each run. By default, this function will make up to 20 attempts to come up with a decent configuration (this is also something you can change by changing the arguments given to the function), but in our case the function already reaches a very low stress value at its second run (see log below).</p> <p>I immediately plotted the resulting configuration, using the standard plot() function. To assign labels to the points in the visualized configuration, I used the function text(). See the screen shot below for a log of all the commands I used (including the arguments given to the different functions) on the right, and the plot of the resulting configuration on the left (if you look below the visualization, you’ll see that I was checking out a discussion on calculating stress in R, just before doing the analysis).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_2-1400.webp"/> <img src="/assets/img/Distance_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> MDS plot. </div> <p>After a visual inspection of the results, I decided that the distances seem pretty close the actual distances you will find on a map. However, the layout of the cities is a bit counterintuitive. Also, the orientation of the space is different from what we are used to with geographical maps, so I decided to import the data into Gephi, and change the layout there, without changing the distances.</p> <h2 id="importing-the-data-into-gephi">Importing the data into Gephi</h2> <p>To do this, I first had to export the coordinates of all the cities in the new space that the MDS analysis created for them. These coordinates are stored somewhere in the geoMDS object. This object has a rather complicated structure that I do not want to get into, and I do not expect you to immediately understand the trick that I use to extract the coordinates from the object. However, let me tell you what I did: I created two new vectors (one for each dimension). The first vector holds all the coordinates in dimension 1, and the second vector holds all the coordinates in dimension 2. In the geoMDS-object, these coordinates are stored in what can be understood as a ‘sub-object’ of geoMDS, which is called ‘points,’ and which is basically a two-column matrix (1 column for each dimension). All coordinates in dimension 1 are stored in the first column, and all coordinates in dimension 2 are stored in the second column. So, if you understand the basics of R, you may also understand that we can access the coordinates in each dimension with the commands geoMDS$points[,1] (for dimension 1) and geoMDS$points[,2] (for dimension 2). After putting the coordinates in two separate vectors, I assembled the vectors into a data.frame. Then I wrote the data.frame to the disk, using the write.table() function. I wrote the results to a file that I named “CoordinatesGeo.csv.” See the screen shot below to see the commands that I used.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_3-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_3-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_3-1400.webp"/> <img src="/assets/img/Distance_3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> R in Emacs. </div> <p>Before we can import the resulting file in Gephi, it needs some minor changes. Without changes “CoordinatesGeo.csv” is a table with three colums: One unnamed column with the names of the cities, and two named columns with the coordinates that we created with our MDS analysis. I turned this table into a Gephi nodes list by naming the column with city names “Id”, and by copying this column to a second column that I renamed “Labels” (see screen shot below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_4-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_4-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_4-1400.webp"/> <img src="/assets/img/Distance_4.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Preparing for import into Gephi. </div> <p>Now we start up Gephi. In Gephi, we start a new project, and we go to the data laboratory. There, we use the ‘import spreadsheet’ function (see below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_5-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_5-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_5-1400.webp"/> <img src="/assets/img/Distance_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Importing a spreadsheet. &lt;/div&gt;</p> <p>This will open a new dialog, where we can indicate how we want to import our data. One thing is very important here, and that is that we want to import the coordinates as numerical data. I usually import numerical data as doubles (see below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_6-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_6-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_6-1400.webp"/> <img src="/assets/img/Distance_6.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Importing as doubles. </div> <p>If the settings are like shown in the screen shot above, then you should be okay. We can go back to the overview in Gephi, and the nodes will be randomly distributed in the plot screen. Gephi doesn’t come with a built-in layout algorithm for nodes that have coordinates, but you can use a plugin that I created some time ago, called <a href="/software#multi-dimensional-scaling-in-gephi">MDS Layout</a>. You should have this plugin installed before you can proceed with the next steps.</p> <p>I selected the MDS Layout from the layout menu, and the plugin automatically recognizes the variables ‘dim1’ and ‘dim2’ as appropriate dimensions. The layout that is created if you run the plugin is the same as what we saw when we plotted the results in Gephi (see below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_8-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_8-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_8-1400.webp"/> <img src="/assets/img/Distance_8.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Initial layout in Gephi. </div> <p>I wanted the cities to be oriented the same way as in commonly used geographical maps, and for that I used Gephi’s built-in layout algorithm ‘Clockwise rotate’ (interestingly, this algorithm rotates the nodes in the counter-clockwise direction). I set the algorithm to rotate the layout by 90 degrees. After doing that, I immediately saw that the layout of the cities created by the MDS is like a mirror image of the layout that you’ll find on a geographical map (Maastricht is in the West, while it should be in the East, and Middelburg is in the East, while it should be in the West). This is something that we cannot fix in Gephi, but we can easily fix it in Excel.</p> <p>I reopened the nodes list we created earlier, and after inspecting the coordinates I saw that the coordinates in dimension 2 are the coordinates that are mirrored. To fix this, I created a new column with coordinates for dimension 2. The values in this column are the values of the original column multiplied by -1 (see below).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_9-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_9-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_9-1400.webp"/> <img src="/assets/img/Distance_9.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Flipping a dimension. </div> <p>I imported the adjusted nodes list into Gephi, using the same approach as before. I used the MDS Layout again to create my initial layout. In this case too, I had to use the “Clockwise rotate” layout to rotate the layout by 90 degrees. I also increased the size of the nodes a bit and gave them a color, just for aesthetic reasons. See the result below. If you know the map of the Netherlands, then you’ll see that this is already more like it!</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_11-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_11-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_11-1400.webp"/> <img src="/assets/img/Distance_11.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Rotated layout. </div> <p>As an ultimate test (okay, this is a bit of an exaggeration) I decided to plot the points on top of a blank map of the Netherlands. I found such a map easily enough through Google Images. I exported the visualization from Gephi as an SVG-file, such that I could adjust the positions of the labels (the city names) in <a href="https://inkscape.org/en/">Inkscape</a> (another wonderful piece of open source software). After adjusting the labels, I exported the result as a PNG image. I then opened the blank map of the Netherlands, as well as the PNG file with the cities in of the Netherlands in <a href="https://www.gimp.org/">Gimp</a> (yes, yes, open source) and pasted the cities on the blank map. It took some rescaling and additional rotating to get the layout right, but ladies and gentlemen, the result looks very, very nice.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/Distance_12-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/Distance_12-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/Distance_12-1400.webp"/> <img src="/assets/img/Distance_12.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" style="margin:auto; display:block" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> The final result. </div> <p>Just compare the results to an actual map of the Netherlands, and you’ll see that the MDS analysis did a very good job at creating a spatial configuration that accurately represents the distances that we fed into it. The main difference between the layout of the cities in the MDS space, and the layout of the cities in ‘actual’ geographic space is that the layout of the cities on one dimension was mirrored. It reminds me of those crappy Sci-Fi stories in which mirrors are portals to alternative dimensions, but as I mentioned before: I am a nerd.</p> <p>Like I said, this is a bit of a silly example, but I plan to come up with more interesting ones in the future, where I will explore, for example, the application of MDS to ‘social stuff.’</p> <p>Hope you enjoyed this!</p> <p>BTW: Some time ago I created a plugin for Gephi that does MDS, using the path distances between the nodes of a graph as its input. The plugin produces coordinates that can be used to create layouts with the MDS layout algorithm. <a href="/software#multi-dimensional-scaling-in-gephi">See here for more details</a>.</p>]]></content><author><name></name></author><category term="Software"/><category term="R"/><category term="MDS"/><category term="Gephi"/><summary type="html"><![CDATA[Introduction During my PhD project I developed a fascination for geometric approaches to exploratory data analysis, such as Multidimensional Scaling (MDS) and Correspondence Analysis. These methods have some very interesting applications. For example, they can help you to strongly reduce the dimensionality of datasets, capturing the most essential patterns in your data. I especially like the ways in which these methods can help you to visually explore concepts that can be captured in terms of ‘distances,’ such as (dis)similarities between people, social groups, events, and etcetera. I thought it would be nice to write a few posts in which I offer basic examples of the methods in use (without going into the technical details), using only open source software. In this post, I focus specifically on MDS, and I offer a basic demonstration of the method, using R and Gephi, two amazing pieces of software.]]></summary></entry></feed>